<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>üéì H·ªá th·ªëng Qu·∫£n l√Ω Trung t√¢m D·∫°y h·ªçc - Offline</title>
    <meta name="description" content="H·ªá th·ªëng qu·∫£n l√Ω trung t√¢m d·∫°y h·ªçc - ho·∫°t ƒë·ªông ho√†n to√†n offline">
    
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <!-- ========================================== -->
    <!-- M√ÄNG H√åNH ƒêƒÇNG NH·∫¨P -->
    <!-- ========================================== -->
    <div class="login-container" id="loginScreen">
        <div class="login-card">
            <div class="login-header">
                <div class="login-logo">üéì</div>
                <h1 class="login-title">TRUNG T√ÇM D·∫†Y H·ªåC</h1>
                <p class="login-subtitle">H·ªá th·ªëng qu·∫£n l√Ω h·ªçc vi√™n</p>
            </div>
            
            <div class="error-message" id="loginError" style="display: none;"></div>
            
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="username">
                        <i>üë§</i> T√™n ƒëƒÉng nh·∫≠p
                    </label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p"
                        required
                        autocomplete="username"
                    >
                </div>
                
                <div class="form-group">
                    <label for="password">
                        <i>üîí</i> M·∫≠t kh·∫©u
                    </label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
                        required
                        autocomplete="current-password"
                    >
                </div>
                
                <button type="submit" class="btn-login">
                    ƒêƒÉng nh·∫≠p
                </button>
            </form>
            
            <div class="login-footer">
                <p>T√†i kho·∫£n m·∫∑c ƒë·ªãnh: <strong>admin</strong> / <strong>admin123</strong></p>
                <p style="font-size: 0.85em; color: #6b7280; margin-top: 10px;">
                    H·ªá th·ªëng qu·∫£n l√Ω trung t√¢m d·∫°y h·ªçc v1.0
                </p>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- GIAO DI·ªÜN CH√çNH (·∫®N KHI CH∆ØA ƒêƒÇNG NH·∫¨P) -->
    <!-- ========================================== -->
    <div class="main-container" id="mainApp" style="display: none;">
        
        <!-- SIDEBAR MENU -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <span class="logo-icon">üéì</span>
                    <span class="logo-text">Trung t√¢m D·∫°y h·ªçc</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle">
                    <span>‚ò∞</span>
                </button>
            </div>
            
            <nav class="sidebar-menu">
                <!-- T·ªîNG QUAN -->
                <div class="menu-section">
                    <div class="menu-section-title">üìä T·ªîNG QUAN</div>
                    <ul class="menu-list">
                        <li>
                            <a href="#" class="menu-item active" data-page="dashboard">
                                <span class="menu-icon">üìä</span>
                                <span class="menu-text">Dashboard</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- QU·∫¢N L√ù C∆† B·∫¢N -->
                <div class="menu-section">
                    <div class="menu-section-title">üìö QU·∫¢N L√ù C∆† B·∫¢N</div>
                    <ul class="menu-list">
                        <li>
                            <a href="#" class="menu-item" data-page="students">
                                <span class="menu-icon">üë®‚Äçüéì</span>
                                <span class="menu-text">H·ªçc vi√™n</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="menu-item" data-page="teachers">
                                <span class="menu-icon">üë®‚Äçüè´</span>
                                <span class="menu-text">Gi√°o vi√™n</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="menu-item" data-page="classes">
                                <span class="menu-icon">üìö</span>
                                <span class="menu-text">L·ªõp h·ªçc</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="menu-item" data-page="subjects">
                                <span class="menu-icon">üìñ</span>
                                <span class="menu-text">M√¥n h·ªçc</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="menu-item" data-page="rooms">
                                <span class="menu-icon">üè´</span>
                                <span class="menu-text">Ph√≤ng h·ªçc</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- NGHI·ªÜP V·ª§ -->
                <div class="menu-section">
                    <div class="menu-section-title">üìã NGHI·ªÜP V·ª§</div>
                    <ul class="menu-list">
                        <li>
                            <a href="#" class="menu-item" data-page="attendance">
                                <span class="menu-icon">‚úÖ</span>
                                <span class="menu-text">ƒêi·ªÉm danh</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="menu-item" data-page="makeup">
                                <span class="menu-icon">üîÑ</span>
                                <span class="menu-text">H·ªçc b√π</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="menu-item" data-page="tuitions">
                                <span class="menu-icon">üí∞</span>
                                <span class="menu-text">H·ªçc ph√≠</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="menu-item" data-page="promotions">
                                <span class="menu-icon">üéÅ</span>
                                <span class="menu-text">Khuy·∫øn m√£i</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- B√ÅO C√ÅO -->
                <div class="menu-section">
                    <div class="menu-section-title">üìà B√ÅO C√ÅO</div>
                    <ul class="menu-list">
                        <li>
                            <a href="#" class="menu-item" data-page="reports">
                                <span class="menu-icon">üìä</span>
                                <span class="menu-text">B√°o c√°o h·ªçc t·∫≠p</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="menu-item" data-page="messages">
                                <span class="menu-icon">üí¨</span>
                                <span class="menu-text">S·ªï li√™n l·∫°c</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="menu-item" data-page="statistics">
                                <span class="menu-icon">üìà</span>
                                <span class="menu-text">Th·ªëng k√™</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- H·ªÜ TH·ªêNG -->
                <div class="menu-section">
                    <div class="menu-section-title">‚öôÔ∏è H·ªÜ TH·ªêNG</div>
                    <ul class="menu-list">
                        <li>
                            <a href="#" class="menu-item" data-page="settings">
                                <span class="menu-icon">‚öôÔ∏è</span>
                                <span class="menu-text">C√†i ƒë·∫∑t</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="menu-item" data-page="center-info">
                                <span class="menu-icon">‚ÑπÔ∏è</span>
                                <span class="menu-text">Th√¥ng tin TT</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <button class="btn-logout" id="btnLogout">
                    <span>üö™</span>
                    <span>ƒêƒÉng xu·∫•t</span>
                </button>
            </div>
        </aside>

        <!-- N·ªòI DUNG CH√çNH -->
        <main class="main-content">
            <!-- HEADER -->
            <header class="content-header">
                <div class="header-left">
                    <button class="btn-menu-toggle" id="btnMenuToggle">‚ò∞</button>
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                </div>
                
                <div class="header-right">
                    <div class="header-info">
                        <span class="current-date" id="currentDate"></span>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar">üë§</div>
                        <div class="user-details">
                            <div class="user-name" id="userName">Administrator</div>
                            <div class="user-role" id="userRole">Qu·∫£n tr·ªã vi√™n</div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- CONTENT AREA -->
            <div class="content-area" id="contentArea">
                <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c load ƒë·ªông ·ªü ƒë√¢y -->
                <div class="loading-screen">
                    <div class="loading-spinner"></div>
                    <p>ƒêang t·∫£i...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- NOTIFICATION CONTAINER -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- ========================================== -->
    <!-- JAVASCRIPT CODE -->
    <!-- ========================================== -->
<script>
// ============================================================
// H·ªÜ TH·ªêNG QU·∫¢N L√ù TRUNG T√ÇM D·∫†Y H·ªåC - VERSION 1.0
// Task 1.1: Kh·ªüi t·∫°o c·∫•u tr√∫c d·ªØ li·ªáu
// ============================================================

// ------------------------------------------------------------
// 1. C·∫§U H√åNH H·ªÜ TH·ªêNG
// ------------------------------------------------------------
const APP_CONFIG = {
    appName: 'H·ªá th·ªëng Qu·∫£n l√Ω Trung t√¢m D·∫°y h·ªçc',
    version: '1.0.0',
    centerName: 'Trung t√¢m D·∫°y h·ªçc ABC',
    centerPhone: '0901234567',
    centerAddress: '123 ƒê∆∞·ªùng XYZ, Qu·∫≠n 1, TP.HCM',
    centerEmail: 'contact@ttdayhoc.edu.vn',
    storagePrefix: 'learningCenter_',
    defaultPassword: 'admin123', // M·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh (s·∫Ω hash)
};

// ------------------------------------------------------------
// 2. DANH S√ÅCH KEY LOCALSTORAGE
// ------------------------------------------------------------
const STORAGE_KEYS = {
    subjects: 'subjects',           // M√¥n h·ªçc
    rooms: 'rooms',                 // Ph√≤ng h·ªçc
    teachers: 'teachers',           // Gi√°o vi√™n
    parents: 'parents',             // Ph·ª• huynh
    students: 'students',           // H·ªçc vi√™n
    classes: 'classes',             // L·ªõp h·ªçc
    enrollments: 'enrollments',     // ƒêƒÉng k√Ω l·ªõp
    sessions: 'sessions',           // Bu·ªïi h·ªçc
    attendance: 'attendance',       // ƒêi·ªÉm danh
    makeupRequests: 'makeupRequests', // H·ªçc b√π
    tuitions: 'tuitions',           // H·ªçc ph√≠
    payments: 'payments',           // Thanh to√°n
    promotions: 'promotions',       // Khuy·∫øn m√£i
    evaluations: 'evaluations',     // Nh·∫≠n x√©t
    messages: 'messages',           // Tin nh·∫Øn
    activityLogs: 'activityLogs',   // L·ªãch s·ª≠
    users: 'users',                 // T√†i kho·∫£n
    settings: 'settings',           // C√†i ƒë·∫∑t
};

// ------------------------------------------------------------
// 3. ENUM - DANH S√ÅCH TR·∫†NG TH√ÅI
// ------------------------------------------------------------
const STATUS = {
    // Tr·∫°ng th√°i h·ªçc vi√™n
    STUDENT: {
        TRIAL: 'trial',             // H·ªçc th·ª≠
        NEW: 'new',                 // H·ªçc vi√™n m·ªõi
        ACTIVE: 'active',           // ƒêang h·ªçc
        WARNING: 'warning',         // S·∫Øp h·∫øt kh√≥a
        COMPLETED: 'completed',     // Ho√†n th√†nh
        INACTIVE: 'inactive',       // Ngh·ªâ h·ªçc
    },
    
    // Tr·∫°ng th√°i l·ªõp h·ªçc
    CLASS: {
        UPCOMING: 'upcoming',       // S·∫Øp m·ªü
        ACTIVE: 'active',           // ƒêang d·∫°y
        COMPLETED: 'completed',     // ƒê√£ k·∫øt th√∫c
        CANCELLED: 'cancelled',     // ƒê√£ h·ªßy
    },
    
    // Tr·∫°ng th√°i bu·ªïi h·ªçc
    SESSION: {
        SCHEDULED: 'scheduled',     // ƒê√£ l√™n l·ªãch
        IN_PROGRESS: 'in-progress', // ƒêang di·ªÖn ra
        COMPLETED: 'completed',     // ƒê√£ ho√†n th√†nh
        CANCELLED: 'cancelled',     // ƒê√£ h·ªßy
        MAKEUP: 'makeup',           // Bu·ªïi d·∫°y b√π
    },
    
    // Tr·∫°ng th√°i ƒëi·ªÉm danh
    ATTENDANCE: {
        PRESENT: 'present',                 // C√≥ m·∫∑t
        ABSENT_EXCUSED: 'absent-excused',   // V·∫Øng c√≥ ph√©p
        ABSENT_UNEXCUSED: 'absent-unexcused', // V·∫Øng kh√¥ng ph√©p
        LATE: 'late',                       // Mu·ªôn
        EARLY_LEAVE: 'early-leave',         // V·ªÅ s·ªõm
        MAKEUP: 'makeup',                   // H·ªçc b√π
        MAKEUP_TEACH: 'makeup-teach',       // D·∫°y b√π
        TRIAL: 'trial',                     // D·ª± th√≠nh
        SUSPENDED: 'suspended',             // B·∫£o l∆∞u
        COMPENSATED: 'compensated',         // Bu·ªïi b√π
    },
    
    // Tr·∫°ng th√°i h·ªçc b√π
    MAKEUP: {
        PENDING: 'pending',         // Ch·ªù s·∫Øp x·∫øp
        SCHEDULED: 'scheduled',     // ƒê√£ x·∫øp l·ªãch
        COMPLETED: 'completed',     // ƒê√£ h·ªçc b√π
        EXPIRED: 'expired',         // H·∫øt h·∫°n
    },
    
    // Tr·∫°ng th√°i thanh to√°n
    PAYMENT: {
        UNPAID: 'unpaid',           // Ch∆∞a thanh to√°n
        PARTIAL: 'partial',         // Thanh to√°n m·ªôt ph·∫ßn
        PAID: 'paid',               // ƒê√£ thanh to√°n ƒë·ªß
    },
    
    // Lo·∫°i gi√°o vi√™n
    TEACHER_CONTRACT: {
        FULL_TIME: 'full-time',     // To√†n th·ªùi gian
        PART_TIME: 'part-time',     // B√°n th·ªùi gian
        COLLABORATOR: 'collaborator', // C·ªông t√°c vi√™n
    },
    
    // Tr·∫°ng th√°i chung
    GENERAL: {
        ACTIVE: 'active',
        INACTIVE: 'inactive',
    },
};

// ------------------------------------------------------------
// 4. HELPER FUNCTIONS - H√ÄM H·ªñ TR·ª¢
// ------------------------------------------------------------

// 4.1. T·∫°o ID t·ª± ƒë·ªông
function generateId(prefix = 'ID') {
    const timestamp = Date.now();
    const random = Math.floor(Math.random() * 1000);
    return `${prefix}${timestamp}${random}`;
}

// 4.2. L·∫•y ng√†y hi·ªán t·∫°i (YYYY-MM-DD)
function getCurrentDate() {
    const now = new Date();
    return now.toISOString().split('T')[0];
}

// 4.3. L·∫•y th·ªùi gian hi·ªán t·∫°i (YYYY-MM-DD HH:mm:ss)
function getCurrentDateTime() {
    const now = new Date();
    return now.toISOString().slice(0, 19).replace('T', ' ');
}

// 4.4. T√≠nh ng√†y sau N ng√†y
function addDays(dateStr, days) {
    const date = new Date(dateStr);
    date.setDate(date.getDate() + days);
    return date.toISOString().split('T')[0];
}

// 4.5. Format ti·ªÅn t·ªá VND
function formatCurrency(amount) {
    return new Intl.NumberFormat('vi-VN', {
        style: 'currency',
        currency: 'VND'
    }).format(amount);
}

// 4.6. Hash m·∫≠t kh·∫©u (SHA-256)
async function hashPassword(password) {
    const encoder = new TextEncoder();
    const data = encoder.encode(password);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

// ------------------------------------------------------------
// 5. LOCALSTORAGE MANAGER
// ------------------------------------------------------------
const StorageManager = {
    // L∆∞u d·ªØ li·ªáu
    save(key, data) {
        try {
            const fullKey = APP_CONFIG.storagePrefix + key;
            localStorage.setItem(fullKey, JSON.stringify(data));
            return true;
        } catch (error) {
            console.error('L·ªói l∆∞u d·ªØ li·ªáu:', error);
            return false;
        }
    },
    
    // L·∫•y d·ªØ li·ªáu
    get(key) {
        try {
            const fullKey = APP_CONFIG.storagePrefix + key;
            const data = localStorage.getItem(fullKey);
            return data ? JSON.parse(data) : null;
        } catch (error) {
            console.error('L·ªói ƒë·ªçc d·ªØ li·ªáu:', error);
            return null;
        }
    },
    
    // X√≥a d·ªØ li·ªáu
    remove(key) {
        const fullKey = APP_CONFIG.storagePrefix + key;
        localStorage.removeItem(fullKey);
    },
    
    // X√≥a t·∫•t c·∫£ d·ªØ li·ªáu
    clear() {
        const keys = Object.keys(localStorage);
        keys.forEach(key => {
            if (key.startsWith(APP_CONFIG.storagePrefix)) {
                localStorage.removeItem(key);
            }
        });
    },
    
    // Backup to√†n b·ªô d·ªØ li·ªáu
    backup() {
        const backup = {};
        Object.values(STORAGE_KEYS).forEach(key => {
            backup[key] = this.get(key);
        });
        return backup;
    },
    
    // Restore t·ª´ backup
    restore(backupData) {
        try {
            Object.keys(backupData).forEach(key => {
                this.save(key, backupData[key]);
            });
            return true;
        } catch (error) {
            console.error('L·ªói restore d·ªØ li·ªáu:', error);
            return false;
        }
    },
    
    // Export d·ªØ li·ªáu ra file JSON
    exportToFile() {
        const backup = this.backup();
        const dataStr = JSON.stringify(backup, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `backup_${getCurrentDate()}.json`;
        link.click();
        URL.revokeObjectURL(url);
    },
    
    // Import d·ªØ li·ªáu t·ª´ file JSON
    importFromFile(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    const success = this.restore(data);
                    resolve(success);
                } catch (error) {
                    reject(error);
                }
            };
            reader.onerror = reject;
            reader.readAsText(file);
        });
    },
};

// ------------------------------------------------------------
// 6. DATA MANAGER - QU·∫¢N L√ù D·ªÆ LI·ªÜU
// ------------------------------------------------------------
const DataManager = {
    // L·∫•y t·∫•t c·∫£
    getAll(key) {
        return StorageManager.get(key) || [];
    },
    
    // L·∫•y theo ID
    getById(key, id) {
        const items = this.getAll(key);
        return items.find(item => item.id === id);
    },
    
    // Th√™m m·ªõi
    add(key, item) {
        const items = this.getAll(key);
        items.push(item);
        return StorageManager.save(key, items);
    },
    
    // C·∫≠p nh·∫≠t
    update(key, id, updatedItem) {
        const items = this.getAll(key);
        const index = items.findIndex(item => item.id === id);
        if (index !== -1) {
            items[index] = { ...items[index], ...updatedItem, updatedAt: getCurrentDateTime() };
            return StorageManager.save(key, items);
        }
        return false;
    },
    
    // X√≥a
    delete(key, id) {
        const items = this.getAll(key);
        const filtered = items.filter(item => item.id !== id);
        return StorageManager.save(key, filtered);
    },
    
    // T√¨m ki·∫øm
    search(key, field, value) {
        const items = this.getAll(key);
        return items.filter(item => 
            item[field] && item[field].toString().toLowerCase().includes(value.toLowerCase())
        );
    },
    
    // L·ªçc theo ƒëi·ªÅu ki·ªán
    filter(key, condition) {
        const items = this.getAll(key);
        return items.filter(condition);
    },
};

// ------------------------------------------------------------
// 7. D·ªÆ LI·ªÜU M·∫™U KH·ªûI T·∫†O
// ------------------------------------------------------------

// 7.1. M√¥n h·ªçc (5 m√¥n)
const SAMPLE_SUBJECTS = [
    {
        id: 'MH001',
        code: 'CV',
        name: 'C·ªù vua',
        description: 'M√¥n c·ªù vua c∆° b·∫£n cho tr·∫ª em',
        color: '#3b82f6',
        pricePerSession: 80000,
        sessionDuration: 90,
        isActive: true,
        createdAt: '2025-01-01',
    },
    {
        id: 'MH002',
        code: 'MT',
        name: 'M·ªπ thu·∫≠t',
        description: 'V·∫Ω v√† t√¥ m√†u s√°ng t·∫°o',
        color: '#f59e0b',
        pricePerSession: 100000,
        sessionDuration: 90,
        isActive: true,
        createdAt: '2025-01-01',
    },
    {
        id: 'MH003',
        code: 'TTD',
        name: 'To√°n t∆∞ duy',
        description: 'Ph√°t tri·ªÉn t∆∞ duy logic',
        color: '#10b981',
        pricePerSession: 120000,
        sessionDuration: 90,
        isActive: true,
        createdAt: '2025-01-01',
    },
    {
        id: 'MH004',
        code: 'TA',
        name: 'Ti·∫øng Anh',
        description: 'Ti·∫øng Anh giao ti·∫øp cho tr·∫ª em',
        color: '#ef4444',
        pricePerSession: 150000,
        sessionDuration: 90,
        isActive: true,
        createdAt: '2025-01-01',
    },
    {
        id: 'MH005',
        code: 'DK',
        name: 'Nh·∫£y Dance Kids',
        description: 'Nh·∫£y hi·ªán ƒë·∫°i cho tr·∫ª',
        color: '#8b5cf6',
        pricePerSession: 100000,
        sessionDuration: 60,
        isActive: true,
        createdAt: '2025-01-01',
    },
];

// 7.2. Ph√≤ng h·ªçc (3 ph√≤ng)
const SAMPLE_ROOMS = [
    {
        id: 'PH001',
        name: 'Ph√≤ng 101',
        capacity: 15,
        equipment: ['B·∫£ng tr·∫Øng', 'M√°y chi·∫øu', 'ƒêi·ªÅu h√≤a'],
        status: STATUS.GENERAL.ACTIVE,
        notes: 'Ph√≤ng h·ªçc l·ªõn, tho√°ng m√°t',
        createdAt: '2025-01-01',
    },
    {
        id: 'PH002',
        name: 'Ph√≤ng 102',
        capacity: 12,
        equipment: ['B·∫£ng tr·∫Øng', 'ƒêi·ªÅu h√≤a'],
        status: STATUS.GENERAL.ACTIVE,
        notes: 'Ph√≤ng h·ªçc v·ª´a',
        createdAt: '2025-01-01',
    },
    {
        id: 'PH003',
        name: 'Ph√≤ng VIP',
        capacity: 8,
        equipment: ['B·∫£ng tr·∫Øng', 'M√°y chi·∫øu', 'ƒêi·ªÅu h√≤a', 'Loa', 'Micro'],
        status: STATUS.GENERAL.ACTIVE,
        notes: 'Ph√≤ng VIP cho l·ªõp nh·ªè',
        createdAt: '2025-01-01',
    },
];

// 7.3. Gi√°o vi√™n (4 gi√°o vi√™n)
const SAMPLE_TEACHERS = [
    {
        id: 'GV001',
        code: 'GV001',
        name: 'Nguy·ªÖn VƒÉn An',
        phone: '0901234001',
        email: 'nva@ttdayhoc.edu.vn',
        address: '123 ƒê∆∞·ªùng A, Qu·∫≠n 1',
        dateOfBirth: '1990-05-15',
        gender: 'Nam',
        idNumber: '079123001',
        subjects: ['MH001'], // C·ªù vua
        qualifications: 'C·ª≠ nh√¢n S∆∞ ph·∫°m',
        experience: '5 nƒÉm',
        contractType: STATUS.TEACHER_CONTRACT.FULL_TIME,
        startDate: '2023-01-01',
        salary: 8000000,
        ratePerSession: null,
        status: STATUS.GENERAL.ACTIVE,
        avatar: null,
        notes: 'Gi√°o vi√™n gi·ªèi, c√≥ kinh nghi·ªám',
        createdAt: '2023-01-01',
    },
    {
        id: 'GV002',
        code: 'GV002',
        name: 'Tr·∫ßn Th·ªã B√¨nh',
        phone: '0901234002',
        email: 'ttb@ttdayhoc.edu.vn',
        address: '456 ƒê∆∞·ªùng B, Qu·∫≠n 2',
        dateOfBirth: '1992-08-20',
        gender: 'N·ªØ',
        idNumber: '079123002',
        subjects: ['MH002'], // M·ªπ thu·∫≠t
        qualifications: 'C·ª≠ nh√¢n M·ªπ thu·∫≠t',
        experience: '4 nƒÉm',
        contractType: STATUS.TEACHER_CONTRACT.FULL_TIME,
        startDate: '2023-06-01',
        salary: 7500000,
        ratePerSession: null,
        status: STATUS.GENERAL.ACTIVE,
        avatar: null,
        notes: '',
        createdAt: '2023-06-01',
    },
    {
        id: 'GV003',
        code: 'GV003',
        name: 'L√™ Minh C∆∞·ªùng',
        phone: '0901234003',
        email: 'lmc@ttdayhoc.edu.vn',
        address: '789 ƒê∆∞·ªùng C, Qu·∫≠n 3',
        dateOfBirth: '1988-03-10',
        gender: 'Nam',
        idNumber: '079123003',
        subjects: ['MH003', 'MH004'], // To√°n t∆∞ duy, Ti·∫øng Anh
        qualifications: 'Th·∫°c sƒ© Gi√°o d·ª•c',
        experience: '7 nƒÉm',
        contractType: STATUS.TEACHER_CONTRACT.PART_TIME,
        startDate: '2024-01-01',
        salary: null,
        ratePerSession: 200000,
        status: STATUS.GENERAL.ACTIVE,
        avatar: null,
        notes: 'D·∫°y part-time',
        createdAt: '2024-01-01',
    },
    {
        id: 'GV004',
        code: 'GV004',
        name: 'Ph·∫°m Thu H√†',
        phone: '0901234004',
        email: 'pth@ttdayhoc.edu.vn',
        address: '321 ƒê∆∞·ªùng D, Qu·∫≠n 4',
        dateOfBirth: '1995-11-25',
        gender: 'N·ªØ',
        idNumber: '079123004',
        subjects: ['MH005'], // Dance Kids
        qualifications: 'C·ª≠ nh√¢n M√∫a',
        experience: '3 nƒÉm',
        contractType: STATUS.TEACHER_CONTRACT.FULL_TIME,
        startDate: '2024-09-01',
        salary: 7000000,
        ratePerSession: null,
        status: STATUS.GENERAL.ACTIVE,
        avatar: null,
        notes: 'Gi√°o vi√™n tr·∫ª, nƒÉng ƒë·ªông',
        createdAt: '2024-09-01',
    },
];

console.log('‚úÖ Task 1.1 - Ph·∫ßn 1/3: C·∫•u tr√∫c d·ªØ li·ªáu ƒë√£ load');

// ============================================================
// PH·∫¶N 2/3: D·ªÆ LI·ªÜU M·∫™U - PH·ª§ HUYNH, H·ªåC VI√äN, L·ªöP H·ªåC
// ============================================================

// 7.4. Ph·ª• huynh (6 ph·ª• huynh)
const SAMPLE_PARENTS = [
    {
        id: 'PH001',
        name: 'Tr·∫ßn VƒÉn H√πng',
        relationship: 'B·ªë',
        phone: '0912345001',
        phoneBackup: '0923456001',
        email: 'tvhung@gmail.com',
        address: '100 ƒê∆∞·ªùng L√™ L·ª£i, Qu·∫≠n 1',
        occupation: 'K·ªπ s∆∞',
        studentIds: ['HV001', 'HV002'], // 2 con
        notes: '',
        createdAt: '2025-01-01',
    },
    {
        id: 'PH002',
        name: 'Nguy·ªÖn Th·ªã Mai',
        relationship: 'M·∫π',
        phone: '0912345002',
        phoneBackup: '',
        email: 'ntmai@gmail.com',
        address: '200 ƒê∆∞·ªùng Nguy·ªÖn Hu·ªá, Qu·∫≠n 1',
        occupation: 'Gi√°o vi√™n',
        studentIds: ['HV003'],
        notes: 'G·ªçi ƒëi·ªán sau 18h',
        createdAt: '2025-01-01',
    },
    {
        id: 'PH003',
        name: 'L√™ Minh Tu·∫•n',
        relationship: 'B·ªë',
        phone: '0912345003',
        phoneBackup: '0923456003',
        email: 'lmtuan@gmail.com',
        address: '300 ƒê∆∞·ªùng Tr·∫ßn H∆∞ng ƒê·∫°o, Qu·∫≠n 5',
        occupation: 'B√°c sƒ©',
        studentIds: ['HV004', 'HV005'],
        notes: '',
        createdAt: '2025-01-01',
    },
    {
        id: 'PH004',
        name: 'Ph·∫°m Th·ªã Lan',
        relationship: 'M·∫π',
        phone: '0912345004',
        phoneBackup: '',
        email: 'ptlan@gmail.com',
        address: '400 ƒê∆∞·ªùng V√µ VƒÉn Ki·ªát, Qu·∫≠n 6',
        occupation: 'Nh√¢n vi√™n vƒÉn ph√≤ng',
        studentIds: ['HV006'],
        notes: '',
        createdAt: '2025-01-01',
    },
    {
        id: 'PH005',
        name: 'Ho√†ng VƒÉn Nam',
        relationship: 'B·ªë',
        phone: '0912345005',
        phoneBackup: '0923456005',
        email: 'hvnam@gmail.com',
        address: '500 ƒê∆∞·ªùng ƒêi·ªán Bi√™n Ph·ªß, Qu·∫≠n 3',
        occupation: 'Kinh doanh',
        studentIds: ['HV007', 'HV008'],
        notes: 'Ph·ª• huynh t√≠ch c·ª±c',
        createdAt: '2025-01-01',
    },
    {
        id: 'PH006',
        name: 'V≈© Th·ªã Hoa',
        relationship: 'M·∫π',
        phone: '0912345006',
        phoneBackup: '',
        email: 'vthoa@gmail.com',
        address: '600 ƒê∆∞·ªùng C√°ch M·∫°ng Th√°ng 8, Qu·∫≠n 10',
        occupation: 'K·∫ø to√°n',
        studentIds: ['HV009', 'HV010'],
        notes: '',
        createdAt: '2025-01-01',
    },
];

// 7.5. H·ªçc vi√™n (10 h·ªçc vi√™n)
const SAMPLE_STUDENTS = [
    {
        id: 'HV001',
        code: 'HV001',
        name: 'Tr·∫ßn Minh An',
        dateOfBirth: '2017-03-15',
        gender: 'Nam',
        avatar: null,
        parentId: 'PH001',
        parentName: 'Tr·∫ßn VƒÉn H√πng',
        parentPhone: '0912345001',
        enrollmentDate: '2024-12-01',
        referralSource: 'Facebook',
        status: STATUS.STUDENT.ACTIVE,
        healthNotes: '',
        notes: 'H·ªçc sinh nƒÉng ƒë·ªông',
        createdAt: '2024-12-01',
        updatedAt: '2024-12-01',
    },
    {
        id: 'HV002',
        code: 'HV002',
        name: 'Tr·∫ßn Minh Ch√¢u',
        dateOfBirth: '2018-07-20',
        gender: 'N·ªØ',
        avatar: null,
        parentId: 'PH001',
        parentName: 'Tr·∫ßn VƒÉn H√πng',
        parentPhone: '0912345001',
        enrollmentDate: '2024-12-01',
        referralSource: 'Facebook',
        status: STATUS.STUDENT.ACTIVE,
        healthNotes: '',
        notes: 'Em g√°i c·ªßa Minh An',
        createdAt: '2024-12-01',
        updatedAt: '2024-12-01',
    },
    {
        id: 'HV003',
        code: 'HV003',
        name: 'Nguy·ªÖn Th√†nh ƒê·∫°t',
        dateOfBirth: '2016-11-10',
        gender: 'Nam',
        avatar: null,
        parentId: 'PH002',
        parentName: 'Nguy·ªÖn Th·ªã Mai',
        parentPhone: '0912345002',
        enrollmentDate: '2024-11-15',
        referralSource: 'B·∫°n b√® gi·ªõi thi·ªáu',
        status: STATUS.STUDENT.ACTIVE,
        healthNotes: '',
        notes: '',
        createdAt: '2024-11-15',
        updatedAt: '2024-11-15',
    },
    {
        id: 'HV004',
        code: 'HV004',
        name: 'L√™ Ho√†ng Nam',
        dateOfBirth: '2017-05-25',
        gender: 'Nam',
        avatar: null,
        parentId: 'PH003',
        parentName: 'L√™ Minh Tu·∫•n',
        parentPhone: '0912345003',
        enrollmentDate: '2025-01-05',
        referralSource: 'Website',
        status: STATUS.STUDENT.NEW,
        healthNotes: 'D·ªã ·ª©ng ƒë·∫≠u ph·ªông',
        notes: 'H·ªçc vi√™n m·ªõi',
        createdAt: '2025-01-05',
        updatedAt: '2025-01-05',
    },
    {
        id: 'HV005',
        code: 'HV005',
        name: 'L√™ Ho√†ng Y·∫øn',
        dateOfBirth: '2018-09-12',
        gender: 'N·ªØ',
        avatar: null,
        parentId: 'PH003',
        parentName: 'L√™ Minh Tu·∫•n',
        parentPhone: '0912345003',
        enrollmentDate: '2025-01-05',
        referralSource: 'Website',
        status: STATUS.STUDENT.NEW,
        healthNotes: '',
        notes: 'Ch·ªã em v·ªõi Ho√†ng Nam',
        createdAt: '2025-01-05',
        updatedAt: '2025-01-05',
    },
    {
        id: 'HV006',
        code: 'HV006',
        name: 'Ph·∫°m Minh Kh√¥i',
        dateOfBirth: '2017-02-28',
        gender: 'Nam',
        avatar: null,
        parentId: 'PH004',
        parentName: 'Ph·∫°m Th·ªã Lan',
        parentPhone: '0912345004',
        enrollmentDate: '2024-10-20',
        referralSource: 'Zalo',
        status: STATUS.STUDENT.ACTIVE,
        healthNotes: '',
        notes: '',
        createdAt: '2024-10-20',
        updatedAt: '2024-10-20',
    },
    {
        id: 'HV007',
        code: 'HV007',
        name: 'Ho√†ng Gia B·∫£o',
        dateOfBirth: '2016-12-05',
        gender: 'Nam',
        avatar: null,
        parentId: 'PH005',
        parentName: 'Ho√†ng VƒÉn Nam',
        parentPhone: '0912345005',
        enrollmentDate: '2024-09-01',
        referralSource: 'B·∫°n b√® gi·ªõi thi·ªáu',
        status: STATUS.STUDENT.ACTIVE,
        healthNotes: '',
        notes: 'H·ªçc sinh chƒÉm ch·ªâ',
        createdAt: '2024-09-01',
        updatedAt: '2024-09-01',
    },
    {
        id: 'HV008',
        code: 'HV008',
        name: 'Ho√†ng Gia H√¢n',
        dateOfBirth: '2018-04-18',
        gender: 'N·ªØ',
        avatar: null,
        parentId: 'PH005',
        parentName: 'Ho√†ng VƒÉn Nam',
        parentPhone: '0912345005',
        enrollmentDate: '2024-09-01',
        referralSource: 'B·∫°n b√® gi·ªõi thi·ªáu',
        status: STATUS.STUDENT.ACTIVE,
        healthNotes: '',
        notes: 'Em g√°i c·ªßa Gia B·∫£o',
        createdAt: '2024-09-01',
        updatedAt: '2024-09-01',
    },
    {
        id: 'HV009',
        code: 'HV009',
        name: 'V≈© Minh Anh',
        dateOfBirth: '2017-08-30',
        gender: 'N·ªØ',
        avatar: null,
        parentId: 'PH006',
        parentName: 'V≈© Th·ªã Hoa',
        parentPhone: '0912345006',
        enrollmentDate: '2025-01-10',
        referralSource: 'Google',
        status: STATUS.STUDENT.TRIAL,
        healthNotes: '',
        notes: 'ƒêang h·ªçc th·ª≠',
        createdAt: '2025-01-10',
        updatedAt: '2025-01-10',
    },
    {
        id: 'HV010',
        code: 'HV010',
        name: 'V≈© Minh T√¢m',
        dateOfBirth: '2019-01-22',
        gender: 'Nam',
        avatar: null,
        parentId: 'PH006',
        parentName: 'V≈© Th·ªã Hoa',
        parentPhone: '0912345006',
        enrollmentDate: '2025-01-10',
        referralSource: 'Google',
        status: STATUS.STUDENT.TRIAL,
        healthNotes: '',
        notes: 'ƒêang h·ªçc th·ª≠, anh em v·ªõi Minh Anh',
        createdAt: '2025-01-10',
        updatedAt: '2025-01-10',
    },
];

// 7.6. L·ªõp h·ªçc (6 l·ªõp h·ªçc)
const SAMPLE_CLASSES = [
    {
        id: 'LH001',
        code: 'CV8-T2T4-17h',
        name: 'C·ªù vua 8 bu·ªïi - T2,T4 - 17h00',
        subjectId: 'MH001',
        subjectName: 'C·ªù vua',
        level: 'beginner',
        teacherId: 'GV001',
        teacherName: 'Nguy·ªÖn VƒÉn An',
        assistantId: null,
        roomId: 'PH001',
        roomName: 'Ph√≤ng 101',
        schedule: [
            { dayOfWeek: 2, startTime: '17:00', endTime: '18:30' }, // Th·ª© 2
            { dayOfWeek: 4, startTime: '17:00', endTime: '18:30' }, // Th·ª© 4
        ],
        classType: 'by-session',
        totalSessions: 8,
        startDate: '2025-01-06',
        endDate: '2025-02-03',
        maxStudents: 12,
        currentStudents: 4,
        status: STATUS.CLASS.ACTIVE,
        pricePerSession: 80000,
        notes: '',
        createdAt: '2024-12-20',
    },
    {
        id: 'LH002',
        code: 'MT8-T3T5-16h',
        name: 'M·ªπ thu·∫≠t 8 bu·ªïi - T3,T5 - 16h00',
        subjectId: 'MH002',
        subjectName: 'M·ªπ thu·∫≠t',
        level: 'beginner',
        teacherId: 'GV002',
        teacherName: 'Tr·∫ßn Th·ªã B√¨nh',
        assistantId: null,
        roomId: 'PH002',
        roomName: 'Ph√≤ng 102',
        schedule: [
            { dayOfWeek: 3, startTime: '16:00', endTime: '17:30' }, // Th·ª© 3
            { dayOfWeek: 5, startTime: '16:00', endTime: '17:30' }, // Th·ª© 5
        ],
        classType: 'by-session',
        totalSessions: 8,
        startDate: '2025-01-07',
        endDate: '2025-02-04',
        maxStudents: 12,
        currentStudents: 3,
        status: STATUS.CLASS.ACTIVE,
        pricePerSession: 100000,
        notes: '',
        createdAt: '2024-12-20',
    },
    {
        id: 'LH003',
        code: 'TTD12-T2T4T6-18h',
        name: 'To√°n t∆∞ duy 12 bu·ªïi - T2,T4,T6 - 18h00',
        subjectId: 'MH003',
        subjectName: 'To√°n t∆∞ duy',
        level: 'intermediate',
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        assistantId: null,
        roomId: 'PH003',
        roomName: 'Ph√≤ng VIP',
        schedule: [
            { dayOfWeek: 2, startTime: '18:00', endTime: '19:30' },
            { dayOfWeek: 4, startTime: '18:00', endTime: '19:30' },
            { dayOfWeek: 6, startTime: '18:00', endTime: '19:30' },
        ],
        classType: 'by-session',
        totalSessions: 12,
        startDate: '2025-01-06',
        endDate: '2025-01-31',
        maxStudents: 8,
        currentStudents: 2,
        status: STATUS.CLASS.ACTIVE,
        pricePerSession: 120000,
        notes: 'L·ªõp n√¢ng cao',
        createdAt: '2024-12-20',
    },
    {
        id: 'LH004',
        code: 'TA16-T3T5-17h',
        name: 'Ti·∫øng Anh 16 bu·ªïi - T3,T5 - 17h00',
        subjectId: 'MH004',
        subjectName: 'Ti·∫øng Anh',
        level: 'beginner',
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        assistantId: null,
        roomId: 'PH001',
        roomName: 'Ph√≤ng 101',
        schedule: [
            { dayOfWeek: 3, startTime: '17:00', endTime: '18:30' },
            { dayOfWeek: 5, startTime: '17:00', endTime: '18:30' },
        ],
        classType: 'by-session',
        totalSessions: 16,
        startDate: '2025-01-07',
        endDate: '2025-03-04',
        maxStudents: 10,
        currentStudents: 3,
        status: STATUS.CLASS.ACTIVE,
        pricePerSession: 150000,
        notes: '',
        createdAt: '2024-12-20',
    },
    {
        id: 'LH005',
        code: 'DK8-T7-9h',
        name: 'Dance Kids 8 bu·ªïi - T7 - 9h00',
        subjectId: 'MH005',
        subjectName: 'Nh·∫£y Dance Kids',
        level: 'beginner',
        teacherId: 'GV004',
        teacherName: 'Ph·∫°m Thu H√†',
        assistantId: null,
        roomId: 'PH002',
        roomName: 'Ph√≤ng 102',
        schedule: [
            { dayOfWeek: 7, startTime: '09:00', endTime: '10:00' }, // Th·ª© 7
        ],
        classType: 'by-session',
        totalSessions: 8,
        startDate: '2025-01-11',
        endDate: '2025-03-01',
        maxStudents: 15,
        currentStudents: 2,
        status: STATUS.CLASS.ACTIVE,
        pricePerSession: 100000,
        notes: 'L·ªõp cu·ªëi tu·∫ßn',
        createdAt: '2024-12-20',
    },
    {
        id: 'LH006',
        code: 'CV8-T2T4-19h',
        name: 'C·ªù vua 8 bu·ªïi - T2,T4 - 19h00',
        subjectId: 'MH001',
        subjectName: 'C·ªù vua',
        level: 'beginner',
        teacherId: 'GV001',
        teacherName: 'Nguy·ªÖn VƒÉn An',
        assistantId: null,
        roomId: 'PH001',
        roomName: 'Ph√≤ng 101',
        schedule: [
            { dayOfWeek: 2, startTime: '19:00', endTime: '20:30' },
            { dayOfWeek: 4, startTime: '19:00', endTime: '20:30' },
        ],
        classType: 'by-session',
        totalSessions: 8,
        startDate: '2025-01-20',
        endDate: '2025-02-17',
        maxStudents: 12,
        currentStudents: 1,
        status: STATUS.CLASS.UPCOMING,
        pricePerSession: 80000,
        notes: 'L·ªõp s·∫Øp m·ªü',
        createdAt: '2025-01-05',
    },
];

// 7.7. ƒêƒÉng k√Ω l·ªõp - Enrollments (15 ƒëƒÉng k√Ω)
const SAMPLE_ENROLLMENTS = [
    // L·ªõp LH001 - C·ªù vua 17h (4 h·ªçc vi√™n)
    {
        id: 'DK001',
        studentId: 'HV001',
        studentName: 'Tr·∫ßn Minh An',
        classId: 'LH001',
        className: 'C·ªù vua 8 bu·ªïi - T2,T4 - 17h00',
        packageType: '8-sessions',
        totalSessions: 8,
        usedSessions: 4,
        remainingSessions: 4,
        makeupSessions: 0,
        enrollmentDate: '2024-12-25',
        firstSessionDate: '2025-01-06',
        expiryDate: '2025-03-06',
        status: STATUS.STUDENT.ACTIVE,
        tuitionId: 'HP001',
        notes: '',
        createdAt: '2024-12-25',
    },
    {
        id: 'DK002',
        studentId: 'HV003',
        studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t',
        classId: 'LH001',
        className: 'C·ªù vua 8 bu·ªïi - T2,T4 - 17h00',
        packageType: '8-sessions',
        totalSessions: 8,
        usedSessions: 4,
        remainingSessions: 4,
        makeupSessions: 0,
        enrollmentDate: '2024-12-25',
        firstSessionDate: '2025-01-06',
        expiryDate: '2025-03-06',
        status: STATUS.STUDENT.ACTIVE,
        tuitionId: 'HP002',
        notes: '',
        createdAt: '2024-12-25',
    },
    {
        id: 'DK003',
        studentId: 'HV006',
        studentName: 'Ph·∫°m Minh Kh√¥i',
        classId: 'LH001',
        className: 'C·ªù vua 8 bu·ªïi - T2,T4 - 17h00',
        packageType: '8-sessions',
        totalSessions: 8,
        usedSessions: 4,
        remainingSessions: 4,
        makeupSessions: 0,
        enrollmentDate: '2024-12-25',
        firstSessionDate: '2025-01-06',
        expiryDate: '2025-03-06',
        status: STATUS.STUDENT.ACTIVE,
        tuitionId: 'HP003',
        notes: '',
        createdAt: '2024-12-25',
    },
    {
        id: 'DK004',
        studentId: 'HV007',
        studentName: 'Ho√†ng Gia B·∫£o',
        classId: 'LH001',
        className: 'C·ªù vua 8 bu·ªïi - T2,T4 - 17h00',
        packageType: '8-sessions',
        totalSessions: 8,
        usedSessions: 4,
        remainingSessions: 4,
        makeupSessions: 0,
        enrollmentDate: '2024-12-25',
        firstSessionDate: '2025-01-06',
        expiryDate: '2025-03-06',
        status: STATUS.STUDENT.ACTIVE,
        tuitionId: 'HP004',
        notes: '',
        createdAt: '2024-12-25',
    },
    
    // L·ªõp LH002 - M·ªπ thu·∫≠t (3 h·ªçc vi√™n)
    {
        id: 'DK005',
        studentId: 'HV002',
        studentName: 'Tr·∫ßn Minh Ch√¢u',
        classId: 'LH002',
        className: 'M·ªπ thu·∫≠t 8 bu·ªïi - T3,T5 - 16h00',
        packageType: '8-sessions',
        totalSessions: 8,
        usedSessions: 4,
        remainingSessions: 4,
        makeupSessions: 0,
        enrollmentDate: '2024-12-25',
        firstSessionDate: '2025-01-07',
        expiryDate: '2025-03-07',
        status: STATUS.STUDENT.ACTIVE,
        tuitionId: 'HP005',
        notes: '',
        createdAt: '2024-12-25',
    },
    {
        id: 'DK006',
        studentId: 'HV005',
        studentName: 'L√™ Ho√†ng Y·∫øn',
        classId: 'LH002',
        className: 'M·ªπ thu·∫≠t 8 bu·ªïi - T3,T5 - 16h00',
        packageType: '8-sessions',
        totalSessions: 8,
        usedSessions: 4,
        remainingSessions: 4,
        makeupSessions: 0,
        enrollmentDate: '2025-01-05',
        firstSessionDate: '2025-01-07',
        expiryDate: '2025-03-07',
        status: STATUS.STUDENT.ACTIVE,
        tuitionId: 'HP006',
        notes: '',
        createdAt: '2025-01-05',
    },
    {
        id: 'DK007',
        studentId: 'HV008',
        studentName: 'Ho√†ng Gia H√¢n',
        classId: 'LH002',
        className: 'M·ªπ thu·∫≠t 8 bu·ªïi - T3,T5 - 16h00',
        packageType: '8-sessions',
        totalSessions: 8,
        usedSessions: 4,
        remainingSessions: 4,
        makeupSessions: 0,
        enrollmentDate: '2024-12-25',
        firstSessionDate: '2025-01-07',
        expiryDate: '2025-03-07',
        status: STATUS.STUDENT.ACTIVE,
        tuitionId: 'HP007',
        notes: '',
        createdAt: '2024-12-25',
    },
    
    // L·ªõp LH003 - To√°n t∆∞ duy (2 h·ªçc vi√™n)
    {
        id: 'DK008',
        studentId: 'HV003',
        studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t',
        classId: 'LH003',
        className: 'To√°n t∆∞ duy 12 bu·ªïi - T2,T4,T6 - 18h00',
        packageType: '12-sessions',
        totalSessions: 12,
        usedSessions: 6,
        remainingSessions: 6,
        makeupSessions: 0,
        enrollmentDate: '2024-12-25',
        firstSessionDate: '2025-01-06',
        expiryDate: '2025-04-06',
        status: STATUS.STUDENT.ACTIVE,
        tuitionId: 'HP008',
        notes: '',
        createdAt: '2024-12-25',
    },
    {
        id: 'DK009',
        studentId: 'HV007',
        studentName: 'Ho√†ng Gia B·∫£o',
        classId: 'LH003',
        className: 'To√°n t∆∞ duy 12 bu·ªïi - T2,T4,T6 - 18h00',
        packageType: '12-sessions',
        totalSessions: 12,
        usedSessions: 6,
        remainingSessions: 6,
        makeupSessions: 0,
        enrollmentDate: '2024-12-25',
        firstSessionDate: '2025-01-06',
        expiryDate: '2025-04-06',
        status: STATUS.STUDENT.ACTIVE,
        tuitionId: 'HP009',
        notes: '',
        createdAt: '2024-12-25',
    },
    
    // L·ªõp LH004 - Ti·∫øng Anh (3 h·ªçc vi√™n)
    {
        id: 'DK010',
        studentId: 'HV001',
        studentName: 'Tr·∫ßn Minh An',
        classId: 'LH004',
        className: 'Ti·∫øng Anh 16 bu·ªïi - T3,T5 - 17h00',
        packageType: '16-sessions',
        totalSessions: 16,
        usedSessions: 4,
        remainingSessions: 12,
        makeupSessions: 0,
        enrollmentDate: '2024-12-25',
        firstSessionDate: '2025-01-07',
        expiryDate: '2025-05-07',
        status: STATUS.STUDENT.ACTIVE,
        tuitionId: 'HP010',
        notes: '',
        createdAt: '2024-12-25',
    },
    {
        id: 'DK011',
        studentId: 'HV004',
        studentName: 'L√™ Ho√†ng Nam',
        classId: 'LH004',
        className: 'Ti·∫øng Anh 16 bu·ªïi - T3,T5 - 17h00',
        packageType: '16-sessions',
        totalSessions: 16,
        usedSessions: 4,
        remainingSessions: 12,
        makeupSessions: 0,
        enrollmentDate: '2025-01-05',
        firstSessionDate: '2025-01-07',
        expiryDate: '2025-05-07',
        status: STATUS.STUDENT.ACTIVE,
        tuitionId: 'HP011',
        notes: '',
        createdAt: '2025-01-05',
    },
    {
        id: 'DK012',
        studentId: 'HV006',
        studentName: 'Ph·∫°m Minh Kh√¥i',
        classId: 'LH004',
        className: 'Ti·∫øng Anh 16 bu·ªïi - T3,T5 - 17h00',
        packageType: '16-sessions',
        totalSessions: 16,
        usedSessions: 4,
        remainingSessions: 12,
        makeupSessions: 0,
        enrollmentDate: '2024-12-25',
        firstSessionDate: '2025-01-07',
        expiryDate: '2025-05-07',
        status: STATUS.STUDENT.ACTIVE,
        tuitionId: 'HP012',
        notes: '',
        createdAt: '2024-12-25',
    },
    
    // L·ªõp LH005 - Dance Kids (2 h·ªçc vi√™n)
    {
        id: 'DK013',
        studentId: 'HV009',
        studentName: 'V≈© Minh Anh',
        classId: 'LH005',
        className: 'Dance Kids 8 bu·ªïi - T7 - 9h00',
        packageType: '8-sessions',
        totalSessions: 8,
        usedSessions: 0,
        remainingSessions: 8,
        makeupSessions: 0,
        enrollmentDate: '2025-01-10',
        firstSessionDate: '2025-01-11',
        expiryDate: '2025-03-11',
        status: STATUS.STUDENT.TRIAL,
        tuitionId: 'HP013',
        notes: 'ƒêang h·ªçc th·ª≠',
        createdAt: '2025-01-10',
    },
    {
        id: 'DK014',
        studentId: 'HV010',
        studentName: 'V≈© Minh T√¢m',
        classId: 'LH005',
        className: 'Dance Kids 8 bu·ªïi - T7 - 9h00',
        packageType: '8-sessions',
        totalSessions: 8,
        usedSessions: 0,
        remainingSessions: 8,
        makeupSessions: 0,
        enrollmentDate: '2025-01-10',
        firstSessionDate: '2025-01-11',
        expiryDate: '2025-03-11',
        status: STATUS.STUDENT.TRIAL,
        tuitionId: 'HP014',
        notes: 'ƒêang h·ªçc th·ª≠',
        createdAt: '2025-01-10',
    },
    
    // L·ªõp LH006 - C·ªù vua 19h (1 h·ªçc vi√™n - l·ªõp s·∫Øp m·ªü)
    {
        id: 'DK015',
        studentId: 'HV004',
        studentName: 'L√™ Ho√†ng Nam',
        classId: 'LH006',
        className: 'C·ªù vua 8 bu·ªïi - T2,T4 - 19h00',
        packageType: '8-sessions',
        totalSessions: 8,
        usedSessions: 0,
        remainingSessions: 8,
        makeupSessions: 0,
        enrollmentDate: '2025-01-10',
        firstSessionDate: '2025-01-20',
        expiryDate: '2025-03-20',
        status: STATUS.STUDENT.NEW,
        tuitionId: 'HP015',
        notes: 'ƒêƒÉng k√Ω l·ªõp s·∫Øp m·ªü',
        createdAt: '2025-01-10',
    },
];

console.log('‚úÖ Task 1.1 - Ph·∫ßn 2/3: D·ªØ li·ªáu Ph·ª• huynh, H·ªçc vi√™n, L·ªõp h·ªçc ƒë√£ load');

// ============================================================
// PH·∫¶N 3/3: D·ªÆ LI·ªÜU M·∫™U - BU·ªîI H·ªåC, ƒêI·ªÇM DANH, H·ªåC PH√ç
// ============================================================

// 7.8. Bu·ªïi h·ªçc - Sessions (24 bu·ªïi - 4 bu·ªïi ƒë·∫ßu c·ªßa 6 l·ªõp)
const SAMPLE_SESSIONS = [
    // L·ªõp LH001 - C·ªù vua 17h (4 bu·ªïi)
    {
        id: 'BH001',
        classId: 'LH001',
        sessionNumber: 1,
        date: '2025-01-06',
        dayOfWeek: 2,
        startTime: '17:00',
        endTime: '18:30',
        teacherId: 'GV001',
        teacherName: 'Nguy·ªÖn VƒÉn An',
        isSubstitute: false,
        roomId: 'PH001',
        roomName: 'Ph√≤ng 101',
        topic: 'Gi·ªõi thi·ªáu c·ªù vua',
        content: 'L√†m quen v·ªõi b√†n c·ªù, c√°c qu√¢n c·ªù',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-06',
    },
    {
        id: 'BH002',
        classId: 'LH001',
        sessionNumber: 2,
        date: '2025-01-08',
        dayOfWeek: 4,
        startTime: '17:00',
        endTime: '18:30',
        teacherId: 'GV001',
        teacherName: 'Nguy·ªÖn VƒÉn An',
        isSubstitute: false,
        roomId: 'PH001',
        roomName: 'Ph√≤ng 101',
        topic: 'C√°ch di chuy·ªÉn qu√¢n T·ªët',
        content: 'H·ªçc c√°ch ƒëi c·ªßa qu√¢n T·ªët',
        homework: 'Luy·ªán t·∫≠p ƒëi qu√¢n T·ªët',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-08',
    },
    {
        id: 'BH003',
        classId: 'LH001',
        sessionNumber: 3,
        date: '2025-01-13',
        dayOfWeek: 2,
        startTime: '17:00',
        endTime: '18:30',
        teacherId: 'GV001',
        teacherName: 'Nguy·ªÖn VƒÉn An',
        isSubstitute: false,
        roomId: 'PH001',
        roomName: 'Ph√≤ng 101',
        topic: 'C√°ch di chuy·ªÉn qu√¢n Xe',
        content: 'H·ªçc c√°ch ƒëi c·ªßa qu√¢n Xe',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-13',
    },
    {
        id: 'BH004',
        classId: 'LH001',
        sessionNumber: 4,
        date: '2025-01-15',
        dayOfWeek: 4,
        startTime: '17:00',
        endTime: '18:30',
        teacherId: 'GV001',
        teacherName: 'Nguy·ªÖn VƒÉn An',
        isSubstitute: false,
        roomId: 'PH001',
        roomName: 'Ph√≤ng 101',
        topic: 'C√°ch di chuy·ªÉn qu√¢n T∆∞·ª£ng',
        content: 'H·ªçc c√°ch ƒëi c·ªßa qu√¢n T∆∞·ª£ng',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-15',
    },
    
    // L·ªõp LH002 - M·ªπ thu·∫≠t (4 bu·ªïi)
    {
        id: 'BH005',
        classId: 'LH002',
        sessionNumber: 1,
        date: '2025-01-07',
        dayOfWeek: 3,
        startTime: '16:00',
        endTime: '17:30',
        teacherId: 'GV002',
        teacherName: 'Tr·∫ßn Th·ªã B√¨nh',
        isSubstitute: false,
        roomId: 'PH002',
        roomName: 'Ph√≤ng 102',
        topic: 'V·∫Ω h√¨nh kh·ªëi c∆° b·∫£n',
        content: 'H·ªçc v·∫Ω h√¨nh tr√≤n, vu√¥ng, tam gi√°c',
        homework: 'T·∫≠p v·∫Ω h√¨nh ·ªü nh√†',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-07',
    },
    {
        id: 'BH006',
        classId: 'LH002',
        sessionNumber: 2,
        date: '2025-01-09',
        dayOfWeek: 5,
        startTime: '16:00',
        endTime: '17:30',
        teacherId: 'GV002',
        teacherName: 'Tr·∫ßn Th·ªã B√¨nh',
        isSubstitute: false,
        roomId: 'PH002',
        roomName: 'Ph√≤ng 102',
        topic: 'T√¥ m√†u c∆° b·∫£n',
        content: 'H·ªçc c√°ch ph·ªëi m√†u',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-09',
    },
    {
        id: 'BH007',
        classId: 'LH002',
        sessionNumber: 3,
        date: '2025-01-14',
        dayOfWeek: 3,
        startTime: '16:00',
        endTime: '17:30',
        teacherId: 'GV002',
        teacherName: 'Tr·∫ßn Th·ªã B√¨nh',
        isSubstitute: false,
        roomId: 'PH002',
        roomName: 'Ph√≤ng 102',
        topic: 'V·∫Ω tranh phong c·∫£nh',
        content: 'V·∫Ω c√¢y, m√¢y, m·∫∑t tr·ªùi',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-14',
    },
    {
        id: 'BH008',
        classId: 'LH002',
        sessionNumber: 4,
        date: '2025-01-16',
        dayOfWeek: 5,
        startTime: '16:00',
        endTime: '17:30',
        teacherId: 'GV002',
        teacherName: 'Tr·∫ßn Th·ªã B√¨nh',
        isSubstitute: false,
        roomId: 'PH002',
        roomName: 'Ph√≤ng 102',
        topic: 'V·∫Ω con v·∫≠t',
        content: 'V·∫Ω con m√®o, ch√≥, th·ªè',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-16',
    },
    
    // L·ªõp LH003 - To√°n t∆∞ duy (6 bu·ªïi)
    {
        id: 'BH009',
        classId: 'LH003',
        sessionNumber: 1,
        date: '2025-01-06',
        dayOfWeek: 2,
        startTime: '18:00',
        endTime: '19:30',
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        isSubstitute: false,
        roomId: 'PH003',
        roomName: 'Ph√≤ng VIP',
        topic: 'B√†i to√°n logic c∆° b·∫£n',
        content: 'Gi·∫£i b√†i to√°n suy lu·∫≠n',
        homework: 'L√†m b√†i t·∫≠p trang 5',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-06',
    },
    {
        id: 'BH010',
        classId: 'LH003',
        sessionNumber: 2,
        date: '2025-01-08',
        dayOfWeek: 4,
        startTime: '18:00',
        endTime: '19:30',
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        isSubstitute: false,
        roomId: 'PH003',
        roomName: 'Ph√≤ng VIP',
        topic: 'To√°n ƒë·∫øm n√¢ng cao',
        content: 'ƒê·∫øm s·ªë theo quy lu·∫≠t',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-08',
    },
    {
        id: 'BH011',
        classId: 'LH003',
        sessionNumber: 3,
        date: '2025-01-10',
        dayOfWeek: 6,
        startTime: '18:00',
        endTime: '19:30',
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        isSubstitute: false,
        roomId: 'PH003',
        roomName: 'Ph√≤ng VIP',
        topic: 'H√¨nh h·ªçc kh√¥ng gian',
        content: 'Nh·∫≠n bi·∫øt h√¨nh kh·ªëi 3D',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-10',
    },
    {
        id: 'BH012',
        classId: 'LH003',
        sessionNumber: 4,
        date: '2025-01-13',
        dayOfWeek: 2,
        startTime: '18:00',
        endTime: '19:30',
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        isSubstitute: false,
        roomId: 'PH003',
        roomName: 'Ph√≤ng VIP',
        topic: 'To√°n t∆∞ duy n√¢ng cao',
        content: 'Gi·∫£i b√†i to√°n ph·ª©c t·∫°p',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-13',
    },
    {
        id: 'BH013',
        classId: 'LH003',
        sessionNumber: 5,
        date: '2025-01-15',
        dayOfWeek: 4,
        startTime: '18:00',
        endTime: '19:30',
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        isSubstitute: false,
        roomId: 'PH003',
        roomName: 'Ph√≤ng VIP',
        topic: 'B√†i to√°n t∆∞ duy s√°ng t·∫°o',
        content: 'Gi·∫£i b√†i to√°n m·ªü',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-15',
    },
    {
        id: 'BH014',
        classId: 'LH003',
        sessionNumber: 6,
        date: '2025-01-17',
        dayOfWeek: 6,
        startTime: '18:00',
        endTime: '19:30',
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        isSubstitute: false,
        roomId: 'PH003',
        roomName: 'Ph√≤ng VIP',
        topic: '√în t·∫≠p gi·ªØa kh√≥a',
        content: '√în l·∫°i ki·∫øn th·ª©c ƒë√£ h·ªçc',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-17',
    },
    
    // L·ªõp LH004 - Ti·∫øng Anh (4 bu·ªïi)
    {
        id: 'BH015',
        classId: 'LH004',
        sessionNumber: 1,
        date: '2025-01-07',
        dayOfWeek: 3,
        startTime: '17:00',
        endTime: '18:30',
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        isSubstitute: false,
        roomId: 'PH001',
        roomName: 'Ph√≤ng 101',
        topic: 'Alphabet & Greetings',
        content: 'H·ªçc b·∫£ng ch·ªØ c√°i v√† ch√†o h·ªèi',
        homework: 'H·ªçc thu·ªôc ABC',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-07',
    },
    {
        id: 'BH016',
        classId: 'LH004',
        sessionNumber: 2,
        date: '2025-01-09',
        dayOfWeek: 5,
        startTime: '17:00',
        endTime: '18:30',
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        isSubstitute: false,
        roomId: 'PH001',
        roomName: 'Ph√≤ng 101',
        topic: 'Numbers 1-10',
        content: 'H·ªçc ƒë·∫øm s·ªë t·ª´ 1-10',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-09',
    },
    {
        id: 'BH017',
        classId: 'LH004',
        sessionNumber: 3,
        date: '2025-01-14',
        dayOfWeek: 3,
        startTime: '17:00',
        endTime: '18:30',
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        isSubstitute: false,
        roomId: 'PH001',
        roomName: 'Ph√≤ng 101',
        topic: 'Colors',
        content: 'H·ªçc t√™n c√°c m√†u s·∫Øc',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-14',
    },
    {
        id: 'BH018',
        classId: 'LH004',
        sessionNumber: 4,
        date: '2025-01-16',
        dayOfWeek: 5,
        startTime: '17:00',
        endTime: '18:30',
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        isSubstitute: false,
        roomId: 'PH001',
        roomName: 'Ph√≤ng 101',
        topic: 'Family Members',
        content: 'H·ªçc t·ª´ v·ª±ng v·ªÅ gia ƒë√¨nh',
        homework: '',
        status: STATUS.SESSION.COMPLETED,
        notes: '',
        createdAt: '2025-01-16',
    },
    
    // L·ªõp LH005 - Dance Kids (ch∆∞a c√≥ bu·ªïi n√†o - l·ªõp m·ªõi b·∫Øt ƒë·∫ßu 11/1)
    // Kh√¥ng c√≥ d·ªØ li·ªáu m·∫´u v√¨ ch∆∞a h·ªçc
    
    // L·ªõp LH006 - C·ªù vua 19h (ch∆∞a c√≥ bu·ªïi n√†o - l·ªõp s·∫Øp m·ªü 20/1)
    // Kh√¥ng c√≥ d·ªØ li·ªáu m·∫´u v√¨ ch∆∞a b·∫Øt ƒë·∫ßu
];

// 7.9. ƒêi·ªÉm danh - Attendance (60 records)
const SAMPLE_ATTENDANCE = [
    // Bu·ªïi BH001 - C·ªù vua bu·ªïi 1 (4 h·ªçc vi√™n)
    { id: 'DD001', sessionId: 'BH001', enrollmentId: 'DK001', studentId: 'HV001', studentName: 'Tr·∫ßn Minh An', classId: 'LH001', date: '2025-01-06', sessionNumber: 1, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-06T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-06' },
    { id: 'DD002', sessionId: 'BH001', enrollmentId: 'DK002', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', classId: 'LH001', date: '2025-01-06', sessionNumber: 1, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-06T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-06' },
    { id: 'DD003', sessionId: 'BH001', enrollmentId: 'DK003', studentId: 'HV006', studentName: 'Ph·∫°m Minh Kh√¥i', classId: 'LH001', date: '2025-01-06', sessionNumber: 1, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-06T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-06' },
    { id: 'DD004', sessionId: 'BH001', enrollmentId: 'DK004', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', classId: 'LH001', date: '2025-01-06', sessionNumber: 1, status: STATUS.ATTENDANCE.LATE, lateMinutes: 10, checkedBy: 'admin', checkedAt: '2025-01-06T17:15:00', makeupFromId: null, notes: 'ƒê·∫øn mu·ªôn 10 ph√∫t', createdAt: '2025-01-06' },
    
    // Bu·ªïi BH002 - C·ªù vua bu·ªïi 2 (4 h·ªçc vi√™n)
    { id: 'DD005', sessionId: 'BH002', enrollmentId: 'DK001', studentId: 'HV001', studentName: 'Tr·∫ßn Minh An', classId: 'LH001', date: '2025-01-08', sessionNumber: 2, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-08T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-08' },
    { id: 'DD006', sessionId: 'BH002', enrollmentId: 'DK002', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', classId: 'LH001', date: '2025-01-08', sessionNumber: 2, status: STATUS.ATTENDANCE.ABSENT_EXCUSED, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-08T17:05:00', makeupFromId: null, notes: '·ªêm', createdAt: '2025-01-08' },
    { id: 'DD007', sessionId: 'BH002', enrollmentId: 'DK003', studentId: 'HV006', studentName: 'Ph·∫°m Minh Kh√¥i', classId: 'LH001', date: '2025-01-08', sessionNumber: 2, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-08T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-08' },
    { id: 'DD008', sessionId: 'BH002', enrollmentId: 'DK004', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', classId: 'LH001', date: '2025-01-08', sessionNumber: 2, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-08T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-08' },
    
    // Bu·ªïi BH003 - C·ªù vua bu·ªïi 3 (4 h·ªçc vi√™n)
    { id: 'DD009', sessionId: 'BH003', enrollmentId: 'DK001', studentId: 'HV001', studentName: 'Tr·∫ßn Minh An', classId: 'LH001', date: '2025-01-13', sessionNumber: 3, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-13T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-13' },
    { id: 'DD010', sessionId: 'BH003', enrollmentId: 'DK002', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', classId: 'LH001', date: '2025-01-13', sessionNumber: 3, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-13T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-13' },
    { id: 'DD011', sessionId: 'BH003', enrollmentId: 'DK003', studentId: 'HV006', studentName: 'Ph·∫°m Minh Kh√¥i', classId: 'LH001', date: '2025-01-13', sessionNumber: 3, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-13T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-13' },
    { id: 'DD012', sessionId: 'BH003', enrollmentId: 'DK004', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', classId: 'LH001', date: '2025-01-13', sessionNumber: 3, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-13T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-13' },
    
    // Bu·ªïi BH004 - C·ªù vua bu·ªïi 4 (4 h·ªçc vi√™n)
    { id: 'DD013', sessionId: 'BH004', enrollmentId: 'DK001', studentId: 'HV001', studentName: 'Tr·∫ßn Minh An', classId: 'LH001', date: '2025-01-15', sessionNumber: 4, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-15T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-15' },
    { id: 'DD014', sessionId: 'BH004', enrollmentId: 'DK002', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', classId: 'LH001', date: '2025-01-15', sessionNumber: 4, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-15T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-15' },
    { id: 'DD015', sessionId: 'BH004', enrollmentId: 'DK003', studentId: 'HV006', studentName: 'Ph·∫°m Minh Kh√¥i', classId: 'LH001', date: '2025-01-15', sessionNumber: 4, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-15T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-15' },
    { id: 'DD016', sessionId: 'BH004', enrollmentId: 'DK004', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', classId: 'LH001', date: '2025-01-15', sessionNumber: 4, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-15T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-15' },
    
    // Bu·ªïi BH005-BH008 - M·ªπ thu·∫≠t (3 h·ªçc vi√™n x 4 bu·ªïi = 12 records)
    { id: 'DD017', sessionId: 'BH005', enrollmentId: 'DK005', studentId: 'HV002', studentName: 'Tr·∫ßn Minh Ch√¢u', classId: 'LH002', date: '2025-01-07', sessionNumber: 1, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-07T16:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-07' },
    { id: 'DD018', sessionId: 'BH005', enrollmentId: 'DK006', studentId: 'HV005', studentName: 'L√™ Ho√†ng Y·∫øn', classId: 'LH002', date: '2025-01-07', sessionNumber: 1, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-07T16:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-07' },
    { id: 'DD019', sessionId: 'BH005', enrollmentId: 'DK007', studentId: 'HV008', studentName: 'Ho√†ng Gia H√¢n', classId: 'LH002', date: '2025-01-07', sessionNumber: 1, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-07T16:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-07' },
    
    { id: 'DD020', sessionId: 'BH006', enrollmentId: 'DK005', studentId: 'HV002', studentName: 'Tr·∫ßn Minh Ch√¢u', classId: 'LH002', date: '2025-01-09', sessionNumber: 2, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-09T16:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-09' },
    { id: 'DD021', sessionId: 'BH006', enrollmentId: 'DK006', studentId: 'HV005', studentName: 'L√™ Ho√†ng Y·∫øn', classId: 'LH002', date: '2025-01-09', sessionNumber: 2, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-09T16:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-09' },
    { id: 'DD022', sessionId: 'BH006', enrollmentId: 'DK007', studentId: 'HV008', studentName: 'Ho√†ng Gia H√¢n', classId: 'LH002', date: '2025-01-09', sessionNumber: 2, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-09T16:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-09' },
    
    { id: 'DD023', sessionId: 'BH007', enrollmentId: 'DK005', studentId: 'HV002', studentName: 'Tr·∫ßn Minh Ch√¢u', classId: 'LH002', date: '2025-01-14', sessionNumber: 3, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-14T16:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-14' },
    { id: 'DD024', sessionId: 'BH007', enrollmentId: 'DK006', studentId: 'HV005', studentName: 'L√™ Ho√†ng Y·∫øn', classId: 'LH002', date: '2025-01-14', sessionNumber: 3, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-14T16:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-14' },
    { id: 'DD025', sessionId: 'BH007', enrollmentId: 'DK007', studentId: 'HV008', studentName: 'Ho√†ng Gia H√¢n', classId: 'LH002', date: '2025-01-14', sessionNumber: 3, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-14T16:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-14' },
    
    { id: 'DD026', sessionId: 'BH008', enrollmentId: 'DK005', studentId: 'HV002', studentName: 'Tr·∫ßn Minh Ch√¢u', classId: 'LH002', date: '2025-01-16', sessionNumber: 4, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-16T16:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-16' },
    { id: 'DD027', sessionId: 'BH008', enrollmentId: 'DK006', studentId: 'HV005', studentName: 'L√™ Ho√†ng Y·∫øn', classId: 'LH002', date: '2025-01-16', sessionNumber: 4, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-16T16:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-16' },
    { id: 'DD028', sessionId: 'BH008', enrollmentId: 'DK007', studentId: 'HV008', studentName: 'Ho√†ng Gia H√¢n', classId: 'LH002', date: '2025-01-16', sessionNumber: 4, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-16T16:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-16' },
    
    // Bu·ªïi BH009-BH014 - To√°n t∆∞ duy (2 h·ªçc vi√™n x 6 bu·ªïi = 12 records)
    { id: 'DD029', sessionId: 'BH009', enrollmentId: 'DK008', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', classId: 'LH003', date: '2025-01-06', sessionNumber: 1, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-06T18:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-06' },
    { id: 'DD030', sessionId: 'BH009', enrollmentId: 'DK009', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', classId: 'LH003', date: '2025-01-06', sessionNumber: 1, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-06T18:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-06' },
    
    { id: 'DD031', sessionId: 'BH010', enrollmentId: 'DK008', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', classId: 'LH003', date: '2025-01-08', sessionNumber: 2, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-08T18:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-08' },
    { id: 'DD032', sessionId: 'BH010', enrollmentId: 'DK009', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', classId: 'LH003', date: '2025-01-08', sessionNumber: 2, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-08T18:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-08' },
    
    { id: 'DD033', sessionId: 'BH011', enrollmentId: 'DK008', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', classId: 'LH003', date: '2025-01-10', sessionNumber: 3, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-10T18:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-10' },
    { id: 'DD034', sessionId: 'BH011', enrollmentId: 'DK009', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', classId: 'LH003', date: '2025-01-10', sessionNumber: 3, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-10T18:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-10' },
    
    { id: 'DD035', sessionId: 'BH012', enrollmentId: 'DK008', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', classId: 'LH003', date: '2025-01-13', sessionNumber: 4, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-13T18:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-13' },
    { id: 'DD036', sessionId: 'BH012', enrollmentId: 'DK009', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', classId: 'LH003', date: '2025-01-13', sessionNumber: 4, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-13T18:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-13' },
    
    { id: 'DD037', sessionId: 'BH013', enrollmentId: 'DK008', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', classId: 'LH003', date: '2025-01-15', sessionNumber: 5, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-15T18:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-15' },
    { id: 'DD038', sessionId: 'BH013', enrollmentId: 'DK009', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', classId: 'LH003', date: '2025-01-15', sessionNumber: 5, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-15T18:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-15' },
    
    { id: 'DD039', sessionId: 'BH014', enrollmentId: 'DK008', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', classId: 'LH003', date: '2025-01-17', sessionNumber: 6, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-17T18:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-17' },
    { id: 'DD040', sessionId: 'BH014', enrollmentId: 'DK009', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', classId: 'LH003', date: '2025-01-17', sessionNumber: 6, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-17T18:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-17' },
    
    // Bu·ªïi BH015-BH018 - Ti·∫øng Anh (3 h·ªçc vi√™n x 4 bu·ªïi = 12 records)
    { id: 'DD041', sessionId: 'BH015', enrollmentId: 'DK010', studentId: 'HV001', studentName: 'Tr·∫ßn Minh An', classId: 'LH004', date: '2025-01-07', sessionNumber: 1, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-07T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-07' },
    { id: 'DD042', sessionId: 'BH015', enrollmentId: 'DK011', studentId: 'HV004', studentName: 'L√™ Ho√†ng Nam', classId: 'LH004', date: '2025-01-07', sessionNumber: 1, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-07T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-07' },
    { id: 'DD043', sessionId: 'BH015', enrollmentId: 'DK012', studentId: 'HV006', studentName: 'Ph·∫°m Minh Kh√¥i', classId: 'LH004', date: '2025-01-07', sessionNumber: 1, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-07T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-07' },
    
    { id: 'DD044', sessionId: 'BH016', enrollmentId: 'DK010', studentId: 'HV001', studentName: 'Tr·∫ßn Minh An', classId: 'LH004', date: '2025-01-09', sessionNumber: 2, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-09T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-09' },
    { id: 'DD045', sessionId: 'BH016', enrollmentId: 'DK011', studentId: 'HV004', studentName: 'L√™ Ho√†ng Nam', classId: 'LH004', date: '2025-01-09', sessionNumber: 2, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-09T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-09' },
    { id: 'DD046', sessionId: 'BH016', enrollmentId: 'DK012', studentId: 'HV006', studentName: 'Ph·∫°m Minh Kh√¥i', classId: 'LH004', date: '2025-01-09', sessionNumber: 2, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-09T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-09' },
    
    { id: 'DD047', sessionId: 'BH017', enrollmentId: 'DK010', studentId: 'HV001', studentName: 'Tr·∫ßn Minh An', classId: 'LH004', date: '2025-01-14', sessionNumber: 3, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-14T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-14' },
    { id: 'DD048', sessionId: 'BH017', enrollmentId: 'DK011', studentId: 'HV004', studentName: 'L√™ Ho√†ng Nam', classId: 'LH004', date: '2025-01-14', sessionNumber: 3, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-14T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-14' },
    { id: 'DD049', sessionId: 'BH017', enrollmentId: 'DK012', studentId: 'HV006', studentName: 'Ph·∫°m Minh Kh√¥i', classId: 'LH004', date: '2025-01-14', sessionNumber: 3, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-14T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-14' },
    
    { id: 'DD050', sessionId: 'BH018', enrollmentId: 'DK010', studentId: 'HV001', studentName: 'Tr·∫ßn Minh An', classId: 'LH004', date: '2025-01-16', sessionNumber: 4, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-16T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-16' },
    { id: 'DD051', sessionId: 'BH018', enrollmentId: 'DK011', studentId: 'HV004', studentName: 'L√™ Ho√†ng Nam', classId: 'LH004', date: '2025-01-16', sessionNumber: 4, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-16T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-16' },
    { id: 'DD052', sessionId: 'BH018', enrollmentId: 'DK012', studentId: 'HV006', studentName: 'Ph·∫°m Minh Kh√¥i', classId: 'LH004', date: '2025-01-16', sessionNumber: 4, status: STATUS.ATTENDANCE.PRESENT, lateMinutes: 0, checkedBy: 'admin', checkedAt: '2025-01-16T17:05:00', makeupFromId: null, notes: '', createdAt: '2025-01-16' },
];

// 7.10. H·ªçc b√π - Makeup Requests (3 requests)
const SAMPLE_MAKEUP_REQUESTS = [
    {
        id: 'HB001',
        originalSessionId: 'BH002',
        originalDate: '2025-01-08',
        originalClassId: 'LH001',
        studentId: 'HV003',
        studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t',
        enrollmentId: 'DK002',
        makeupSessionId: null,
        makeupDate: null,
        makeupClassId: null,
        status: STATUS.MAKEUP.PENDING,
        reason: '·ªêm',
        expiryDate: '2025-02-07',
        notes: 'C·∫ßn s·∫Øp x·∫øp h·ªçc b√π',
        createdAt: '2025-01-08',
    },
    {
        id: 'HB002',
        originalSessionId: 'BH002',
        originalDate: '2025-01-08',
        originalClassId: 'LH001',
        studentId: 'HV003',
        studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t',
        enrollmentId: 'DK002',
        makeupSessionId: null,
        makeupDate: null,
        makeupClassId: null,
        status: STATUS.MAKEUP.PENDING,
        reason: 'ƒêi du l·ªãch v·ªõi gia ƒë√¨nh',
        expiryDate: '2025-02-15',
        notes: '',
        createdAt: '2025-01-15',
    },
    {
        id: 'HB003',
        originalSessionId: 'BH007',
        originalDate: '2025-01-14',
        originalClassId: 'LH002',
        studentId: 'HV005',
        studentName: 'L√™ Ho√†ng Y·∫øn',
        enrollmentId: 'DK006',
        makeupSessionId: null,
        makeupDate: null,
        makeupClassId: null,
        status: STATUS.MAKEUP.PENDING,
        reason: 'B·∫≠n vi·ªác gia ƒë√¨nh',
        expiryDate: '2025-02-13',
        notes: '',
        createdAt: '2025-01-14',
    },
];

// 7.11. H·ªçc ph√≠ - Tuitions (15 h√≥a ƒë∆°n)
const SAMPLE_TUITIONS = [
    // L·ªõp C·ªù vua LH001 (4 h·ªçc vi√™n)
    { id: 'HP001', studentId: 'HV001', studentName: 'Tr·∫ßn Minh An', parentId: 'PH001', enrollmentId: 'DK001', classId: 'LH001', className: 'C·ªù vua 8 bu·ªïi - T2,T4 - 17h00', subjectName: 'C·ªù vua', packageName: 'G√≥i 8 bu·ªïi', totalSessions: 8, pricePerSession: 80000, subtotal: 640000, discountType: 'none', discountValue: 0, discountAmount: 0, totalAmount: 640000, paidAmount: 640000, debtAmount: 0, paymentStatus: STATUS.PAYMENT.PAID, promotionId: null, promotionName: '', invoiceDate: '2024-12-25', dueDate: '2025-01-05', notes: '', createdAt: '2024-12-25' },
    { id: 'HP002', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', parentId: 'PH002', enrollmentId: 'DK002', classId: 'LH001', className: 'C·ªù vua 8 bu·ªïi - T2,T4 - 17h00', subjectName: 'C·ªù vua', packageName: 'G√≥i 8 bu·ªïi', totalSessions: 8, pricePerSession: 80000, subtotal: 640000, discountType: 'none', discountValue: 0, discountAmount: 0, totalAmount: 640000, paidAmount: 640000, debtAmount: 0, paymentStatus: STATUS.PAYMENT.PAID, promotionId: null, promotionName: '', invoiceDate: '2024-12-25', dueDate: '2025-01-05', notes: '', createdAt: '2024-12-25' },
    { id: 'HP003', studentId: 'HV006', studentName: 'Ph·∫°m Minh Kh√¥i', parentId: 'PH004', enrollmentId: 'DK003', classId: 'LH001', className: 'C·ªù vua 8 bu·ªïi - T2,T4 - 17h00', subjectName: 'C·ªù vua', packageName: 'G√≥i 8 bu·ªïi', totalSessions: 8, pricePerSession: 80000, subtotal: 640000, discountType: 'none', discountValue: 0, discountAmount: 0, totalAmount: 640000, paidAmount: 640000, debtAmount: 0, paymentStatus: STATUS.PAYMENT.PAID, promotionId: null, promotionName: '', invoiceDate: '2024-12-25', dueDate: '2025-01-05', notes: '', createdAt: '2024-12-25' },
    { id: 'HP004', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', parentId: 'PH005', enrollmentId: 'DK004', classId: 'LH001', className: 'C·ªù vua 8 bu·ªïi - T2,T4 - 17h00', subjectName: 'C·ªù vua', packageName: 'G√≥i 8 bu·ªïi', totalSessions: 8, pricePerSession: 80000, subtotal: 640000, discountType: 'percent', discountValue: 10, discountAmount: 64000, totalAmount: 576000, paidAmount: 576000, debtAmount: 0, paymentStatus: STATUS.PAYMENT.PAID, promotionId: 'KM001', promotionName: 'Gi·∫£m 10% h·ªçc vi√™n m·ªõi', invoiceDate: '2024-12-25', dueDate: '2025-01-05', notes: '√Åp d·ª•ng khuy·∫øn m√£i', createdAt: '2024-12-25' },
    
    // L·ªõp M·ªπ thu·∫≠t LH002 (3 h·ªçc vi√™n)
    { id: 'HP005', studentId: 'HV002', studentName: 'Tr·∫ßn Minh Ch√¢u', parentId: 'PH001', enrollmentId: 'DK005', classId: 'LH002', className: 'M·ªπ thu·∫≠t 8 bu·ªïi - T3,T5 - 16h00', subjectName: 'M·ªπ thu·∫≠t', packageName: 'G√≥i 8 bu·ªïi', totalSessions: 8, pricePerSession: 100000, subtotal: 800000, discountType: 'none', discountValue: 0, discountAmount: 0, totalAmount: 800000, paidAmount: 800000, debtAmount: 0, paymentStatus: STATUS.PAYMENT.PAID, promotionId: null, promotionName: '', invoiceDate: '2024-12-25', dueDate: '2025-01-05', notes: '', createdAt: '2024-12-25' },
    { id: 'HP006', studentId: 'HV005', studentName: 'L√™ Ho√†ng Y·∫øn', parentId: 'PH003', enrollmentId: 'DK006', classId: 'LH002', className: 'M·ªπ thu·∫≠t 8 bu·ªïi - T3,T5 - 16h00', subjectName: 'M·ªπ thu·∫≠t', packageName: 'G√≥i 8 bu·ªïi', totalSessions: 8, pricePerSession: 100000, subtotal: 800000, discountType: 'percent', discountValue: 10, discountAmount: 80000, totalAmount: 720000, paidAmount: 720000, debtAmount: 0, paymentStatus: STATUS.PAYMENT.PAID, promotionId: 'KM001', promotionName: 'Gi·∫£m 10% h·ªçc vi√™n m·ªõi', invoiceDate: '2025-01-05', dueDate: '2025-01-12', notes: '', createdAt: '2025-01-05' },
    { id: 'HP007', studentId: 'HV008', studentName: 'Ho√†ng Gia H√¢n', parentId: 'PH005', enrollmentId: 'DK007', classId: 'LH002', className: 'M·ªπ thu·∫≠t 8 bu·ªïi - T3,T5 - 16h00', subjectName: 'M·ªπ thu·∫≠t', packageName: 'G√≥i 8 bu·ªïi', totalSessions: 8, pricePerSession: 100000, subtotal: 800000, discountType: 'none', discountValue: 0, discountAmount: 0, totalAmount: 800000, paidAmount: 800000, debtAmount: 0, paymentStatus: STATUS.PAYMENT.PAID, promotionId: null, promotionName: '', invoiceDate: '2024-12-25', dueDate: '2025-01-05', notes: '', createdAt: '2024-12-25' },
    
    // L·ªõp To√°n t∆∞ duy LH003 (2 h·ªçc vi√™n)
    { id: 'HP008', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', parentId: 'PH002', enrollmentId: 'DK008', classId: 'LH003', className: 'To√°n t∆∞ duy 12 bu·ªïi - T2,T4,T6 - 18h00', subjectName: 'To√°n t∆∞ duy', packageName: 'G√≥i 12 bu·ªïi', totalSessions: 12, pricePerSession: 120000, subtotal: 1440000, discountType: 'none', discountValue: 0, discountAmount: 0, totalAmount: 1440000, paidAmount: 1440000, debtAmount: 0, paymentStatus: STATUS.PAYMENT.PAID, promotionId: null, promotionName: '', invoiceDate: '2024-12-25', dueDate: '2025-01-05', notes: '', createdAt: '2024-12-25' },
    { id: 'HP009', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', parentId: 'PH005', enrollmentId: 'DK009', classId: 'LH003', className: 'To√°n t∆∞ duy 12 bu·ªïi - T2,T4,T6 - 18h00', subjectName: 'To√°n t∆∞ duy', packageName: 'G√≥i 12 bu·ªïi', totalSessions: 12, pricePerSession: 120000, subtotal: 1440000, discountType: 'none', discountValue: 0, discountAmount: 0, totalAmount: 1440000, paidAmount: 1440000, debtAmount: 0, paymentStatus: STATUS.PAYMENT.PAID, promotionId: null, promotionName: '', invoiceDate: '2024-12-25', dueDate: '2025-01-05', notes: '', createdAt: '2024-12-25' },
    
    // L·ªõp Ti·∫øng Anh LH004 (3 h·ªçc vi√™n)
    { id: 'HP010', studentId: 'HV001', studentName: 'Tr·∫ßn Minh An', parentId: 'PH001', enrollmentId: 'DK010', classId: 'LH004', className: 'Ti·∫øng Anh 16 bu·ªïi - T3,T5 - 17h00', subjectName: 'Ti·∫øng Anh', packageName: 'G√≥i 16 bu·ªïi', totalSessions: 16, pricePerSession: 150000, subtotal: 2400000, discountType: 'none', discountValue: 0, discountAmount: 0, totalAmount: 2400000, paidAmount: 2400000, debtAmount: 0, paymentStatus: STATUS.PAYMENT.PAID, promotionId: null, promotionName: '', invoiceDate: '2024-12-25', dueDate: '2025-01-05', notes: '', createdAt: '2024-12-25' },
    { id: 'HP011', studentId: 'HV004', studentName: 'L√™ Ho√†ng Nam', parentId: 'PH003', enrollmentId: 'DK011', classId: 'LH004', className: 'Ti·∫øng Anh 16 bu·ªïi - T3,T5 - 17h00', subjectName: 'Ti·∫øng Anh', packageName: 'G√≥i 16 bu·ªïi', totalSessions: 16, pricePerSession: 150000, subtotal: 2400000, discountType: 'percent', discountValue: 10, discountAmount: 240000, totalAmount: 2160000, paidAmount: 1000000, debtAmount: 1160000, paymentStatus: STATUS.PAYMENT.PARTIAL, promotionId: 'KM001', promotionName: 'Gi·∫£m 10% h·ªçc vi√™n m·ªõi', invoiceDate: '2025-01-05', dueDate: '2025-01-15', notes: 'ƒê√£ ƒë√≥ng 1.000.000ƒë, c√≤n n·ª£ 1.160.000ƒë', createdAt: '2025-01-05' },
    { id: 'HP012', studentId: 'HV006', studentName: 'Ph·∫°m Minh Kh√¥i', parentId: 'PH004', enrollmentId: 'DK012', classId: 'LH004', className: 'Ti·∫øng Anh 16 bu·ªïi - T3,T5 - 17h00', subjectName: 'Ti·∫øng Anh', packageName: 'G√≥i 16 bu·ªïi', totalSessions: 16, pricePerSession: 150000, subtotal: 2400000, discountType: 'none', discountValue: 0, discountAmount: 0, totalAmount: 2400000, paidAmount: 2400000, debtAmount: 0, paymentStatus: STATUS.PAYMENT.PAID, promotionId: null, promotionName: '', invoiceDate: '2024-12-25', dueDate: '2025-01-05', notes: '', createdAt: '2024-12-25' },
    
    // L·ªõp Dance Kids LH005 (2 h·ªçc vi√™n - h·ªçc th·ª≠)
    { id: 'HP013', studentId: 'HV009', studentName: 'V≈© Minh Anh', parentId: 'PH006', enrollmentId: 'DK013', classId: 'LH005', className: 'Dance Kids 8 bu·ªïi - T7 - 9h00', subjectName: 'Nh·∫£y Dance Kids', packageName: 'G√≥i 8 bu·ªïi', totalSessions: 8, pricePerSession: 100000, subtotal: 800000, discountType: 'none', discountValue: 0, discountAmount: 0, totalAmount: 800000, paidAmount: 0, debtAmount: 800000, paymentStatus: STATUS.PAYMENT.UNPAID, promotionId: null, promotionName: '', invoiceDate: '2025-01-10', dueDate: '2025-01-20', notes: 'H·ªçc th·ª≠, ch∆∞a thu ti·ªÅn', createdAt: '2025-01-10' },
    { id: 'HP014', studentId: 'HV010', studentName: 'V≈© Minh T√¢m', parentId: 'PH006', enrollmentId: 'DK014', classId: 'LH005', className: 'Dance Kids 8 bu·ªïi - T7 - 9h00', subjectName: 'Nh·∫£y Dance Kids', packageName: 'G√≥i 8 bu·ªïi', totalSessions: 8, pricePerSession: 100000, subtotal: 800000, discountType: 'none', discountValue: 0, discountAmount: 0, totalAmount: 800000, paidAmount: 0, debtAmount: 800000, paymentStatus: STATUS.PAYMENT.UNPAID, promotionId: null, promotionName: '', invoiceDate: '2025-01-10', dueDate: '2025-01-20', notes: 'H·ªçc th·ª≠, ch∆∞a thu ti·ªÅn', createdAt: '2025-01-10' },
    
    // L·ªõp C·ªù vua LH006 (1 h·ªçc vi√™n - l·ªõp s·∫Øp m·ªü)
    { id: 'HP015', studentId: 'HV004', studentName: 'L√™ Ho√†ng Nam', parentId: 'PH003', enrollmentId: 'DK015', classId: 'LH006', className: 'C·ªù vua 8 bu·ªïi - T2,T4 - 19h00', subjectName: 'C·ªù vua', packageName: 'G√≥i 8 bu·ªïi', totalSessions: 8, pricePerSession: 80000, subtotal: 640000, discountType: 'percent', discountValue: 10, discountAmount: 64000, totalAmount: 576000, paidAmount: 576000, debtAmount: 0, paymentStatus: STATUS.PAYMENT.PAID, promotionId: 'KM001', promotionName: 'Gi·∫£m 10% h·ªçc vi√™n m·ªõi', invoiceDate: '2025-01-10', dueDate: '2025-01-17', notes: 'ƒêƒÉng k√Ω s·ªõm l·ªõp s·∫Øp m·ªü', createdAt: '2025-01-10' },
];

// 7.12. Thanh to√°n - Payments (20 giao d·ªãch)
const SAMPLE_PAYMENTS = [
    // Thanh to√°n cho c√°c h√≥a ƒë∆°n ƒë√£ ƒë√≥ng ƒë·ªß
    { id: 'TT001', tuitionId: 'HP001', studentId: 'HV001', studentName: 'Tr·∫ßn Minh An', amount: 640000, paymentMethod: 'cash', bankName: null, transactionCode: null, receivedBy: 'Admin', paymentDate: '2024-12-25', notes: 'Thu ƒë·ªß ti·ªÅn m·∫∑t', createdAt: '2024-12-25' },
    { id: 'TT002', tuitionId: 'HP002', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', amount: 640000, paymentMethod: 'transfer', bankName: 'Vietcombank', transactionCode: 'VCB2024122501', receivedBy: 'Admin', paymentDate: '2024-12-25', notes: 'Chuy·ªÉn kho·∫£n', createdAt: '2024-12-25' },
    { id: 'TT003', tuitionId: 'HP003', studentId: 'HV006', studentName: 'Ph·∫°m Minh Kh√¥i', amount: 640000, paymentMethod: 'cash', bankName: null, transactionCode: null, receivedBy: 'Admin', paymentDate: '2024-12-25', notes: 'Thu ƒë·ªß ti·ªÅn m·∫∑t', createdAt: '2024-12-25' },
    { id: 'TT004', tuitionId: 'HP004', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', amount: 576000, paymentMethod: 'transfer', bankName: 'Techcombank', transactionCode: 'TCB2024122502', receivedBy: 'Admin', paymentDate: '2024-12-25', notes: 'ƒê√£ gi·∫£m 10%', createdAt: '2024-12-25' },
    { id: 'TT005', tuitionId: 'HP005', studentId: 'HV002', studentName: 'Tr·∫ßn Minh Ch√¢u', amount: 800000, paymentMethod: 'cash', bankName: null, transactionCode: null, receivedBy: 'Admin', paymentDate: '2024-12-25', notes: 'Thu ƒë·ªß ti·ªÅn m·∫∑t', createdAt: '2024-12-25' },
    { id: 'TT006', tuitionId: 'HP006', studentId: 'HV005', studentName: 'L√™ Ho√†ng Y·∫øn', amount: 720000, paymentMethod: 'transfer', bankName: 'BIDV', transactionCode: 'BIDV2025010501', receivedBy: 'Admin', paymentDate: '2025-01-05', notes: 'ƒê√£ gi·∫£m 10%', createdAt: '2025-01-05' },
    { id: 'TT007', tuitionId: 'HP007', studentId: 'HV008', studentName: 'Ho√†ng Gia H√¢n', amount: 800000, paymentMethod: 'cash', bankName: null, transactionCode: null, receivedBy: 'Admin', paymentDate: '2024-12-25', notes: 'Thu ƒë·ªß ti·ªÅn m·∫∑t', createdAt: '2024-12-25' },
    { id: 'TT008', tuitionId: 'HP008', studentId: 'HV003', studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t', amount: 1440000, paymentMethod: 'transfer', bankName: 'Vietcombank', transactionCode: 'VCB2024122503', receivedBy: 'Admin', paymentDate: '2024-12-25', notes: 'Chuy·ªÉn kho·∫£n', createdAt: '2024-12-25' },
    { id: 'TT009', tuitionId: 'HP009', studentId: 'HV007', studentName: 'Ho√†ng Gia B·∫£o', amount: 1440000, paymentMethod: 'cash', bankName: null, transactionCode: null, receivedBy: 'Admin', paymentDate: '2024-12-25', notes: 'Thu ƒë·ªß ti·ªÅn m·∫∑t', createdAt: '2024-12-25' },
    { id: 'TT010', tuitionId: 'HP010', studentId: 'HV001', studentName: 'Tr·∫ßn Minh An', amount: 2400000, paymentMethod: 'transfer', bankName: 'Agribank', transactionCode: 'AGB2024122504', receivedBy: 'Admin', paymentDate: '2024-12-25', notes: 'Chuy·ªÉn kho·∫£n', createdAt: '2024-12-25' },
    
    // Thanh to√°n 1 ph·∫ßn cho HP011
    { id: 'TT011', tuitionId: 'HP011', studentId: 'HV004', studentName: 'L√™ Ho√†ng Nam', amount: 1000000, paymentMethod: 'cash', bankName: null, transactionCode: null, receivedBy: 'Admin', paymentDate: '2025-01-05', notes: 'ƒê√≥ng tr∆∞·ªõc 1.000.000ƒë', createdAt: '2025-01-05' },
    
    { id: 'TT012', tuitionId: 'HP012', studentId: 'HV006', studentName: 'Ph·∫°m Minh Kh√¥i', amount: 2400000, paymentMethod: 'transfer', bankName: 'Vietcombank', transactionCode: 'VCB2024122505', receivedBy: 'Admin', paymentDate: '2024-12-25', notes: 'Chuy·ªÉn kho·∫£n', createdAt: '2024-12-25' },
    { id: 'TT013', tuitionId: 'HP015', studentId: 'HV004', studentName: 'L√™ Ho√†ng Nam', amount: 576000, paymentMethod: 'cash', bankName: null, transactionCode: null, receivedBy: 'Admin', paymentDate: '2025-01-10', notes: 'ƒêƒÉng k√Ω s·ªõm', createdAt: '2025-01-10' },
];

// 7.13. Khuy·∫øn m√£i - Promotions (2 m√£)
const SAMPLE_PROMOTIONS = [
    {
        id: 'KM001',
        name: 'Gi·∫£m 10% h·ªçc vi√™n m·ªõi',
        code: 'NEW10',
        discountType: 'percent',
        discountValue: 10,
        applyTo: 'new-student',
        minSessions: 8,
        startDate: '2024-12-01',
        endDate: '2025-03-31',
        maxUsage: 50,
        usedCount: 5,
        status: STATUS.GENERAL.ACTIVE,
        notes: '√Åp d·ª•ng cho h·ªçc vi√™n m·ªõi ƒëƒÉng k√Ω t·ª´ 8 bu·ªïi tr·ªü l√™n',
        createdAt: '2024-12-01',
    },
    {
        id: 'KM002',
        name: '∆Øu ƒë√£i t·∫øt 2025',
        code: 'TET2025',
        discountType: 'amount',
        discountValue: 200000,
        applyTo: 'all',
        minSessions: 12,
        startDate: '2025-01-15',
        endDate: '2025-02-15',
        maxUsage: 100,
        usedCount: 0,
        status: STATUS.GENERAL.ACTIVE,
        notes: 'Gi·∫£m 200k cho g√≥i t·ª´ 12 bu·ªïi tr·ªü l√™n',
        createdAt: '2025-01-10',
    },
];

// 7.14. Nh·∫≠n x√©t - Evaluations (5 ƒë√°nh gi√°)
const SAMPLE_EVALUATIONS = [
    {
        id: 'NX001',
        studentId: 'HV001',
        studentName: 'Tr·∫ßn Minh An',
        classId: 'LH001',
        sessionId: 'BH001',
        teacherId: 'GV001',
        teacherName: 'Nguy·ªÖn VƒÉn An',
        type: 'session',
        attitude: 5,
        progress: 4,
        participation: 5,
        strengths: 'T·∫≠p trung, hƒÉng h√°i ph√°t bi·ªÉu',
        improvements: 'C·∫ßn luy·ªán t·∫≠p th√™m ·ªü nh√†',
        recommendations: 'Cho b√© l√†m th√™m b√†i t·∫≠p c·ªù vua online',
        generalComment: 'B√© h·ªçc t·ªët, ti·∫øp thu nhanh',
        date: '2025-01-06',
        sentToParent: true,
        sentAt: '2025-01-06T19:00:00',
        createdAt: '2025-01-06',
    },
    {
        id: 'NX002',
        studentId: 'HV007',
        studentName: 'Ho√†ng Gia B·∫£o',
        classId: 'LH001',
        sessionId: 'BH001',
        teacherId: 'GV001',
        teacherName: 'Nguy·ªÖn VƒÉn An',
        type: 'session',
        attitude: 4,
        progress: 4,
        participation: 4,
        strengths: 'ChƒÉm ch·ªâ, ngoan',
        improvements: 'ƒê·∫øn l·ªõp ƒë√∫ng gi·ªù',
        recommendations: '',
        generalComment: 'B√© h·ªçc kh√° t·ªët',
        date: '2025-01-06',
        sentToParent: true,
        sentAt: '2025-01-06T19:00:00',
        createdAt: '2025-01-06',
    },
    {
        id: 'NX003',
        studentId: 'HV002',
        studentName: 'Tr·∫ßn Minh Ch√¢u',
        classId: 'LH002',
        sessionId: 'BH005',
        teacherId: 'GV002',
        teacherName: 'Tr·∫ßn Th·ªã B√¨nh',
        type: 'session',
        attitude: 5,
        progress: 5,
        participation: 5,
        strengths: 'S√°ng t·∫°o, v·∫Ω ƒë·∫πp',
        improvements: '',
        recommendations: 'Cho b√© t·∫≠p v·∫Ω nhi·ªÅu h∆°n ·ªü nh√†',
        generalComment: 'B√© c√≥ nƒÉng khi·∫øu v·∫Ω',
        date: '2025-01-07',
        sentToParent: true,
        sentAt: '2025-01-07T18:00:00',
        createdAt: '2025-01-07',
    },
    {
        id: 'NX004',
        studentId: 'HV003',
        studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t',
        classId: 'LH003',
        sessionId: null,
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        type: 'weekly',
        attitude: 5,
        progress: 5,
        participation: 5,
        strengths: 'Th√¥ng minh, t∆∞ duy logic t·ªët',
        improvements: '',
        recommendations: 'Ti·∫øp t·ª•c duy tr√¨',
        generalComment: 'H·ªçc sinh xu·∫•t s·∫Øc',
        date: '2025-01-17',
        sentToParent: false,
        sentAt: null,
        createdAt: '2025-01-17',
    },
    {
        id: 'NX005',
        studentId: 'HV001',
        studentName: 'Tr·∫ßn Minh An',
        classId: 'LH004',
        sessionId: 'BH015',
        teacherId: 'GV003',
        teacherName: 'L√™ Minh C∆∞·ªùng',
        type: 'session',
        attitude: 5,
        progress: 4,
        participation: 5,
        strengths: 'Ph√°t √¢m t·ªët, t√≠ch c·ª±c',
        improvements: 'H·ªçc thu·ªôc t·ª´ v·ª±ng th√™m',
        recommendations: '',
        generalComment: 'B√© h·ªçc Ti·∫øng Anh r·∫•t t·ªët',
        date: '2025-01-07',
        sentToParent: true,
        sentAt: '2025-01-07T19:00:00',
        createdAt: '2025-01-07',
    },
];

// 7.15. Tin nh·∫Øn - Messages (3 tin)
const SAMPLE_MESSAGES = [
    {
        id: 'TN001',
        senderId: 'GV001',
        senderName: 'Nguy·ªÖn VƒÉn An',
        senderType: 'teacher',
        recipientId: 'PH001',
        recipientName: 'Tr·∫ßn VƒÉn H√πng',
        recipientType: 'parent',
        studentId: 'HV001',
        studentName: 'Tr·∫ßn Minh An',
        subject: 'Nh·∫≠n x√©t v·ªÅ b√© An',
        content: 'K√≠nh ch√†o ph·ª• huynh, ch√°u An h·ªçc r·∫•t t·ªët, ti·∫øp thu nhanh. C√¥ r·∫•t h√†i l√≤ng v·ªõi th√°i ƒë·ªô h·ªçc t·∫≠p c·ªßa ch√°u.',
        messageType: 'feedback',
        isRead: true,
        readAt: '2025-01-06T20:00:00',
        replyToId: null,
        createdAt: '2025-01-06T19:00:00',
    },
    {
        id: 'TN002',
        senderId: 'PH002',
        senderName: 'Nguy·ªÖn Th·ªã Mai',
        senderType: 'parent',
        recipientId: 'admin',
        recipientName: 'Admin',
        recipientType: 'admin',
        studentId: 'HV003',
        studentName: 'Nguy·ªÖn Th√†nh ƒê·∫°t',
        subject: 'Xin ngh·ªâ h·ªçc ng√†y 08/01',
        content: 'Em xin ph√©p cho ch√°u ƒê·∫°t ngh·ªâ h·ªçc bu·ªïi ng√†y 08/01 v√¨ ch√°u b·ªã ·ªëm. Em s·∫Ω cho ch√°u h·ªçc b√π sau ·∫°.',
        messageType: 'request',
        isRead: true,
        readAt: '2025-01-08T08:00:00',
        replyToId: null,
        createdAt: '2025-01-07T20:00:00',
    },
    {
        id: 'TN003',
        senderId: 'admin',
        senderName: 'Admin',
        senderType: 'admin',
        recipientId: 'PH006',
        recipientName: 'V≈© Th·ªã Hoa',
        recipientType: 'parent',
        studentId: 'HV009',
        studentName: 'V≈© Minh Anh',
        subject: 'Th√¥ng b√°o l·ªõp Dance Kids khai gi·∫£ng',
        content: 'K√≠nh ch√†o ph·ª• huynh, l·ªõp Dance Kids s·∫Ω khai gi·∫£ng v√†o s√°ng th·ª© 7 ng√†y 11/01/2025 l√∫c 9h00. Mong ph·ª• huynh cho con ƒë·∫øn ƒë√∫ng gi·ªù.',
        messageType: 'announcement',
        isRead: false,
        readAt: null,
        replyToId: null,
        createdAt: '2025-01-10T15:00:00',
    },
];

// ============================================================
// 8. H√ÄM KH·ªûI T·∫†O D·ªÆ LI·ªÜU
// ============================================================

// 8.1. H√†m kh·ªüi t·∫°o d·ªØ li·ªáu m·∫´u
function initializeSampleData() {
    try {
        // Ki·ªÉm tra xem ƒë√£ c√≥ d·ªØ li·ªáu ch∆∞a
        const existingSubjects = StorageManager.get(STORAGE_KEYS.subjects);
        if (existingSubjects && existingSubjects.length > 0) {
            console.log('‚ö†Ô∏è D·ªØ li·ªáu ƒë√£ t·ªìn t·∫°i, b·ªè qua kh·ªüi t·∫°o');
            return false;
        }
        
        // L∆∞u t·∫•t c·∫£ d·ªØ li·ªáu m·∫´u v√†o localStorage
        StorageManager.save(STORAGE_KEYS.subjects, SAMPLE_SUBJECTS);
        StorageManager.save(STORAGE_KEYS.rooms, SAMPLE_ROOMS);
        StorageManager.save(STORAGE_KEYS.teachers, SAMPLE_TEACHERS);
        StorageManager.save(STORAGE_KEYS.parents, SAMPLE_PARENTS);
        StorageManager.save(STORAGE_KEYS.students, SAMPLE_STUDENTS);
        StorageManager.save(STORAGE_KEYS.classes, SAMPLE_CLASSES);
        StorageManager.save(STORAGE_KEYS.enrollments, SAMPLE_ENROLLMENTS);
        StorageManager.save(STORAGE_KEYS.sessions, SAMPLE_SESSIONS);
        StorageManager.save(STORAGE_KEYS.attendance, SAMPLE_ATTENDANCE);
        StorageManager.save(STORAGE_KEYS.makeupRequests, SAMPLE_MAKEUP_REQUESTS);
        StorageManager.save(STORAGE_KEYS.tuitions, SAMPLE_TUITIONS);
        StorageManager.save(STORAGE_KEYS.payments, SAMPLE_PAYMENTS);
        StorageManager.save(STORAGE_KEYS.promotions, SAMPLE_PROMOTIONS);
        StorageManager.save(STORAGE_KEYS.evaluations, SAMPLE_EVALUATIONS);
        StorageManager.save(STORAGE_KEYS.messages, SAMPLE_MESSAGES);
        StorageManager.save(STORAGE_KEYS.activityLogs, []);
        
        // T·∫°o user m·∫∑c ƒë·ªãnh
        const defaultUsers = [
            {
                id: 'USER001',
                username: 'admin',
                password: '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9', // hash c·ªßa "admin123"
                fullName: 'Administrator',
                role: 'admin',
                status: STATUS.GENERAL.ACTIVE,
                createdAt: getCurrentDateTime(),
            }
        ];
        StorageManager.save(STORAGE_KEYS.users, defaultUsers);
        
        // L∆∞u c√†i ƒë·∫∑t m·∫∑c ƒë·ªãnh
        StorageManager.save(STORAGE_KEYS.settings, APP_CONFIG);
        
        console.log('‚úÖ Kh·ªüi t·∫°o d·ªØ li·ªáu m·∫´u th√†nh c√¥ng!');
        console.log('üìä T·ªïng k·∫øt:');
        console.log('   - 5 M√¥n h·ªçc');
        console.log('   - 3 Ph√≤ng h·ªçc');
        console.log('   - 4 Gi√°o vi√™n');
        console.log('   - 6 Ph·ª• huynh');
        console.log('   - 10 H·ªçc vi√™n');
        console.log('   - 6 L·ªõp h·ªçc');
        console.log('   - 15 ƒêƒÉng k√Ω l·ªõp');
        console.log('   - 18 Bu·ªïi h·ªçc');
        console.log('   - 52 ƒêi·ªÉm danh');
        console.log('   - 3 Y√™u c·∫ßu h·ªçc b√π');
        console.log('   - 15 H√≥a ƒë∆°n h·ªçc ph√≠');
        console.log('   - 13 Thanh to√°n');
        console.log('   - 2 Khuy·∫øn m√£i');
        console.log('   - 5 Nh·∫≠n x√©t');
        console.log('   - 3 Tin nh·∫Øn');
        return true;
    } catch (error) {
        console.error('‚ùå L·ªói kh·ªüi t·∫°o d·ªØ li·ªáu:', error);
        return false;
    }
}

// 8.2. H√†m reset d·ªØ li·ªáu (x√≥a t·∫•t c·∫£ v√† t·∫°o l·∫°i)
function resetAllData() {
    if (confirm('‚ö†Ô∏è B·∫†N CH·∫ÆC CH·∫ÆN MU·ªêN X√ìA T·∫§T C·∫¢ D·ªÆ LI·ªÜU V√Ä T·∫†O L·∫†I KH√îNG?\n\nH√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!')) {
        StorageManager.clear();
        initializeSampleData();
        alert('‚úÖ ƒê√£ reset d·ªØ li·ªáu th√†nh c√¥ng! Vui l√≤ng t·∫£i l·∫°i trang.');
        location.reload();
    }
}

// ============================================================
// 9. KH·ªûI ƒê·ªòNG H·ªÜ TH·ªêNG
// ============================================================

// Kh·ªüi t·∫°o d·ªØ li·ªáu khi load trang
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ H·ªá th·ªëng ƒëang kh·ªüi ƒë·ªông...');
    
    // Kh·ªüi t·∫°o d·ªØ li·ªáu m·∫´u n·∫øu ch∆∞a c√≥
    initializeSampleData();
    
    // Hi·ªÉn th·ªã th√¥ng tin debug
    console.log('üì¶ LocalStorage Keys:', Object.keys(localStorage).filter(k => k.startsWith(APP_CONFIG.storagePrefix)));
    
    // Load m√†n h√¨nh ƒëƒÉng nh·∫≠p (s·∫Ω code ·ªü Task 1.2)
    console.log('‚úÖ Task 1.1 - HO√ÄN TH√ÄNH');
    console.log('‚û°Ô∏è Ti·∫øp theo: Task 1.2 - X√¢y d·ª±ng giao di·ªán Sidebar & Login');
});

console.log('‚úÖ Task 1.1 - Ph·∫ßn 3/3: D·ªØ li·ªáu ho√†n ch·ªânh ƒë√£ load');
console.log('üéâ TASK 1.1 HO√ÄN TH√ÄNH 100%!');

// ============================================================
// TASK 1.2: GIAO DI·ªÜN LOGIN + SIDEBAR + LAYOUT
// ============================================================

// ------------------------------------------------------------
// 10. QU·∫¢N L√ù PHI√äN ƒêƒÇNG NH·∫¨P
// ------------------------------------------------------------
const SessionManager = {
    currentUser: null,
    
    // ƒêƒÉng nh·∫≠p
    async login(username, password) {
        try {
            // L·∫•y danh s√°ch user
            const users = DataManager.getAll(STORAGE_KEYS.users);
            
            // Hash m·∫≠t kh·∫©u nh·∫≠p v√†o
            const hashedPassword = await hashPassword(password);
            
            // T√¨m user
            const user = users.find(u => 
                u.username === username && 
                u.password === hashedPassword &&
                u.status === STATUS.GENERAL.ACTIVE
            );
            
            if (user) {
                // L∆∞u session
                this.currentUser = user;
                sessionStorage.setItem('currentUser', JSON.stringify(user));
                
                // Ghi log
                this.logActivity('login', 'users', user.id, user.fullName, 'ƒêƒÉng nh·∫≠p h·ªá th·ªëng');
                
                return { success: true, user };
            } else {
                return { success: false, message: 'T√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng' };
            }
        } catch (error) {
            console.error('L·ªói ƒëƒÉng nh·∫≠p:', error);
            return { success: false, message: 'L·ªói h·ªá th·ªëng' };
        }
    },
    
    // ƒêƒÉng xu·∫•t
    logout() {
        if (this.currentUser) {
            this.logActivity('logout', 'users', this.currentUser.id, this.currentUser.fullName, 'ƒêƒÉng xu·∫•t h·ªá th·ªëng');
        }
        this.currentUser = null;
        sessionStorage.removeItem('currentUser');
        location.reload();
    },
    
    // Ki·ªÉm tra ƒë√£ ƒëƒÉng nh·∫≠p ch∆∞a
    isLoggedIn() {
        if (this.currentUser) return true;
        
        // Ki·ªÉm tra session storage
        const savedUser = sessionStorage.getItem('currentUser');
        if (savedUser) {
            this.currentUser = JSON.parse(savedUser);
            return true;
        }
        
        return false;
    },
    
    // L·∫•y th√¥ng tin user hi·ªán t·∫°i
    getCurrentUser() {
        return this.currentUser;
    },
    
    // Ghi log ho·∫°t ƒë·ªông
    logActivity(action, module, targetId, targetName, description) {
        const log = {
            id: generateId('LOG'),
            userId: this.currentUser ? this.currentUser.id : 'system',
            userName: this.currentUser ? this.currentUser.fullName : 'System',
            action,
            module,
            targetId,
            targetName,
            description,
            timestamp: getCurrentDateTime(),
            ipAddress: null,
            userAgent: navigator.userAgent,
        };
        
        const logs = DataManager.getAll(STORAGE_KEYS.activityLogs);
        logs.unshift(log); // Th√™m v√†o ƒë·∫ßu m·∫£ng
        
        // Gi·ªØ t·ªëi ƒëa 1000 logs
        if (logs.length > 1000) {
            logs.splice(1000);
        }
        
        StorageManager.save(STORAGE_KEYS.activityLogs, logs);
    },
};

// ------------------------------------------------------------
// 11. QU·∫¢N L√ù GIAO DI·ªÜN
// ------------------------------------------------------------
const UIManager = {
    currentPage: 'dashboard',
    
    // Kh·ªüi t·∫°o giao di·ªán
    init() {
        // Ki·ªÉm tra ƒëƒÉng nh·∫≠p
        if (SessionManager.isLoggedIn()) {
            this.showMainApp();
            this.initEventListeners();
            this.updateUserInfo();
            this.updateDateTime();
            this.loadPage('dashboard');
        } else {
            this.showLoginScreen();
            this.initLoginForm();
        }
    },
    
    // Hi·ªÉn th·ªã m√†n h√¨nh ƒëƒÉng nh·∫≠p
    showLoginScreen() {
        document.getElementById('loginScreen').style.display = 'flex';
        document.getElementById('mainApp').style.display = 'none';
    },
    
    // Hi·ªÉn th·ªã giao di·ªán ch√≠nh
    showMainApp() {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'flex';
    },
    
    // Kh·ªüi t·∫°o form ƒëƒÉng nh·∫≠p
    initLoginForm() {
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Hi·ªÉn th·ªã loading
            const btnLogin = loginForm.querySelector('.btn-login');
            const originalText = btnLogin.textContent;
            btnLogin.textContent = 'ƒêang ƒëƒÉng nh·∫≠p...';
            btnLogin.disabled = true;
            
            // ƒêƒÉng nh·∫≠p
            const result = await SessionManager.login(username, password);
            
            if (result.success) {
                loginError.style.display = 'none';
                this.showMainApp();
                this.initEventListeners();
                this.updateUserInfo();
                this.updateDateTime();
                this.loadPage('dashboard');
                this.showNotification('ƒêƒÉng nh·∫≠p th√†nh c√¥ng!', 'success');
            } else {
                loginError.textContent = result.message;
                loginError.style.display = 'block';
                btnLogin.textContent = originalText;
                btnLogin.disabled = false;
            }
        });
    },
    
    // Kh·ªüi t·∫°o event listeners
    initEventListeners() {
        // ƒêƒÉng xu·∫•t
        document.getElementById('btnLogout').addEventListener('click', () => {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                SessionManager.logout();
            }
        });
        
        // Toggle sidebar (desktop)
        document.getElementById('sidebarToggle').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('collapsed');
        });
        
        // Toggle sidebar (mobile)
        document.getElementById('btnMenuToggle').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('mobile-open');
        });
        
        // Menu items
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const page = item.getAttribute('data-page');
                this.loadPage(page);
                
                // ƒê√≥ng sidebar tr√™n mobile
                if (window.innerWidth <= 768) {
                    document.getElementById('sidebar').classList.remove('mobile-open');
                }
            });
        });
        
        // ƒê√≥ng sidebar khi click b√™n ngo√†i (mobile)
        document.addEventListener('click', (e) => {
            const sidebar = document.getElementById('sidebar');
            const btnToggle = document.getElementById('btnMenuToggle');
            
            if (window.innerWidth <= 768 && 
                sidebar.classList.contains('mobile-open') &&
                !sidebar.contains(e.target) &&
                !btnToggle.contains(e.target)) {
                sidebar.classList.remove('mobile-open');
            }
        });
    },
    
    // C·∫≠p nh·∫≠t th√¥ng tin user
    updateUserInfo() {
        const user = SessionManager.getCurrentUser();
        if (user) {
            document.getElementById('userName').textContent = user.fullName;
            
            // Hi·ªÉn th·ªã vai tr√≤
            const roleMap = {
                'admin': 'Qu·∫£n tr·ªã vi√™n',
                'teacher': 'Gi√°o vi√™n',
                'staff': 'Nh√¢n vi√™n',
            };
            document.getElementById('userRole').textContent = roleMap[user.role] || user.role;
        }
    },
    
    // C·∫≠p nh·∫≠t ng√†y gi·ªù
    updateDateTime() {
        const updateTime = () => {
            const now = new Date();
            const dateStr = now.toLocaleDateString('vi-VN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('currentDate').textContent = dateStr;
        };
        
        updateTime();
        setInterval(updateTime, 60000); // C·∫≠p nh·∫≠t m·ªói ph√∫t
    },
    
    // Load trang
    loadPage(pageName) {
        // C·∫≠p nh·∫≠t active menu
        document.querySelectorAll('.menu-item').forEach(item => {
            item.classList.remove('active');
            if (item.getAttribute('data-page') === pageName) {
                item.classList.add('active');
            }
        });
        
        // C·∫≠p nh·∫≠t title
        const pageTitles = {
            'dashboard': 'Dashboard',
            'students': 'Qu·∫£n l√Ω H·ªçc vi√™n',
            'teachers': 'Qu·∫£n l√Ω Gi√°o vi√™n',
            'classes': 'Qu·∫£n l√Ω L·ªõp h·ªçc',
            'subjects': 'Qu·∫£n l√Ω M√¥n h·ªçc',
            'rooms': 'Qu·∫£n l√Ω Ph√≤ng h·ªçc',
            'attendance': 'ƒêi·ªÉm danh',
            'makeup': 'Qu·∫£n l√Ω H·ªçc b√π',
            'tuitions': 'Qu·∫£n l√Ω H·ªçc ph√≠',
            'promotions': 'Qu·∫£n l√Ω Khuy·∫øn m√£i',
            'reports': 'B√°o c√°o H·ªçc t·∫≠p',
            'messages': 'S·ªï li√™n l·∫°c',
            'statistics': 'Th·ªëng k√™',
            'settings': 'C√†i ƒë·∫∑t H·ªá th·ªëng',
            'center-info': 'Th√¥ng tin Trung t√¢m',
        };
        
        document.getElementById('pageTitle').textContent = pageTitles[pageName] || pageName;
        
        // Load n·ªôi dung trang
        this.currentPage = pageName;
        this.renderPageContent(pageName);
    },
    
    // Render n·ªôi dung trang
    renderPageContent(pageName) {
        const contentArea = document.getElementById('contentArea');
        
        if (pageName === 'dashboard') {
            // Load Dashboard
            this.renderDashboard(contentArea);
        } else {
            // Placeholder cho c√°c trang kh√°c
            const placeholderPages = {
                'students': '<div class="placeholder"><h2>üë®‚Äçüéì H·ªçc vi√™n</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
                'teachers': '<div class="placeholder"><h2>üë®‚Äçüè´ Gi√°o vi√™n</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
                'classes': '<div class="placeholder"><h2>üìö L·ªõp h·ªçc</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
                'subjects': '<div class="placeholder"><h2>üìñ M√¥n h·ªçc</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
                'rooms': '<div class="placeholder"><h2>üè´ Ph√≤ng h·ªçc</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
                'attendance': '<div class="placeholder"><h2>‚úÖ ƒêi·ªÉm danh</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
                'makeup': '<div class="placeholder"><h2>üîÑ H·ªçc b√π</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
                'tuitions': '<div class="placeholder"><h2>üí∞ H·ªçc ph√≠</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
                'promotions': '<div class="placeholder"><h2>üéÅ Khuy·∫øn m√£i</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
                'reports': '<div class="placeholder"><h2>üìä B√°o c√°o</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
                'messages': '<div class="placeholder"><h2>üí¨ S·ªï li√™n l·∫°c</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
                'statistics': '<div class="placeholder"><h2>üìà Th·ªëng k√™</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
                'settings': '<div class="placeholder"><h2>‚öôÔ∏è C√†i ƒë·∫∑t</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
                'center-info': '<div class="placeholder"><h2>‚ÑπÔ∏è Th√¥ng tin TT</h2><p>Ch·ª©c nƒÉng ƒëang ph√°t tri·ªÉn...</p></div>',
            };
            
            contentArea.innerHTML = placeholderPages[pageName] || '<div class="placeholder"><h2>Trang kh√¥ng t·ªìn t·∫°i</h2></div>';
        }
    },
    
    // ============================================================
    // DASHBOARD MODULE
    // ============================================================
    renderDashboard(contentArea) {
        // L·∫•y d·ªØ li·ªáu th·ªëng k√™
        const stats = this.getDashboardStats();
        
        // Render HTML
        contentArea.innerHTML = `
            <!-- STATS CARDS -->
            <div class="stats-grid">
                <div class="stat-card stat-primary">
                    <div class="stat-icon">üë®‚Äçüéì</div>
                    <div class="stat-details">
                        <div class="stat-value">${stats.totalStudents}</div>
                        <div class="stat-label">T·ªïng h·ªçc vi√™n</div>
                        <div class="stat-change positive">+${stats.newStudentsThisMonth} th√°ng n√†y</div>
                    </div>
                </div>
                
                <div class="stat-card stat-success">
                    <div class="stat-icon">üë®‚Äçüè´</div>
                    <div class="stat-details">
                        <div class="stat-value">${stats.totalTeachers}</div>
                        <div class="stat-label">Gi√°o vi√™n</div>
                        <div class="stat-change">${stats.activeTeachers} ƒëang ho·∫°t ƒë·ªông</div>
                    </div>
                </div>
                
                <div class="stat-card stat-warning">
                    <div class="stat-icon">üìö</div>
                    <div class="stat-details">
                        <div class="stat-value">${stats.totalClasses}</div>
                        <div class="stat-label">L·ªõp h·ªçc</div>
                        <div class="stat-change">${stats.activeClasses} ƒëang d·∫°y</div>
                    </div>
                </div>
                
                <div class="stat-card stat-danger">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-details">
                        <div class="stat-value">${formatCurrency(stats.revenueThisMonth)}</div>
                        <div class="stat-label">Doanh thu th√°ng n√†y</div>
                        <div class="stat-change">${stats.totalDebt > 0 ? 'C√¥ng n·ª£: ' + formatCurrency(stats.totalDebt) : 'Kh√¥ng c√≥ n·ª£'}</div>
                    </div>
                </div>
            </div>
            
            <!-- CHARTS ROW -->
            <div class="charts-row">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>üìà TƒÉng tr∆∞·ªüng h·ªçc vi√™n (6 th√°ng)</h3>
                    </div>
                    <div class="chart-body">
                        <canvas id="studentGrowthChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>üìä Ph√¢n b·ªë h·ªçc vi√™n theo m√¥n</h3>
                    </div>
                    <div class="chart-body">
                        <canvas id="subjectDistributionChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- TABLES ROW -->
            <div class="tables-row">
                <div class="table-card">
                    <div class="table-header">
                        <h3>‚ö†Ô∏è C√¥ng n·ª£ c·∫ßn thu</h3>
                    </div>
                    <div class="table-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>H·ªçc vi√™n</th>
                                    <th>L·ªõp</th>
                                    <th>S·ªë n·ª£</th>
                                    <th>H·∫°n n·ªôp</th>
                                </tr>
                            </thead>
                            <tbody id="debtTableBody">
                                ${this.renderDebtTable(stats.debtList)}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="table-card">
                    <div class="table-header">
                        <h3>üìÖ L·ªãch d·∫°y h√¥m nay</h3>
                    </div>
                    <div class="table-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Th·ªùi gian</th>
                                    <th>L·ªõp</th>
                                    <th>Gi√°o vi√™n</th>
                                    <th>Ph√≤ng</th>
                                </tr>
                            </thead>
                            <tbody id="scheduleTableBody">
                                ${this.renderTodaySchedule(stats.todayClasses)}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `;
        
        // Render charts sau khi DOM ƒë√£ ƒë∆∞·ª£c t·∫°o
        setTimeout(() => {
            this.renderStudentGrowthChart(stats.growthData);
            this.renderSubjectDistributionChart(stats.subjectData);
        }, 100);
    },
    
    // L·∫•y d·ªØ li·ªáu th·ªëng k√™ Dashboard
    getDashboardStats() {
        const students = DataManager.getAll(STORAGE_KEYS.students);
        const teachers = DataManager.getAll(STORAGE_KEYS.teachers);
        const classes = DataManager.getAll(STORAGE_KEYS.classes);
        const tuitions = DataManager.getAll(STORAGE_KEYS.tuitions);
        const payments = DataManager.getAll(STORAGE_KEYS.payments);
        const subjects = DataManager.getAll(STORAGE_KEYS.subjects);
        const sessions = DataManager.getAll(STORAGE_KEYS.sessions);
        
        // T·ªïng h·ªçc vi√™n
        const totalStudents = students.length;
        const activeStudents = students.filter(s => s.status === STATUS.STUDENT.ACTIVE).length;
        
        // H·ªçc vi√™n m·ªõi th√°ng n√†y
        const thisMonth = new Date().toISOString().slice(0, 7); // YYYY-MM
        const newStudentsThisMonth = students.filter(s => s.enrollmentDate && s.enrollmentDate.startsWith(thisMonth)).length;
        
        // Gi√°o vi√™n
        const totalTeachers = teachers.length;
        const activeTeachers = teachers.filter(t => t.status === STATUS.GENERAL.ACTIVE).length;
        
        // L·ªõp h·ªçc
        const totalClasses = classes.length;
        const activeClasses = classes.filter(c => c.status === STATUS.CLASS.ACTIVE).length;
        
        // Doanh thu th√°ng n√†y
        const revenueThisMonth = payments
            .filter(p => p.paymentDate && p.paymentDate.startsWith(thisMonth))
            .reduce((sum, p) => sum + p.amount, 0);
        
        // T·ªïng c√¥ng n·ª£
        const totalDebt = tuitions
            .filter(t => t.paymentStatus !== STATUS.PAYMENT.PAID)
            .reduce((sum, t) => sum + t.debtAmount, 0);
        
        // Danh s√°ch c√¥ng n·ª£
        const debtList = tuitions
            .filter(t => t.debtAmount > 0)
            .sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate))
            .slice(0, 5); // Top 5
        
        // L·ªãch d·∫°y h√¥m nay
        const today = getCurrentDate();
        const todayDayOfWeek = new Date().getDay() || 7; // 0 (CN) -> 7, 1-6 gi·ªØ nguy√™n
        const todayClasses = classes
            .filter(c => c.status === STATUS.CLASS.ACTIVE)
            .filter(c => c.schedule && c.schedule.some(s => s.dayOfWeek === todayDayOfWeek))
            .sort((a, b) => {
                const timeA = a.schedule.find(s => s.dayOfWeek === todayDayOfWeek)?.startTime || '';
                const timeB = b.schedule.find(s => s.dayOfWeek === todayDayOfWeek)?.startTime || '';
                return timeA.localeCompare(timeB);
            })
            .slice(0, 5); // Top 5
        
        // D·ªØ li·ªáu tƒÉng tr∆∞·ªüng 6 th√°ng
        const growthData = this.getStudentGrowthData(students);
        
        // Ph√¢n b·ªë h·ªçc vi√™n theo m√¥n
        const subjectData = this.getSubjectDistributionData(students, subjects);
        
        return {
            totalStudents,
            activeStudents,
            newStudentsThisMonth,
            totalTeachers,
            activeTeachers,
            totalClasses,
            activeClasses,
            revenueThisMonth,
            totalDebt,
            debtList,
            todayClasses,
            growthData,
            subjectData,
        };
    },
    
    // D·ªØ li·ªáu tƒÉng tr∆∞·ªüng h·ªçc vi√™n 6 th√°ng
    getStudentGrowthData(students) {
        const months = [];
        const counts = [];
        const now = new Date();
        
        for (let i = 5; i >= 0; i--) {
            const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
            const monthStr = date.toISOString().slice(0, 7); // YYYY-MM
            const monthLabel = date.toLocaleDateString('vi-VN', { month: 'short', year: 'numeric' });
            
            const count = students.filter(s => {
                if (!s.enrollmentDate) return false;
                return s.enrollmentDate <= monthStr + '-31'; // T√≠nh t√≠ch l≈©y
            }).length;
            
            months.push(monthLabel);
            counts.push(count);
        }
        
        return { months, counts };
    },
    
    // Ph√¢n b·ªë h·ªçc vi√™n theo m√¥n h·ªçc
    getSubjectDistributionData(students, subjects) {
        const enrollments = DataManager.getAll(STORAGE_KEYS.enrollments);
        const activeEnrollments = enrollments.filter(e => e.status === STATUS.STUDENT.ACTIVE);
        
        const subjectCounts = {};
        subjects.forEach(subject => {
            subjectCounts[subject.name] = 0;
        });
        
        activeEnrollments.forEach(enrollment => {
            const classData = DataManager.getById(STORAGE_KEYS.classes, enrollment.classId);
            if (classData) {
                const subjectName = classData.subjectName;
                if (subjectCounts[subjectName] !== undefined) {
                    subjectCounts[subjectName]++;
                }
            }
        });
        
        const labels = Object.keys(subjectCounts);
        const data = Object.values(subjectCounts);
        const colors = subjects.map(s => s.color);
        
        return { labels, data, colors };
    },
    
    // Render b·∫£ng c√¥ng n·ª£
    renderDebtTable(debtList) {
        if (debtList.length === 0) {
            return '<tr><td colspan="4" style="text-align: center; color: #10b981;">‚úÖ Kh√¥ng c√≥ c√¥ng n·ª£</td></tr>';
        }
        
        return debtList.map(debt => {
            const isOverdue = new Date(debt.dueDate) < new Date();
            const dueDateClass = isOverdue ? 'text-danger' : '';
            
            return `
                <tr>
                    <td>${debt.studentName}</td>
                    <td>${debt.className}</td>
                    <td style="font-weight: 600; color: #ef4444;">${formatCurrency(debt.debtAmount)}</td>
                    <td class="${dueDateClass}">${new Date(debt.dueDate).toLocaleDateString('vi-VN')}</td>
                </tr>
            `;
        }).join('');
    },
    
    // Render l·ªãch d·∫°y h√¥m nay
    renderTodaySchedule(todayClasses) {
        if (todayClasses.length === 0) {
            return '<tr><td colspan="4" style="text-align: center; color: #6b7280;">Kh√¥ng c√≥ l·ªãch d·∫°y h√¥m nay</td></tr>';
        }
        
        const todayDayOfWeek = new Date().getDay() || 7;
        
        return todayClasses.map(cls => {
            const schedule = cls.schedule.find(s => s.dayOfWeek === todayDayOfWeek);
            if (!schedule) return '';
            
            return `
                <tr>
                    <td style="font-weight: 600;">${schedule.startTime} - ${schedule.endTime}</td>
                    <td>${cls.name}</td>
                    <td>${cls.teacherName}</td>
                    <td>${cls.roomName}</td>
                </tr>
            `;
        }).join('');
    },
    
    // Render bi·ªÉu ƒë·ªì tƒÉng tr∆∞·ªüng
    renderStudentGrowthChart(growthData) {
        const ctx = document.getElementById('studentGrowthChart');
        if (!ctx) return;
        
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: growthData.months,
                datasets: [{
                    label: 'S·ªë h·ªçc vi√™n',
                    data: growthData.counts,
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 5,
                    pointHoverRadius: 7,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        titleFont: { size: 14 },
                        bodyFont: { size: 13 },
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 2
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
    },
    
    // Render bi·ªÉu ƒë·ªì ph√¢n b·ªë m√¥n h·ªçc
    renderSubjectDistributionChart(subjectData) {
        const ctx = document.getElementById('subjectDistributionChart');
        if (!ctx) return;
        
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: subjectData.labels,
                datasets: [{
                    data: subjectData.data,
                    backgroundColor: subjectData.colors,
                    borderWidth: 2,
                    borderColor: '#fff',
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            padding: 15,
                            font: { size: 13 },
                            generateLabels: function(chart) {
                                const data = chart.data;
                                return data.labels.map((label, i) => ({
                                    text: `${label}: ${data.datasets[0].data[i]}`,
                                    fillStyle: data.datasets[0].backgroundColor[i],
                                    hidden: false,
                                    index: i
                                }));
                            }
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 12,
                        titleFont: { size: 14 },
                        bodyFont: { size: 13 },
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.parsed} h·ªçc vi√™n`;
                            }
                        }
                    }
                }
            }
        });
    },

    // Hi·ªÉn th·ªã th√¥ng b√°o
    showNotification(message, type = 'info') {
        const container = document.getElementById('notificationContainer');
        
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        
        const icons = {
            'success': '‚úÖ',
            'error': '‚ùå',
            'warning': '‚ö†Ô∏è',
            'info': '‚ÑπÔ∏è',
        };
        
        notification.innerHTML = `
            <span class="notification-icon">${icons[type] || icons.info}</span>
            <span class="notification-message">${message}</span>
            <button class="notification-close" onclick="this.parentElement.remove()">√ó</button>
        `;
        
        container.appendChild(notification);
        
        // T·ª± ƒë·ªông ·∫©n sau 5 gi√¢y
        setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease-in-out';
            setTimeout(() => notification.remove(), 300);
        }, 5000);
    },
};

// ------------------------------------------------------------
// 12. KH·ªûI ƒê·ªòNG H·ªÜ TH·ªêNG (C·∫¨P NH·∫¨T)
// ------------------------------------------------------------

// C·∫≠p nh·∫≠t s·ª± ki·ªán DOMContentLoaded
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ H·ªá th·ªëng ƒëang kh·ªüi ƒë·ªông...');
    
    // Kh·ªüi t·∫°o d·ªØ li·ªáu m·∫´u n·∫øu ch∆∞a c√≥
    const dataInitialized = initializeSampleData();
    
    // Kh·ªüi t·∫°o giao di·ªán
    UIManager.init();
    
    // Hi·ªÉn th·ªã th√¥ng tin debug
    if (dataInitialized) {
        console.log('‚úÖ D·ªØ li·ªáu m·∫´u ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o');
    }
    console.log('üì¶ LocalStorage Keys:', Object.keys(localStorage).filter(k => k.startsWith(APP_CONFIG.storagePrefix)));
    console.log('‚úÖ Task 1.2 - HO√ÄN TH√ÄNH: Giao di·ªán Login + Sidebar + Layout');
});

console.log('‚úÖ Task 1.2 - Code JavaScript ƒë√£ load');
// ============================================================
// TASK 1.4: MODULE QU·∫¢N L√ù M√îN H·ªåC
// Th√™m v√†o cu·ªëi th·∫ª <script> trong file index.html
// ============================================================

// ------------------------------------------------------------
// 1. SUBJECTS MODULE - QU·∫¢N L√ù M√îN H·ªåC
// ------------------------------------------------------------
const SubjectsModule = {
    // Bi·∫øn l∆∞u tr·ªØ state
    currentPage: 1,
    itemsPerPage: 10,
    searchQuery: '',
    filterStatus: 'all',
    editingId: null,
    
    // M√†u preset cho m√¥n h·ªçc
    colorPresets: [
        '#3b82f6', // Blue
        '#ef4444', // Red
        '#10b981', // Green
        '#f59e0b', // Amber
        '#8b5cf6', // Purple
        '#ec4899', // Pink
        '#06b6d4', // Cyan
        '#f97316', // Orange
        '#6366f1', // Indigo
        '#84cc16', // Lime
    ],
    
    // ========================================
    // RENDER TRANG CH√çNH
    // ========================================
    render() {
        const contentArea = document.getElementById('contentArea');
        
        contentArea.innerHTML = `
            <div class="page-container">
                <!-- TOOLBAR -->
                <div class="page-toolbar">
                    <div class="toolbar-left">
                        <div class="search-box">
                            <input 
                                type="text" 
                                id="subjectSearch" 
                                placeholder="T√¨m ki·∫øm m√¥n h·ªçc..."
                                value="${this.searchQuery}"
                            >
                        </div>
                        <select class="filter-select" id="subjectStatusFilter">
                            <option value="all" ${this.filterStatus === 'all' ? 'selected' : ''}>T·∫•t c·∫£ tr·∫°ng th√°i</option>
                            <option value="active" ${this.filterStatus === 'active' ? 'selected' : ''}>ƒêang ho·∫°t ƒë·ªông</option>
                            <option value="inactive" ${this.filterStatus === 'inactive' ? 'selected' : ''}>Ng·ª´ng ho·∫°t ƒë·ªông</option>
                        </select>
                    </div>
                    <div class="toolbar-right">
                        <button class="btn btn-primary" onclick="SubjectsModule.showAddModal()">
                            <span>‚ûï</span>
                            <span>Th√™m m√¥n h·ªçc</span>
                        </button>
                    </div>
                </div>
                
                <!-- TABLE -->
                <div class="table-container">
                    <table class="data-table" id="subjectsTable">
                        <thead>
                            <tr>
                                <th style="width: 80px;">M√£</th>
                                <th>T√™n m√¥n h·ªçc</th>
                                <th style="width: 120px;">Gi√°/bu·ªïi</th>
                                <th style="width: 100px;">Th·ªùi l∆∞·ª£ng</th>
                                <th style="width: 100px;">M√†u s·∫Øc</th>
                                <th style="width: 120px;">Tr·∫°ng th√°i</th>
                                <th style="width: 150px; text-align: right;">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="subjectsTableBody">
                            <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                        </tbody>
                    </table>
                </div>
                
                <!-- PAGINATION -->
                <div class="pagination" id="subjectsPagination">
                    <!-- Pagination s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
                </div>
            </div>
        `;
        
        // Render d·ªØ li·ªáu b·∫£ng
        this.renderTable();
        
        // G·∫Øn event listeners
        this.attachEventListeners();
    },
    
    // ========================================
    // RENDER B·∫¢NG D·ªÆ LI·ªÜU
    // ========================================
    renderTable() {
        const tbody = document.getElementById('subjectsTableBody');
        const pagination = document.getElementById('subjectsPagination');
        
        // L·∫•y d·ªØ li·ªáu v√† l·ªçc
        let subjects = DataManager.getAll(STORAGE_KEYS.subjects);
        
        // T√¨m ki·∫øm
        if (this.searchQuery) {
            const query = this.searchQuery.toLowerCase();
            subjects = subjects.filter(s => 
                s.name.toLowerCase().includes(query) ||
                s.code.toLowerCase().includes(query) ||
                (s.description && s.description.toLowerCase().includes(query))
            );
        }
        
        // L·ªçc theo tr·∫°ng th√°i
        if (this.filterStatus !== 'all') {
            const isActive = this.filterStatus === 'active';
            subjects = subjects.filter(s => s.isActive === isActive);
        }
        
        // T√≠nh to√°n ph√¢n trang
        const totalItems = subjects.length;
        const totalPages = Math.ceil(totalItems / this.itemsPerPage);
        const startIndex = (this.currentPage - 1) * this.itemsPerPage;
        const endIndex = startIndex + this.itemsPerPage;
        const paginatedSubjects = subjects.slice(startIndex, endIndex);
        
        // Render tbody
        if (paginatedSubjects.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="7">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìö</div>
                            <div class="empty-state-title">Kh√¥ng c√≥ m√¥n h·ªçc n√†o</div>
                            <div class="empty-state-desc">
                                ${this.searchQuery || this.filterStatus !== 'all' 
                                    ? 'Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm' 
                                    : 'B·∫•m n√∫t "Th√™m m√¥n h·ªçc" ƒë·ªÉ t·∫°o m√¥n h·ªçc m·ªõi'}
                            </div>
                            ${!this.searchQuery && this.filterStatus === 'all' ? `
                                <button class="btn btn-primary" onclick="SubjectsModule.showAddModal()">
                                    <span>‚ûï</span>
                                    <span>Th√™m m√¥n h·ªçc ƒë·∫ßu ti√™n</span>
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `;
        } else {
            tbody.innerHTML = paginatedSubjects.map(subject => `
                <tr data-id="${subject.id}">
                    <td>
                        <span class="cell-code">${subject.code}</span>
                    </td>
                    <td>
                        <div class="cell-name">${subject.name}</div>
                        ${subject.description ? `<div style="font-size: 12px; color: #6b7280; margin-top: 2px;">${subject.description.substring(0, 50)}${subject.description.length > 50 ? '...' : ''}</div>` : ''}
                    </td>
                    <td>
                        <span class="cell-price">${formatCurrency(subject.pricePerSession)}</span>
                    </td>
                    <td>
                        ${subject.sessionDuration} ph√∫t
                    </td>
                    <td>
                        <div class="cell-color">
                            <span class="color-preview" style="background-color: ${subject.color}"></span>
                            <span style="font-size: 12px; color: #6b7280;">${subject.color}</span>
                        </div>
                    </td>
                    <td>
                        <span class="cell-status ${subject.isActive ? 'status-active' : 'status-inactive'}">
                            ${subject.isActive ? '‚úì Ho·∫°t ƒë·ªông' : '‚úó Ng·ª´ng'}
                        </span>
                    </td>
                    <td>
                        <div class="cell-actions">
                            <button class="btn btn-sm btn-secondary" onclick="SubjectsModule.showDetailModal('${subject.id}')" title="Xem chi ti·∫øt">
                                üëÅÔ∏è
                            </button>
                            <button class="btn btn-sm btn-warning" onclick="SubjectsModule.showEditModal('${subject.id}')" title="S·ª≠a">
                                ‚úèÔ∏è
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="SubjectsModule.showDeleteConfirm('${subject.id}')" title="X√≥a">
                                üóëÔ∏è
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        // Render pagination
        this.renderPagination(pagination, totalItems, totalPages);
    },
    
    // ========================================
    // RENDER PH√ÇN TRANG
    // ========================================
    renderPagination(container, totalItems, totalPages) {
        if (totalItems === 0) {
            container.innerHTML = '';
            return;
        }
        
        const startItem = (this.currentPage - 1) * this.itemsPerPage + 1;
        const endItem = Math.min(this.currentPage * this.itemsPerPage, totalItems);
        
        let paginationButtons = '';
        
        // N√∫t Previous
        paginationButtons += `
            <button class="pagination-btn" onclick="SubjectsModule.goToPage(${this.currentPage - 1})" ${this.currentPage === 1 ? 'disabled' : ''}>
                ‚Äπ
            </button>
        `;
        
        // C√°c n√∫t s·ªë trang
        for (let i = 1; i <= totalPages; i++) {
            if (
                i === 1 || 
                i === totalPages || 
                (i >= this.currentPage - 1 && i <= this.currentPage + 1)
            ) {
                paginationButtons += `
                    <button class="pagination-btn ${i === this.currentPage ? 'active' : ''}" onclick="SubjectsModule.goToPage(${i})">
                        ${i}
                    </button>
                `;
            } else if (i === this.currentPage - 2 || i === this.currentPage + 2) {
                paginationButtons += `<span style="padding: 0 8px;">...</span>`;
            }
        }
        
        // N√∫t Next
        paginationButtons += `
            <button class="pagination-btn" onclick="SubjectsModule.goToPage(${this.currentPage + 1})" ${this.currentPage === totalPages ? 'disabled' : ''}>
                ‚Ä∫
            </button>
        `;
        
        container.innerHTML = `
            <div class="pagination-info">
                Hi·ªÉn th·ªã ${startItem} - ${endItem} trong t·ªïng s·ªë ${totalItems} m√¥n h·ªçc
            </div>
            <div class="pagination-buttons">
                ${paginationButtons}
            </div>
        `;
    },
    
    // ========================================
    // CHUY·ªÇN TRANG
    // ========================================
    goToPage(page) {
        const subjects = DataManager.getAll(STORAGE_KEYS.subjects);
        const totalPages = Math.ceil(subjects.length / this.itemsPerPage);
        
        if (page < 1 || page > totalPages) return;
        
        this.currentPage = page;
        this.renderTable();
    },
    
    // ========================================
    // G·∫ÆN EVENT LISTENERS
    // ========================================
    attachEventListeners() {
        // T√¨m ki·∫øm
        const searchInput = document.getElementById('subjectSearch');
        if (searchInput) {
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    this.searchQuery = e.target.value;
                    this.currentPage = 1;
                    this.renderTable();
                }, 300);
            });
        }
        
        // L·ªçc tr·∫°ng th√°i
        const statusFilter = document.getElementById('subjectStatusFilter');
        if (statusFilter) {
            statusFilter.addEventListener('change', (e) => {
                this.filterStatus = e.target.value;
                this.currentPage = 1;
                this.renderTable();
            });
        }
    },
    
    // ========================================
    // MODAL TH√äM M√îN H·ªåC
    // ========================================
    showAddModal() {
        this.editingId = null;
        this.showFormModal('Th√™m m√¥n h·ªçc m·ªõi', null);
    },
    
    // ========================================
    // MODAL S·ª¨A M√îN H·ªåC
    // ========================================
    showEditModal(id) {
        const subject = DataManager.getById(STORAGE_KEYS.subjects, id);
        if (!subject) {
            UIManager.showNotification('Kh√¥ng t√¨m th·∫•y m√¥n h·ªçc!', 'error');
            return;
        }
        
        this.editingId = id;
        this.showFormModal('Ch·ªânh s·ª≠a m√¥n h·ªçc', subject);
    },
    
    // ========================================
    // RENDER FORM MODAL
    // ========================================
    showFormModal(title, data) {
        const isEdit = data !== null;
        const defaultColor = this.colorPresets[Math.floor(Math.random() * this.colorPresets.length)];
        
        const modalHtml = `
            <div class="modal-backdrop" id="subjectModal" onclick="SubjectsModule.closeModalOnBackdrop(event)">
                <div class="modal-content" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title">
                            <span>${isEdit ? '‚úèÔ∏è' : '‚ûï'}</span>
                            ${title}
                        </h3>
                        <button class="modal-close" onclick="SubjectsModule.closeModal()">&times;</button>
                    </div>
                    
                    <div class="modal-body">
                        <form id="subjectForm" onsubmit="SubjectsModule.handleSubmit(event)">
                            <!-- T√™n m√¥n h·ªçc -->
                            <div class="form-group">
                                <label class="form-label">
                                    T√™n m√¥n h·ªçc <span class="required">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    class="form-input" 
                                    id="subjectName" 
                                    name="name"
                                    value="${isEdit ? data.name : ''}"
                                    placeholder="V√≠ d·ª•: C·ªù vua, M·ªπ thu·∫≠t, Ti·∫øng Anh..."
                                    required
                                >
                                <div class="form-hint">M√£ m√¥n h·ªçc s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông t·∫°o t·ª´ t√™n</div>
                            </div>
                            
                            <!-- M√¥ t·∫£ -->
                            <div class="form-group">
                                <label class="form-label">M√¥ t·∫£</label>
                                <textarea 
                                    class="form-textarea" 
                                    id="subjectDescription" 
                                    name="description"
                                    placeholder="M√¥ t·∫£ ng·∫Øn v·ªÅ m√¥n h·ªçc..."
                                    rows="3"
                                >${isEdit ? (data.description || '') : ''}</textarea>
                            </div>
                            
                            <!-- Gi√° v√† th·ªùi l∆∞·ª£ng -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">
                                        Gi√° m·ªói bu·ªïi (VNƒê) <span class="required">*</span>
                                    </label>
                                    <input 
                                        type="number" 
                                        class="form-input" 
                                        id="subjectPrice" 
                                        name="pricePerSession"
                                        value="${isEdit ? data.pricePerSession : '100000'}"
                                        min="0"
                                        step="10000"
                                        required
                                    >
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        Th·ªùi l∆∞·ª£ng (ph√∫t) <span class="required">*</span>
                                    </label>
                                    <input 
                                        type="number" 
                                        class="form-input" 
                                        id="subjectDuration" 
                                        name="sessionDuration"
                                        value="${isEdit ? data.sessionDuration : '90'}"
                                        min="30"
                                        max="240"
                                        step="15"
                                        required
                                    >
                                </div>
                            </div>
                            
                            <!-- M√†u s·∫Øc -->
                            <div class="form-group">
                                <label class="form-label">M√†u hi·ªÉn th·ªã</label>
                                <div class="color-picker-group">
                                    <input 
                                        type="color" 
                                        class="color-picker-input" 
                                        id="subjectColor" 
                                        name="color"
                                        value="${isEdit ? data.color : defaultColor}"
                                        onchange="SubjectsModule.updateColorText(this.value)"
                                    >
                                    <input 
                                        type="text" 
                                        class="color-picker-text" 
                                        id="subjectColorText"
                                        value="${isEdit ? data.color : defaultColor}"
                                        onchange="SubjectsModule.updateColorPicker(this.value)"
                                        maxlength="7"
                                    >
                                </div>
                                <div class="color-presets" id="colorPresets">
                                    ${this.colorPresets.map(color => `
                                        <div 
                                            class="color-preset ${(isEdit ? data.color : defaultColor) === color ? 'selected' : ''}" 
                                            style="background-color: ${color}"
                                            onclick="SubjectsModule.selectColorPreset('${color}')"
                                            title="${color}"
                                        ></div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- Tr·∫°ng th√°i -->
                            <div class="form-group">
                                <label class="form-label">Tr·∫°ng th√°i</label>
                                <div class="toggle-group">
                                    <label class="toggle-switch">
                                        <input 
                                            type="checkbox" 
                                            id="subjectActive" 
                                            name="isActive"
                                            ${isEdit ? (data.isActive ? 'checked' : '') : 'checked'}
                                        >
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <span class="toggle-label" id="toggleLabel">
                                        ${isEdit ? (data.isActive ? 'ƒêang ho·∫°t ƒë·ªông' : 'Ng·ª´ng ho·∫°t ƒë·ªông') : 'ƒêang ho·∫°t ƒë·ªông'}
                                    </span>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="SubjectsModule.closeModal()">
                            H·ªßy b·ªè
                        </button>
                        <button type="submit" form="subjectForm" class="btn btn-primary">
                            <span>${isEdit ? 'üíæ' : '‚ûï'}</span>
                            <span>${isEdit ? 'L∆∞u thay ƒë·ªïi' : 'Th√™m m√¥n h·ªçc'}</span>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        // Th√™m modal v√†o body
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        
        // Focus v√†o input ƒë·∫ßu ti√™n
        setTimeout(() => {
            document.getElementById('subjectName').focus();
        }, 100);
        
        // G·∫Øn event cho toggle
        const toggleCheckbox = document.getElementById('subjectActive');
        toggleCheckbox.addEventListener('change', (e) => {
            document.getElementById('toggleLabel').textContent = 
                e.target.checked ? 'ƒêang ho·∫°t ƒë·ªông' : 'Ng·ª´ng ho·∫°t ƒë·ªông';
        });
    },
    
    // ========================================
    // X·ª¨ L√ù SUBMIT FORM
    // ========================================
    handleSubmit(event) {
        event.preventDefault();
        
        // L·∫•y d·ªØ li·ªáu t·ª´ form
        const name = document.getElementById('subjectName').value.trim();
        const description = document.getElementById('subjectDescription').value.trim();
        const pricePerSession = parseInt(document.getElementById('subjectPrice').value);
        const sessionDuration = parseInt(document.getElementById('subjectDuration').value);
        const color = document.getElementById('subjectColor').value;
        const isActive = document.getElementById('subjectActive').checked;
        
        // Validation
        if (!name) {
            UIManager.showNotification('Vui l√≤ng nh·∫≠p t√™n m√¥n h·ªçc!', 'error');
            document.getElementById('subjectName').focus();
            return;
        }
        
        if (pricePerSession < 0) {
            UIManager.showNotification('Gi√° kh√¥ng ƒë∆∞·ª£c √¢m!', 'error');
            document.getElementById('subjectPrice').focus();
            return;
        }
        
        if (sessionDuration < 30 || sessionDuration > 240) {
            UIManager.showNotification('Th·ªùi l∆∞·ª£ng ph·∫£i t·ª´ 30 ƒë·∫øn 240 ph√∫t!', 'error');
            document.getElementById('subjectDuration').focus();
            return;
        }
        
        // T·∫°o m√£ m√¥n h·ªçc t·ª´ t√™n
        const code = this.generateSubjectCode(name);
        
        // Ki·ªÉm tra tr√πng t√™n (tr·ª´ tr∆∞·ªùng h·ª£p ƒëang s·ª≠a ch√≠nh n√≥)
        const existingSubjects = DataManager.getAll(STORAGE_KEYS.subjects);
        const isDuplicate = existingSubjects.some(s => 
            s.name.toLowerCase() === name.toLowerCase() && s.id !== this.editingId
        );
        
        if (isDuplicate) {
            UIManager.showNotification('T√™n m√¥n h·ªçc ƒë√£ t·ªìn t·∫°i!', 'error');
            document.getElementById('subjectName').focus();
            return;
        }
        
        // T·∫°o/c·∫≠p nh·∫≠t ƒë·ªëi t∆∞·ª£ng
        const subjectData = {
            code,
            name,
            description,
            pricePerSession,
            sessionDuration,
            color,
            isActive,
        };
        
        if (this.editingId) {
            // C·∫≠p nh·∫≠t
            subjectData.updatedAt = getCurrentDateTime();
            DataManager.update(STORAGE_KEYS.subjects, this.editingId, subjectData);
            UIManager.showNotification('C·∫≠p nh·∫≠t m√¥n h·ªçc th√†nh c√¥ng!', 'success');
            
            // Ghi log
            SessionManager.logActivity('update', 'subjects', this.editingId, name, `C·∫≠p nh·∫≠t m√¥n h·ªçc: ${name}`);
        } else {
            // Th√™m m·ªõi
            subjectData.id = generateId('MH');
            subjectData.createdAt = getCurrentDateTime();
            DataManager.add(STORAGE_KEYS.subjects, subjectData);
            UIManager.showNotification('Th√™m m√¥n h·ªçc th√†nh c√¥ng!', 'success');
            
            // Ghi log
            SessionManager.logActivity('create', 'subjects', subjectData.id, name, `Th√™m m√¥n h·ªçc m·ªõi: ${name}`);
        }
        
        // ƒê√≥ng modal v√† refresh b·∫£ng
        this.closeModal();
        this.renderTable();
    },
    
    // ========================================
    // T·∫†O M√É M√îN H·ªåC T·ª™ T√äN
    // ========================================
    generateSubjectCode(name) {
        // L·∫•y ch·ªØ c√°i ƒë·∫ßu c·ªßa m·ªói t·ª´
        const words = name.split(' ').filter(w => w.length > 0);
        let code = '';
        
        if (words.length === 1) {
            // N·∫øu ch·ªâ c√≥ 1 t·ª´, l·∫•y 2-3 k√Ω t·ª± ƒë·∫ßu
            code = words[0].substring(0, 3).toUpperCase();
        } else {
            // L·∫•y ch·ªØ c√°i ƒë·∫ßu c·ªßa m·ªói t·ª´
            code = words.map(w => w.charAt(0).toUpperCase()).join('');
        }
        
        // Lo·∫°i b·ªè d·∫•u ti·∫øng Vi·ªát
        code = this.removeVietnameseTones(code);
        
        // Gi·ªõi h·∫°n 5 k√Ω t·ª±
        return code.substring(0, 5);
    },
    
    // ========================================
    // LO·∫†I B·ªé D·∫§U TI·∫æNG VI·ªÜT
    // ========================================
    removeVietnameseTones(str) {
        str = str.replace(/√†|√°|·∫°|·∫£|√£|√¢|·∫ß|·∫•|·∫≠|·∫©|·∫´|ƒÉ|·∫±|·∫Ø|·∫∑|·∫≥|·∫µ/g, 'a');
        str = str.replace(/√®|√©|·∫π|·∫ª|·∫Ω|√™|·ªÅ|·∫ø|·ªá|·ªÉ|·ªÖ/g, 'e');
        str = str.replace(/√¨|√≠|·ªã|·ªâ|ƒ©/g, 'i');
        str = str.replace(/√≤|√≥|·ªç|·ªè|√µ|√¥|·ªì|·ªë|·ªô|·ªï|·ªó|∆°|·ªù|·ªõ|·ª£|·ªü|·ª°/g, 'o');
        str = str.replace(/√π|√∫|·ª•|·ªß|≈©|∆∞|·ª´|·ª©|·ª±|·ª≠|·ªØ/g, 'u');
        str = str.replace(/·ª≥|√Ω|·ªµ|·ª∑|·ªπ/g, 'y');
        str = str.replace(/ƒë/g, 'd');
        str = str.replace(/√Ä|√Å|·∫†|·∫¢|√É|√Ç|·∫¶|·∫§|·∫¨|·∫®|·∫™|ƒÇ|·∫∞|·∫Æ|·∫∂|·∫≤|·∫¥/g, 'A');
        str = str.replace(/√à|√â|·∫∏|·∫∫|·∫º|√ä|·ªÄ|·∫æ|·ªÜ|·ªÇ|·ªÑ/g, 'E');
        str = str.replace(/√å|√ç|·ªä|·ªà|ƒ®/g, 'I');
        str = str.replace(/√í|√ì|·ªå|·ªé|√ï|√î|·ªí|·ªê|·ªò|·ªî|·ªñ|∆†|·ªú|·ªö|·ª¢|·ªû|·ª†/g, 'O');
        str = str.replace(/√ô|√ö|·ª§|·ª¶|≈®|∆Ø|·ª™|·ª®|·ª∞|·ª¨|·ªÆ/g, 'U');
        str = str.replace(/·ª≤|√ù|·ª¥|·ª∂|·ª∏/g, 'Y');
        str = str.replace(/ƒê/g, 'D');
        return str;
    },
    
    // ========================================
    // C·∫¨P NH·∫¨T M√ÄU T·ª™ COLOR PICKER
    // ========================================
    updateColorText(color) {
        document.getElementById('subjectColorText').value = color;
        this.updateColorPresetSelection(color);
    },
    
    // ========================================
    // C·∫¨P NH·∫¨T COLOR PICKER T·ª™ TEXT
    // ========================================
    updateColorPicker(color) {
        // Validate color format
        if (/^#[0-9A-Fa-f]{6}$/.test(color)) {
            document.getElementById('subjectColor').value = color;
            this.updateColorPresetSelection(color);
        }
    },
    
    // ========================================
    // CH·ªåN M√ÄU PRESET
    // ========================================
    selectColorPreset(color) {
        document.getElementById('subjectColor').value = color;
        document.getElementById('subjectColorText').value = color;
        this.updateColorPresetSelection(color);
    },
    
    // ========================================
    // C·∫¨P NH·∫¨T HI·ªÇN TH·ªä PRESET ƒê∆Ø·ª¢C CH·ªåN
    // ========================================
    updateColorPresetSelection(color) {
        document.querySelectorAll('.color-preset').forEach(preset => {
            preset.classList.remove('selected');
            if (preset.style.backgroundColor === color || 
                this.rgbToHex(preset.style.backgroundColor) === color.toLowerCase()) {
                preset.classList.add('selected');
            }
        });
    },
    
    // ========================================
    // CHUY·ªÇN RGB SANG HEX
    // ========================================
    rgbToHex(rgb) {
        if (rgb.startsWith('#')) return rgb;
        
        const result = rgb.match(/\d+/g);
        if (!result || result.length < 3) return rgb;
        
        return '#' + result.slice(0, 3).map(x => {
            const hex = parseInt(x).toString(16);
            return hex.length === 1 ? '0' + hex : hex;
        }).join('');
    },
    
    // ========================================
    // MODAL XEM CHI TI·∫æT
    // ========================================
    showDetailModal(id) {
        const subject = DataManager.getById(STORAGE_KEYS.subjects, id);
        if (!subject) {
            UIManager.showNotification('Kh√¥ng t√¨m th·∫•y m√¥n h·ªçc!', 'error');
            return;
        }
        
        // ƒê·∫øm s·ªë l·ªõp ƒëang s·ª≠ d·ª•ng m√¥n h·ªçc n√†y
        const classes = DataManager.getAll(STORAGE_KEYS.classes);
        const classCount = classes.filter(c => c.subjectId === id).length;
        
        const modalHtml = `
            <div class="modal-backdrop" id="subjectModal" onclick="SubjectsModule.closeModalOnBackdrop(event)">
                <div class="modal-content" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title">
                            <span>üìñ</span>
                            Chi ti·∫øt m√¥n h·ªçc
                        </h3>
                        <button class="modal-close" onclick="SubjectsModule.closeModal()">&times;</button>
                    </div>
                    
                    <div class="modal-body">
                        <div class="detail-grid">
                            <div class="detail-row">
                                <div class="detail-item">
                                    <span class="detail-label">M√£ m√¥n h·ªçc</span>
                                    <span class="detail-value">
                                        <span class="cell-code">${subject.code}</span>
                                    </span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Tr·∫°ng th√°i</span>
                                    <span class="detail-value">
                                        <span class="cell-status ${subject.isActive ? 'status-active' : 'status-inactive'}">
                                            ${subject.isActive ? '‚úì ƒêang ho·∫°t ƒë·ªông' : '‚úó Ng·ª´ng ho·∫°t ƒë·ªông'}
                                        </span>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="detail-item">
                                <span class="detail-label">T√™n m√¥n h·ªçc</span>
                                <span class="detail-value" style="font-size: 18px; font-weight: 700;">${subject.name}</span>
                            </div>
                            
                            ${subject.description ? `
                                <div class="detail-item">
                                    <span class="detail-label">M√¥ t·∫£</span>
                                    <span class="detail-value">${subject.description}</span>
                                </div>
                            ` : ''}
                            
                            <div class="detail-row">
                                <div class="detail-item">
                                    <span class="detail-label">Gi√° m·ªói bu·ªïi</span>
                                    <span class="detail-value cell-price">${formatCurrency(subject.pricePerSession)}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Th·ªùi l∆∞·ª£ng</span>
                                    <span class="detail-value">${subject.sessionDuration} ph√∫t</span>
                                </div>
                            </div>
                            
                            <div class="detail-row">
                                <div class="detail-item">
                                    <span class="detail-label">M√†u hi·ªÉn th·ªã</span>
                                    <div class="detail-color">
                                        <span class="detail-color-box" style="background-color: ${subject.color}"></span>
                                        <span class="detail-value">${subject.color}</span>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">S·ªë l·ªõp ƒëang d·∫°y</span>
                                    <span class="detail-value">${classCount} l·ªõp</span>
                                </div>
                            </div>
                            
                            <div class="detail-row">
                                <div class="detail-item">
                                    <span class="detail-label">Ng√†y t·∫°o</span>
                                    <span class="detail-value">${subject.createdAt ? new Date(subject.createdAt).toLocaleDateString('vi-VN') : 'N/A'}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">C·∫≠p nh·∫≠t l·∫ßn cu·ªëi</span>
                                    <span class="detail-value">${subject.updatedAt ? new Date(subject.updatedAt).toLocaleString('vi-VN') : 'Ch∆∞a c·∫≠p nh·∫≠t'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="SubjectsModule.closeModal()">
                            ƒê√≥ng
                        </button>
                        <button type="button" class="btn btn-warning" onclick="SubjectsModule.closeModal(); SubjectsModule.showEditModal('${subject.id}')">
                            <span>‚úèÔ∏è</span>
                            <span>Ch·ªânh s·ª≠a</span>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },
    
    // ========================================
    // MODAL X√ÅC NH·∫¨N X√ìA
    // ========================================
    showDeleteConfirm(id) {
        const subject = DataManager.getById(STORAGE_KEYS.subjects, id);
        if (!subject) {
            UIManager.showNotification('Kh√¥ng t√¨m th·∫•y m√¥n h·ªçc!', 'error');
            return;
        }
        
        // Ki·ªÉm tra xem c√≥ l·ªõp n√†o ƒëang s·ª≠ d·ª•ng m√¥n h·ªçc n√†y kh√¥ng
        const classes = DataManager.getAll(STORAGE_KEYS.classes);
        const classCount = classes.filter(c => c.subjectId === id).length;
        
        if (classCount > 0) {
            UIManager.showNotification(`Kh√¥ng th·ªÉ x√≥a! C√≥ ${classCount} l·ªõp ƒëang s·ª≠ d·ª•ng m√¥n h·ªçc n√†y.`, 'error');
            return;
        }
        
        const modalHtml = `
            <div class="modal-backdrop" id="subjectModal" onclick="SubjectsModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 420px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title">
                            <span>‚ö†Ô∏è</span>
                            X√°c nh·∫≠n x√≥a
                        </h3>
                        <button class="modal-close" onclick="SubjectsModule.closeModal()">&times;</button>
                    </div>
                    
                    <div class="modal-body">
                        <div class="confirm-dialog">
                            <div class="confirm-icon">üóëÔ∏è</div>
                            <div class="confirm-title">X√≥a m√¥n h·ªçc n√†y?</div>
                            <div class="confirm-message">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a m√¥n h·ªçc:</div>
                            <div class="confirm-highlight">${subject.name}</div>
                            <div class="confirm-message" style="margin-top: 12px; color: #ef4444;">
                                H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="SubjectsModule.closeModal()">
                            H·ªßy b·ªè
                        </button>
                        <button type="button" class="btn btn-danger" onclick="SubjectsModule.deleteSubject('${subject.id}')">
                            <span>üóëÔ∏è</span>
                            <span>X√≥a m√¥n h·ªçc</span>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },
    
    // ========================================
    // X√ìA M√îN H·ªåC
    // ========================================
    deleteSubject(id) {
        const subject = DataManager.getById(STORAGE_KEYS.subjects, id);
        if (!subject) {
            UIManager.showNotification('Kh√¥ng t√¨m th·∫•y m√¥n h·ªçc!', 'error');
            return;
        }
        
        // X√≥a
        DataManager.delete(STORAGE_KEYS.subjects, id);
        
        // Ghi log
        SessionManager.logActivity('delete', 'subjects', id, subject.name, `X√≥a m√¥n h·ªçc: ${subject.name}`);
        
        // Th√¥ng b√°o v√† refresh
        UIManager.showNotification('ƒê√£ x√≥a m√¥n h·ªçc th√†nh c√¥ng!', 'success');
        this.closeModal();
        this.renderTable();
    },
    
    // ========================================
    // ƒê√ìNG MODAL
    // ========================================
    closeModal() {
        const modal = document.getElementById('subjectModal');
        if (modal) {
            modal.remove();
        }
        this.editingId = null;
    },
    
    // ========================================
    // ƒê√ìNG MODAL KHI CLICK BACKDROP
    // ========================================
    closeModalOnBackdrop(event) {
        if (event.target.id === 'subjectModal') {
            this.closeModal();
        }
    },
};

// ------------------------------------------------------------
// 2. C·∫¨P NH·∫¨T UIMANAGER ƒê·ªÇ LOAD TRANG M√îN H·ªåC
// ------------------------------------------------------------

// Ghi ƒë√® h√†m renderPageContent ƒë·ªÉ x·ª≠ l√Ω trang subjects
const originalRenderPageContent = UIManager.renderPageContent.bind(UIManager);
UIManager.renderPageContent = function(pageName) {
    if (pageName === 'subjects') {
        SubjectsModule.render();
    } else {
        originalRenderPageContent(pageName);
    }
};

console.log('‚úÖ Task 1.4 - Module M√¥n h·ªçc ƒë√£ load');
// ============================================================
// TASK: MODULE QU·∫¢N L√ù L·ªöP H·ªåC + PH√íNG H·ªåC
// Th√™m v√†o cu·ªëi th·∫ª <script> trong file index.html
// ============================================================

// ------------------------------------------------------------
// 1. CLASSES MODULE - QU·∫¢N L√ù L·ªöP H·ªåC
// ------------------------------------------------------------
const ClassesModule = {
    // State
    searchQuery: '',
    filterStatus: 'all',
    filterSubject: 'all',
    
    // ========================================
    // RENDER TRANG CH√çNH
    // ========================================
    render() {
        const contentArea = document.getElementById('contentArea');
        const stats = this.getStats();
        
        contentArea.innerHTML = `
            <!-- STATS BAR -->
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-item-icon blue">üìö</div>
                    <div class="stat-item-info">
                        <div class="stat-item-value blue">${stats.total}</div>
                        <div class="stat-item-label">T·ªïng l·ªõp</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-item-icon green">‚úÖ</div>
                    <div class="stat-item-info">
                        <div class="stat-item-value green">${stats.active}</div>
                        <div class="stat-item-label">ƒêang h·ªçc</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-item-icon yellow">üïê</div>
                    <div class="stat-item-info">
                        <div class="stat-item-value yellow">${stats.upcoming}</div>
                        <div class="stat-item-label">S·∫Øp m·ªü</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-item-icon purple">üéì</div>
                    <div class="stat-item-info">
                        <div class="stat-item-value purple">${stats.completed}</div>
                        <div class="stat-item-label">Ho√†n th√†nh</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-item-icon pink">üë®‚Äçüéì</div>
                    <div class="stat-item-info">
                        <div class="stat-item-value pink">${stats.totalStudents}</div>
                        <div class="stat-item-label">H·ªçc vi√™n</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-item-icon green">üí∞</div>
                    <div class="stat-item-info">
                        <div class="stat-item-value green">${this.formatShortCurrency(stats.revenue)}</div>
                        <div class="stat-item-label">Doanh thu</div>
                    </div>
                </div>
            </div>
            
            <!-- TOOLBAR -->
            <div class="classes-toolbar">
                <div class="classes-filters">
                    <div class="search-box">
                        <input 
                            type="text" 
                            id="classSearch" 
                            placeholder="T√¨m ki·∫øm l·ªõp h·ªçc..."
                            value="${this.searchQuery}"
                        >
                    </div>
                    <select class="filter-select" id="classStatusFilter">
                        <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="active" ${this.filterStatus === 'active' ? 'selected' : ''}>ƒêang h·ªçc</option>
                        <option value="upcoming" ${this.filterStatus === 'upcoming' ? 'selected' : ''}>S·∫Øp m·ªü</option>
                        <option value="completed" ${this.filterStatus === 'completed' ? 'selected' : ''}>Ho√†n th√†nh</option>
                        <option value="cancelled" ${this.filterStatus === 'cancelled' ? 'selected' : ''}>ƒê√£ h·ªßy</option>
                    </select>
                    <select class="filter-select" id="classSubjectFilter">
                        <option value="all">T·∫•t c·∫£ m√¥n h·ªçc</option>
                        ${this.renderSubjectOptions()}
                    </select>
                    <button class="room-manager-btn" onclick="ClassesModule.showRoomManager()">
                        üè´ Qu·∫£n l√Ω ph√≤ng h·ªçc
                    </button>
                </div>
                <div class="toolbar-right">
                    <button class="btn btn-primary" onclick="ClassesModule.showAddModal()">
                        <span>‚ûï</span>
                        <span>T·∫°o l·ªõp m·ªõi</span>
                    </button>
                </div>
            </div>
            
            <!-- CLASSES GRID -->
            <div class="classes-grid" id="classesGrid">
                ${this.renderClassCards()}
            </div>
        `;
        
        this.attachEventListeners();
    },
    
    // ========================================
    // L·∫§Y TH·ªêNG K√ä
    // ========================================
    getStats() {
        const classes = DataManager.getAll(STORAGE_KEYS.classes);
        const enrollments = DataManager.getAll(STORAGE_KEYS.enrollments);
        const tuitions = DataManager.getAll(STORAGE_KEYS.tuitions);
        
        return {
            total: classes.length,
            active: classes.filter(c => c.status === 'active').length,
            upcoming: classes.filter(c => c.status === 'upcoming').length,
            completed: classes.filter(c => c.status === 'completed').length,
            totalStudents: enrollments.filter(e => e.status === 'active').length,
            revenue: tuitions.reduce((sum, t) => sum + (t.paidAmount || 0), 0),
        };
    },
    
    // ========================================
    // FORMAT TI·ªÄN T·ªÜ NG·∫ÆN
    // ========================================
    formatShortCurrency(amount) {
        if (amount >= 1000000000) {
            return (amount / 1000000000).toFixed(1) + 'B';
        } else if (amount >= 1000000) {
            return (amount / 1000000).toFixed(1) + 'M';
        } else if (amount >= 1000) {
            return (amount / 1000).toFixed(0) + 'K';
        }
        return amount.toString();
    },
    
    // ========================================
    // RENDER OPTIONS M√îN H·ªåC
    // ========================================
    renderSubjectOptions() {
        const subjects = DataManager.getAll(STORAGE_KEYS.subjects);
        return subjects.map(s => 
            `<option value="${s.id}" ${this.filterSubject === s.id ? 'selected' : ''}>${s.name}</option>`
        ).join('');
    },
    
    // ========================================
    // RENDER CLASS CARDS
    // ========================================
    renderClassCards() {
        let classes = DataManager.getAll(STORAGE_KEYS.classes);
        
        // T√¨m ki·∫øm
        if (this.searchQuery) {
            const query = this.searchQuery.toLowerCase();
            classes = classes.filter(c => 
                c.name.toLowerCase().includes(query) ||
                c.code.toLowerCase().includes(query) ||
                c.teacherName.toLowerCase().includes(query)
            );
        }
        
        // L·ªçc theo tr·∫°ng th√°i
        if (this.filterStatus !== 'all') {
            classes = classes.filter(c => c.status === this.filterStatus);
        }
        
        // L·ªçc theo m√¥n h·ªçc
        if (this.filterSubject !== 'all') {
            classes = classes.filter(c => c.subjectId === this.filterSubject);
        }
        
        if (classes.length === 0) {
            return `
                <div class="classes-empty">
                    <div class="classes-empty-icon">üìö</div>
                    <div class="classes-empty-title">Kh√¥ng c√≥ l·ªõp h·ªçc n√†o</div>
                    <div class="classes-empty-desc">
                        ${this.searchQuery || this.filterStatus !== 'all' || this.filterSubject !== 'all'
                            ? 'Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm'
                            : 'B·∫•m n√∫t "T·∫°o l·ªõp m·ªõi" ƒë·ªÉ b·∫Øt ƒë·∫ßu'}
                    </div>
                    ${!this.searchQuery && this.filterStatus === 'all' && this.filterSubject === 'all' ? `
                        <button class="btn btn-primary" onclick="ClassesModule.showAddModal()">
                            <span>‚ûï</span>
                            <span>T·∫°o l·ªõp h·ªçc ƒë·∫ßu ti√™n</span>
                        </button>
                    ` : ''}
                </div>
            `;
        }
        
        return classes.map(cls => this.renderClassCard(cls)).join('');
    },
    
    // ========================================
    // RENDER M·ªòT CLASS CARD
    // ========================================
    renderClassCard(cls) {
        const subject = DataManager.getById(STORAGE_KEYS.subjects, cls.subjectId);
        const enrollments = DataManager.getAll(STORAGE_KEYS.enrollments).filter(e => e.classId === cls.id);
        const currentStudents = enrollments.length;
        
        // T√≠nh ti·∫øn ƒë·ªô
        const progress = cls.totalSessions > 0 
            ? Math.round((this.getCompletedSessions(cls.id) / cls.totalSessions) * 100) 
            : 0;
        
        // X√°c ƒë·ªãnh m√†u progress
        let progressColor = 'blue';
        if (progress >= 100) progressColor = 'green';
        else if (progress >= 50) progressColor = 'blue';
        else if (progress >= 25) progressColor = 'yellow';
        else progressColor = 'red';
        
        // Schedule text
        const scheduleText = cls.schedule ? cls.schedule.map(s => {
            const days = ['', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'CN'];
            return `${days[s.dayOfWeek]} - ${s.startTime}`;
        }).join(', ') : 'Ch∆∞a c√≥ l·ªãch';
        
        // Status label
        const statusLabels = {
            'active': 'ƒêang h·ªçc',
            'upcoming': 'S·∫Øp m·ªü',
            'completed': 'Ho√†n th√†nh',
            'cancelled': 'ƒê√£ h·ªßy'
        };
        
        // Level label
        const levelLabels = {
            'beginner': 'C∆° b·∫£n',
            'intermediate': 'N√¢ng cao',
            'advanced': 'Chuy√™n s√¢u'
        };
        
        return `
            <div class="class-card" data-id="${cls.id}">
                <div class="class-card-header">
                    <div class="class-card-icon" style="background: ${subject ? subject.color + '20' : '#f3f4f6'}">
                        ${subject ? 'üìñ' : 'üìö'}
                    </div>
                    <div class="class-card-title-group">
                        <div class="class-card-title">${cls.name}</div>
                        <div class="class-card-code">${cls.code}</div>
                    </div>
                    <div class="class-card-tags">
                        <span class="class-tag ${cls.status}">${statusLabels[cls.status] || cls.status}</span>
                        ${cls.level ? `<span class="class-tag level">${levelLabels[cls.level] || cls.level}</span>` : ''}
                    </div>
                </div>
                
                <div class="class-card-body">
                    <div class="class-info-row">
                        <span class="class-info-icon">üë®‚Äçüè´</span>
                        <span class="class-info-label">Gi√°o vi√™n:</span>
                        <span class="class-info-value">${cls.teacherName || 'Ch∆∞a ph√¢n c√¥ng'}</span>
                    </div>
                    <div class="class-info-row">
                        <span class="class-info-icon">üè´</span>
                        <span class="class-info-label">Ph√≤ng h·ªçc:</span>
                        <span class="class-info-value">${cls.roomName || 'Ch∆∞a x·∫øp ph√≤ng'}</span>
                    </div>
                    <div class="class-info-row">
                        <span class="class-info-icon">üïê</span>
                        <span class="class-info-label">L·ªãch h·ªçc:</span>
                        <span class="class-info-value">${scheduleText}</span>
                    </div>
                    <div class="class-info-row">
                        <span class="class-info-icon">üë•</span>
                        <span class="class-info-label">Sƒ© s·ªë:</span>
                        <span class="class-info-value">${currentStudents}/${cls.maxStudents} h·ªçc vi√™n</span>
                    </div>
                    
                    <div class="class-progress-section">
                        <div class="class-progress-header">
                            <span class="class-progress-label">Ti·∫øn ƒë·ªô:</span>
                            <span class="class-progress-value">${this.getCompletedSessions(cls.id)}/${cls.totalSessions} bu·ªïi</span>
                        </div>
                        <div class="class-progress-bar">
                            <div class="class-progress-fill ${progressColor}" style="width: ${progress}%"></div>
                        </div>
                    </div>
                    
                    <div class="class-dates-row">
                        <div class="class-date-item">
                            <div class="class-date-label">B·∫Øt ƒë·∫ßu</div>
                            <div class="class-date-value">${cls.startDate ? new Date(cls.startDate).toLocaleDateString('vi-VN') : 'Ch∆∞a x√°c ƒë·ªãnh'}</div>
                        </div>
                        <div class="class-date-item">
                            <div class="class-date-label">K·∫øt th√∫c</div>
                            <div class="class-date-value">${cls.endDate ? new Date(cls.endDate).toLocaleDateString('vi-VN') : 'Ch∆∞a x√°c ƒë·ªãnh'}</div>
                        </div>
                    </div>
                    
                    <div class="class-price-row">
                        <span class="class-price-label">H·ªçc ph√≠:</span>
                        <span class="class-price-value">${formatCurrency(cls.pricePerSession * cls.totalSessions)}</span>
                    </div>
                </div>
                
                <div class="class-card-footer">
                    <button class="btn btn-secondary btn-sm" onclick="ClassesModule.showDetailModal('${cls.id}')">
                        üëÅÔ∏è Chi ti·∫øt
                    </button>
                    <button class="btn btn-warning btn-sm" onclick="ClassesModule.showEditModal('${cls.id}')">
                        ‚úèÔ∏è Ch·ªânh s·ª≠a
                    </button>
                </div>
            </div>
        `;
    },
    
    // ========================================
    // ƒê·∫æM BU·ªîI H·ªåC ƒê√É HO√ÄN TH√ÄNH
    // ========================================
    getCompletedSessions(classId) {
        const sessions = DataManager.getAll(STORAGE_KEYS.sessions);
        return sessions.filter(s => s.classId === classId && s.status === 'completed').length;
    },
    
    // ========================================
    // G·∫ÆN EVENT LISTENERS
    // ========================================
    attachEventListeners() {
        // T√¨m ki·∫øm
        const searchInput = document.getElementById('classSearch');
        if (searchInput) {
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    this.searchQuery = e.target.value;
                    document.getElementById('classesGrid').innerHTML = this.renderClassCards();
                }, 300);
            });
        }
        
        // L·ªçc tr·∫°ng th√°i
        const statusFilter = document.getElementById('classStatusFilter');
        if (statusFilter) {
            statusFilter.addEventListener('change', (e) => {
                this.filterStatus = e.target.value;
                document.getElementById('classesGrid').innerHTML = this.renderClassCards();
            });
        }
        
        // L·ªçc m√¥n h·ªçc
        const subjectFilter = document.getElementById('classSubjectFilter');
        if (subjectFilter) {
            subjectFilter.addEventListener('change', (e) => {
                this.filterSubject = e.target.value;
                document.getElementById('classesGrid').innerHTML = this.renderClassCards();
            });
        }
    },
    
    // ========================================
    // MODAL CHI TI·∫æT L·ªöP H·ªåC
    // ========================================
    showDetailModal(id) {
        const cls = DataManager.getById(STORAGE_KEYS.classes, id);
        if (!cls) {
            UIManager.showNotification('Kh√¥ng t√¨m th·∫•y l·ªõp h·ªçc!', 'error');
            return;
        }
        
        const subject = DataManager.getById(STORAGE_KEYS.subjects, cls.subjectId);
        const enrollments = DataManager.getAll(STORAGE_KEYS.enrollments).filter(e => e.classId === id);
        const sessions = DataManager.getAll(STORAGE_KEYS.sessions).filter(s => s.classId === id);
        
        const modalHtml = `
            <div class="modal-backdrop" id="classModal" onclick="ClassesModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 700px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title">
                            <span>üìö</span>
                            Chi ti·∫øt l·ªõp h·ªçc
                        </h3>
                        <button class="modal-close" onclick="ClassesModule.closeModal()">&times;</button>
                    </div>
                    
                    <!-- Class Info Header -->
                    <div style="padding: 20px; background: #f9fafb; border-bottom: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div class="class-card-icon" style="background: ${subject ? subject.color + '20' : '#e5e7eb'}; width: 60px; height: 60px; font-size: 28px;">
                                üìñ
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 20px; font-weight: 700; color: #1f2937; margin-bottom: 4px;">${cls.name}</div>
                                <div style="font-size: 14px; color: #6b7280;">${cls.code} ‚Ä¢ ${cls.subjectName}</div>
                            </div>
                            <span class="class-tag ${cls.status}" style="font-size: 13px; padding: 6px 14px;">
                                ${cls.status === 'active' ? 'ƒêang h·ªçc' : cls.status === 'upcoming' ? 'S·∫Øp m·ªü' : cls.status === 'completed' ? 'Ho√†n th√†nh' : 'ƒê√£ h·ªßy'}
                            </span>
                        </div>
                    </div>
                    
                    <!-- Tabs -->
                    <div class="modal-tabs">
                        <button class="modal-tab active" onclick="ClassesModule.switchTab('info', this)">Th√¥ng tin</button>
                        <button class="modal-tab" onclick="ClassesModule.switchTab('students', this)">H·ªçc vi√™n (${enrollments.length})</button>
                        <button class="modal-tab" onclick="ClassesModule.switchTab('sessions', this)">Bu·ªïi h·ªçc (${sessions.length})</button>
                    </div>
                    
                    <!-- Tab Contents -->
                    <div class="modal-tab-content active" id="tab-info">
                        <div class="detail-grid">
                            <div class="detail-row">
                                <div class="detail-item">
                                    <span class="detail-label">Gi√°o vi√™n</span>
                                    <span class="detail-value">${cls.teacherName || 'Ch∆∞a ph√¢n c√¥ng'}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ph√≤ng h·ªçc</span>
                                    <span class="detail-value">${cls.roomName || 'Ch∆∞a x·∫øp ph√≤ng'}</span>
                                </div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-item">
                                    <span class="detail-label">Ng√†y b·∫Øt ƒë·∫ßu</span>
                                    <span class="detail-value">${cls.startDate ? new Date(cls.startDate).toLocaleDateString('vi-VN') : 'Ch∆∞a x√°c ƒë·ªãnh'}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ng√†y k·∫øt th√∫c</span>
                                    <span class="detail-value">${cls.endDate ? new Date(cls.endDate).toLocaleDateString('vi-VN') : 'Ch∆∞a x√°c ƒë·ªãnh'}</span>
                                </div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-item">
                                    <span class="detail-label">T·ªïng bu·ªïi h·ªçc</span>
                                    <span class="detail-value">${cls.totalSessions} bu·ªïi</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ƒê√£ h·ªçc</span>
                                    <span class="detail-value">${this.getCompletedSessions(id)} bu·ªïi</span>
                                </div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-item">
                                    <span class="detail-label">Sƒ© s·ªë t·ªëi ƒëa</span>
                                    <span class="detail-value">${cls.maxStudents} h·ªçc vi√™n</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ƒêang h·ªçc</span>
                                    <span class="detail-value">${enrollments.length} h·ªçc vi√™n</span>
                                </div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">H·ªçc ph√≠</span>
                                <span class="detail-value cell-price">${formatCurrency(cls.pricePerSession * cls.totalSessions)}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-tab-content" id="tab-students">
                        <div class="student-list-header">
                            <span class="student-list-count">${enrollments.length} h·ªçc vi√™n ƒëang h·ªçc</span>
                        </div>
                        <div class="student-list">
                            ${enrollments.length === 0 ? '<p style="text-align: center; color: #6b7280; padding: 20px;">Ch∆∞a c√≥ h·ªçc vi√™n n√†o</p>' : 
                                enrollments.map(e => {
                                    const student = DataManager.getById(STORAGE_KEYS.students, e.studentId);
                                    return `
                                        <div class="student-item">
                                            <div class="student-avatar">${student ? student.name.charAt(0) : '?'}</div>
                                            <div class="student-info">
                                                <div class="student-name">${e.studentName}</div>
                                                <div class="student-meta">${student ? student.parentPhone : ''}</div>
                                            </div>
                                            <div class="student-sessions">
                                                <div class="student-sessions-value">${e.usedSessions}/${e.totalSessions}</div>
                                                <div class="student-sessions-label">bu·ªïi</div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')
                            }
                        </div>
                    </div>
                    
                    <div class="modal-tab-content" id="tab-sessions">
                        <div class="session-list">
                            ${sessions.length === 0 ? '<p style="text-align: center; color: #6b7280; padding: 20px;">Ch∆∞a c√≥ bu·ªïi h·ªçc n√†o</p>' :
                                sessions.sort((a, b) => a.sessionNumber - b.sessionNumber).map(s => `
                                    <div class="session-item">
                                        <div class="session-number">${s.sessionNumber}</div>
                                        <div class="session-info">
                                            <div class="session-date">${new Date(s.date).toLocaleDateString('vi-VN')} - ${s.startTime}</div>
                                            <div class="session-topic">${s.topic || 'Ch∆∞a c√≥ ch·ªß ƒë·ªÅ'}</div>
                                        </div>
                                        <span class="session-status ${s.status}">${s.status === 'completed' ? 'ƒê√£ h·ªçc' : s.status === 'scheduled' ? 'ƒê√£ l√™n l·ªãch' : s.status}</span>
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="ClassesModule.closeModal()">
                            ƒê√≥ng
                        </button>
                        <button type="button" class="btn btn-warning" onclick="ClassesModule.closeModal(); ClassesModule.showEditModal('${cls.id}')">
                            <span>‚úèÔ∏è</span>
                            <span>Ch·ªânh s·ª≠a l·ªõp h·ªçc</span>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },
    
    // ========================================
    // CHUY·ªÇN TAB
    // ========================================
    switchTab(tabName, btn) {
        // Update tab buttons
        document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        
        // Update tab contents
        document.querySelectorAll('.modal-tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById('tab-' + tabName).classList.add('active');
    },
    
    // ========================================
    // MODAL TH√äM L·ªöP H·ªåC
    // ========================================
    showAddModal() {
        this.showFormModal('T·∫°o l·ªõp h·ªçc m·ªõi', null);
    },
    
    // ========================================
    // MODAL S·ª¨A L·ªöP H·ªåC
    // ========================================
    showEditModal(id) {
        const cls = DataManager.getById(STORAGE_KEYS.classes, id);
        if (!cls) {
            UIManager.showNotification('Kh√¥ng t√¨m th·∫•y l·ªõp h·ªçc!', 'error');
            return;
        }
        this.showFormModal('Ch·ªânh s·ª≠a l·ªõp h·ªçc', cls);
    },
    
    // ========================================
    // RENDER FORM MODAL
    // ========================================
    showFormModal(title, data) {
        const isEdit = data !== null;
        const subjects = DataManager.getAll(STORAGE_KEYS.subjects);
        const teachers = DataManager.getAll(STORAGE_KEYS.teachers);
        const rooms = DataManager.getAll(STORAGE_KEYS.rooms);
        
        const modalHtml = `
            <div class="modal-backdrop" id="classModal" onclick="ClassesModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 650px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title">
                            <span>${isEdit ? '‚úèÔ∏è' : '‚ûï'}</span>
                            ${title}
                        </h3>
                        <button class="modal-close" onclick="ClassesModule.closeModal()">&times;</button>
                    </div>
                    
                    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                        <form id="classForm" onsubmit="ClassesModule.handleSubmit(event, ${isEdit ? `'${data.id}'` : 'null'})">
                            
                            <!-- T√™n l·ªõp -->
                            <div class="form-group">
                                <label class="form-label">T√™n l·ªõp h·ªçc <span class="required">*</span></label>
                                <input type="text" class="form-input" id="className" name="name" 
                                    value="${isEdit ? data.name : ''}" 
                                    placeholder="V√≠ d·ª•: C·ªù vua 8 bu·ªïi - T2,T4 - 17h00" required>
                            </div>
                            
                            <!-- M√¥n h·ªçc & Tr√¨nh ƒë·ªô -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">M√¥n h·ªçc <span class="required">*</span></label>
                                    <select class="form-select" id="classSubject" name="subjectId" required onchange="ClassesModule.onSubjectChange(this)">
                                        <option value="">-- Ch·ªçn m√¥n h·ªçc --</option>
                                        ${subjects.filter(s => s.isActive).map(s => 
                                            `<option value="${s.id}" data-price="${s.pricePerSession}" ${isEdit && data.subjectId === s.id ? 'selected' : ''}>${s.name}</option>`
                                        ).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Tr√¨nh ƒë·ªô</label>
                                    <select class="form-select" id="classLevel" name="level">
                                        <option value="beginner" ${isEdit && data.level === 'beginner' ? 'selected' : ''}>C∆° b·∫£n</option>
                                        <option value="intermediate" ${isEdit && data.level === 'intermediate' ? 'selected' : ''}>N√¢ng cao</option>
                                        <option value="advanced" ${isEdit && data.level === 'advanced' ? 'selected' : ''}>Chuy√™n s√¢u</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Gi√°o vi√™n & Ph√≤ng h·ªçc -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Gi√°o vi√™n <span class="required">*</span></label>
                                    <select class="form-select" id="classTeacher" name="teacherId" required>
                                        <option value="">-- Ch·ªçn gi√°o vi√™n --</option>
                                        ${teachers.filter(t => t.status === 'active').map(t => 
                                            `<option value="${t.id}" ${isEdit && data.teacherId === t.id ? 'selected' : ''}>${t.name}</option>`
                                        ).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Ph√≤ng h·ªçc <span class="required">*</span></label>
                                    <select class="form-select" id="classRoom" name="roomId" required>
                                        <option value="">-- Ch·ªçn ph√≤ng --</option>
                                        ${rooms.filter(r => r.status === 'active').map(r => 
                                            `<option value="${r.id}" ${isEdit && data.roomId === r.id ? 'selected' : ''}>${r.name} (${r.capacity} ch·ªó)</option>`
                                        ).join('')}
                                    </select>
                                </div>
                            </div>
                            
                            <!-- S·ªë bu·ªïi & Sƒ© s·ªë -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">T·ªïng s·ªë bu·ªïi <span class="required">*</span></label>
                                    <input type="number" class="form-input" id="classTotalSessions" name="totalSessions" 
                                        value="${isEdit ? data.totalSessions : '8'}" min="1" max="100" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Sƒ© s·ªë t·ªëi ƒëa <span class="required">*</span></label>
                                    <input type="number" class="form-input" id="classMaxStudents" name="maxStudents" 
                                        value="${isEdit ? data.maxStudents : '12'}" min="1" max="50" required>
                                </div>
                            </div>
                            
                            <!-- Ng√†y b·∫Øt ƒë·∫ßu & K·∫øt th√∫c -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Ng√†y b·∫Øt ƒë·∫ßu <span class="required">*</span></label>
                                    <input type="date" class="form-input" id="classStartDate" name="startDate" 
                                        value="${isEdit ? data.startDate : ''}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Ng√†y k·∫øt th√∫c (d·ª± ki·∫øn)</label>
                                    <input type="date" class="form-input" id="classEndDate" name="endDate" 
                                        value="${isEdit ? data.endDate : ''}">
                                </div>
                            </div>
                            
                            <!-- Gi√° / bu·ªïi & Tr·∫°ng th√°i -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Gi√° m·ªói bu·ªïi (VNƒê)</label>
                                    <input type="number" class="form-input" id="classPricePerSession" name="pricePerSession" 
                                        value="${isEdit ? data.pricePerSession : '100000'}" min="0" step="10000">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Tr·∫°ng th√°i</label>
                                    <select class="form-select" id="classStatus" name="status">
                                        <option value="upcoming" ${isEdit && data.status === 'upcoming' ? 'selected' : ''}>S·∫Øp m·ªü</option>
                                        <option value="active" ${isEdit && data.status === 'active' ? 'selected' : ''}>ƒêang h·ªçc</option>
                                        <option value="completed" ${isEdit && data.status === 'completed' ? 'selected' : ''}>Ho√†n th√†nh</option>
                                        <option value="cancelled" ${isEdit && data.status === 'cancelled' ? 'selected' : ''}>ƒê√£ h·ªßy</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- L·ªãch h·ªçc -->
                            <div class="form-group">
                                <label class="form-label">L·ªãch h·ªçc</label>
                                <div class="schedule-list" id="scheduleList">
                                    ${isEdit && data.schedule ? data.schedule.map((s, i) => this.renderScheduleItem(s, i)).join('') : this.renderScheduleItem(null, 0)}
                                </div>
                                <button type="button" class="schedule-add-btn" onclick="ClassesModule.addScheduleItem()">
                                    ‚ûï Th√™m l·ªãch h·ªçc
                                </button>
                            </div>
                            
                            <!-- Ghi ch√∫ -->
                            <div class="form-group">
                                <label class="form-label">Ghi ch√∫</label>
                                <textarea class="form-textarea" id="classNotes" name="notes" rows="2" 
                                    placeholder="Ghi ch√∫ th√™m v·ªÅ l·ªõp h·ªçc...">${isEdit ? (data.notes || '') : ''}</textarea>
                            </div>
                            
                        </form>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="ClassesModule.closeModal()">H·ªßy b·ªè</button>
                        <button type="submit" form="classForm" class="btn btn-primary">
                            <span>${isEdit ? 'üíæ' : '‚ûï'}</span>
                            <span>${isEdit ? 'L∆∞u thay ƒë·ªïi' : 'T·∫°o l·ªõp h·ªçc'}</span>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },
    
    // ========================================
    // RENDER SCHEDULE ITEM
    // ========================================
    renderScheduleItem(data, index) {
        const days = [
            { value: 2, label: 'Th·ª© 2' },
            { value: 3, label: 'Th·ª© 3' },
            { value: 4, label: 'Th·ª© 4' },
            { value: 5, label: 'Th·ª© 5' },
            { value: 6, label: 'Th·ª© 6' },
            { value: 7, label: 'Th·ª© 7' },
            { value: 1, label: 'Ch·ªß nh·∫≠t' },
        ];
        
        return `
            <div class="schedule-item" data-index="${index}">
                <select class="schedule-day" name="schedule_day_${index}">
                    ${days.map(d => `<option value="${d.value}" ${data && data.dayOfWeek === d.value ? 'selected' : ''}>${d.label}</option>`).join('')}
                </select>
                <input type="time" class="schedule-time" name="schedule_start_${index}" value="${data ? data.startTime : '17:00'}">
                <span>-</span>
                <input type="time" class="schedule-time" name="schedule_end_${index}" value="${data ? data.endTime : '18:30'}">
                <button type="button" class="schedule-remove" onclick="ClassesModule.removeScheduleItem(this)">‚úï</button>
            </div>
        `;
    },
    
    // ========================================
    // TH√äM SCHEDULE ITEM
    // ========================================
    addScheduleItem() {
        const list = document.getElementById('scheduleList');
        const index = list.children.length;
        list.insertAdjacentHTML('beforeend', this.renderScheduleItem(null, index));
    },
    
    // ========================================
    // X√ìA SCHEDULE ITEM
    // ========================================
    removeScheduleItem(btn) {
        const list = document.getElementById('scheduleList');
        if (list.children.length > 1) {
            btn.closest('.schedule-item').remove();
        } else {
            UIManager.showNotification('Ph·∫£i c√≥ √≠t nh·∫•t 1 l·ªãch h·ªçc!', 'warning');
        }
    },
    
    // ========================================
    // KHI CH·ªåN M√îN H·ªåC
    // ========================================
    onSubjectChange(select) {
        const option = select.options[select.selectedIndex];
        const price = option.getAttribute('data-price');
        if (price) {
            document.getElementById('classPricePerSession').value = price;
        }
    },
    
    // ========================================
    // X·ª¨ L√ù SUBMIT FORM
    // ========================================
    handleSubmit(event, editId) {
        event.preventDefault();
        
        const form = document.getElementById('classForm');
        const formData = new FormData(form);
        
        // L·∫•y th√¥ng tin m√¥n h·ªçc v√† gi√°o vi√™n
        const subject = DataManager.getById(STORAGE_KEYS.subjects, formData.get('subjectId'));
        const teacher = DataManager.getById(STORAGE_KEYS.teachers, formData.get('teacherId'));
        const room = DataManager.getById(STORAGE_KEYS.rooms, formData.get('roomId'));
        
        // Thu th·∫≠p l·ªãch h·ªçc
        const scheduleItems = document.querySelectorAll('.schedule-item');
        const schedule = [];
        scheduleItems.forEach((item, i) => {
            const day = parseInt(form.querySelector(`[name="schedule_day_${i}"]`)?.value);
            const start = form.querySelector(`[name="schedule_start_${i}"]`)?.value;
            const end = form.querySelector(`[name="schedule_end_${i}"]`)?.value;
            if (day && start && end) {
                schedule.push({ dayOfWeek: day, startTime: start, endTime: end });
            }
        });
        
        // T·∫°o m√£ l·ªõp
        const code = editId ? DataManager.getById(STORAGE_KEYS.classes, editId).code : this.generateClassCode(subject, schedule);
        
        const classData = {
            code,
            name: formData.get('name'),
            subjectId: formData.get('subjectId'),
            subjectName: subject ? subject.name : '',
            level: formData.get('level'),
            teacherId: formData.get('teacherId'),
            teacherName: teacher ? teacher.name : '',
            roomId: formData.get('roomId'),
            roomName: room ? room.name : '',
            schedule,
            classType: 'by-session',
            totalSessions: parseInt(formData.get('totalSessions')),
            maxStudents: parseInt(formData.get('maxStudents')),
            currentStudents: 0,
            startDate: formData.get('startDate'),
            endDate: formData.get('endDate'),
            pricePerSession: parseInt(formData.get('pricePerSession')) || 0,
            status: formData.get('status'),
            notes: formData.get('notes'),
        };
        
        if (editId) {
            classData.updatedAt = getCurrentDateTime();
            DataManager.update(STORAGE_KEYS.classes, editId, classData);
            UIManager.showNotification('C·∫≠p nh·∫≠t l·ªõp h·ªçc th√†nh c√¥ng!', 'success');
            SessionManager.logActivity('update', 'classes', editId, classData.name, `C·∫≠p nh·∫≠t l·ªõp h·ªçc: ${classData.name}`);
        } else {
            classData.id = generateId('LH');
            classData.createdAt = getCurrentDateTime();
            DataManager.add(STORAGE_KEYS.classes, classData);
            UIManager.showNotification('T·∫°o l·ªõp h·ªçc th√†nh c√¥ng!', 'success');
            SessionManager.logActivity('create', 'classes', classData.id, classData.name, `T·∫°o l·ªõp h·ªçc m·ªõi: ${classData.name}`);
        }
        
        this.closeModal();
        this.render();
    },
    
    // ========================================
    // T·∫†O M√É L·ªöP H·ªåC
    // ========================================
    generateClassCode(subject, schedule) {
        const subjectCode = subject ? subject.code : 'XX';
        const sessionCount = document.getElementById('classTotalSessions')?.value || '8';
        const days = schedule.map(s => {
            const dayMap = { 1: 'CN', 2: 'T2', 3: 'T3', 4: 'T4', 5: 'T5', 6: 'T6', 7: 'T7' };
            return dayMap[s.dayOfWeek];
        }).join('');
        const time = schedule[0] ? schedule[0].startTime.replace(':', 'h') : '17h';
        
        return `${subjectCode}${sessionCount}-${days}-${time}`;
    },
    
    // ========================================
    // QU·∫¢N L√ù PH√íNG H·ªåC
    // ========================================
    showRoomManager() {
        const rooms = DataManager.getAll(STORAGE_KEYS.rooms);
        
        const modalHtml = `
            <div class="modal-backdrop" id="roomModal" onclick="ClassesModule.closeRoomModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 600px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title">
                            <span>üè´</span>
                            Qu·∫£n l√Ω Ph√≤ng h·ªçc
                        </h3>
                        <button class="modal-close" onclick="ClassesModule.closeRoomModal()">&times;</button>
                    </div>
                    
                    <div class="modal-body">
                        <div style="display: flex; justify-content: flex-end; margin-bottom: 16px;">
                            <button class="btn btn-primary btn-sm" onclick="ClassesModule.showRoomForm(null)">
                                ‚ûï Th√™m ph√≤ng
                            </button>
                        </div>
                        
                        <div class="room-list" id="roomList">
                            ${rooms.length === 0 ? '<p style="text-align: center; color: #6b7280; padding: 20px;">Ch∆∞a c√≥ ph√≤ng h·ªçc n√†o</p>' :
                                rooms.map(r => `
                                    <div class="room-item">
                                        <div class="room-icon">üè´</div>
                                        <div class="room-info">
                                            <div class="room-name">${r.name}</div>
                                            <div class="room-details">S·ª©c ch·ª©a: ${r.capacity} ch·ªó ${r.equipment ? '‚Ä¢ ' + r.equipment : ''}</div>
                                        </div>
                                        <span class="room-status ${r.status}">${r.status === 'active' ? 'Ho·∫°t ƒë·ªông' : r.status === 'maintenance' ? 'B·∫£o tr√¨' : 'Ng·ª´ng'}</span>
                                        <div class="room-actions">
                                            <button class="btn btn-sm btn-warning btn-icon" onclick="ClassesModule.showRoomForm('${r.id}')" title="S·ª≠a">‚úèÔ∏è</button>
                                            <button class="btn btn-sm btn-danger btn-icon" onclick="ClassesModule.deleteRoom('${r.id}')" title="X√≥a">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="ClassesModule.closeRoomModal()">ƒê√≥ng</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },
    
    // ========================================
    // FORM TH√äM/S·ª¨A PH√íNG H·ªåC
    // ========================================
    showRoomForm(roomId) {
        const room = roomId ? DataManager.getById(STORAGE_KEYS.rooms, roomId) : null;
        const isEdit = room !== null;
        
        const formHtml = `
            <div class="modal-backdrop" id="roomFormModal" style="z-index: 1100;" onclick="ClassesModule.closeRoomFormOnBackdrop(event)">
                <div class="modal-content" style="max-width: 450px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title">
                            <span>${isEdit ? '‚úèÔ∏è' : '‚ûï'}</span>
                            ${isEdit ? 'S·ª≠a ph√≤ng h·ªçc' : 'Th√™m ph√≤ng h·ªçc'}
                        </h3>
                        <button class="modal-close" onclick="ClassesModule.closeRoomForm()">&times;</button>
                    </div>
                    
                    <div class="modal-body">
                        <form id="roomForm" onsubmit="ClassesModule.handleRoomSubmit(event, ${isEdit ? `'${room.id}'` : 'null'})">
                            <div class="form-group">
                                <label class="form-label">T√™n ph√≤ng <span class="required">*</span></label>
                                <input type="text" class="form-input" id="roomName" name="name" 
                                    value="${isEdit ? room.name : ''}" placeholder="V√≠ d·ª•: Ph√≤ng 101" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">S·ª©c ch·ª©a <span class="required">*</span></label>
                                <input type="number" class="form-input" id="roomCapacity" name="capacity" 
                                    value="${isEdit ? room.capacity : '12'}" min="1" max="100" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Thi·∫øt b·ªã</label>
                                <textarea class="form-textarea" id="roomEquipment" name="equipment" rows="2"
                                    placeholder="B·∫£ng tr·∫Øng, M√°y chi·∫øu, ƒêi·ªÅu h√≤a...">${isEdit ? (Array.isArray(room.equipment) ? room.equipment.join(', ') : room.equipment || '') : ''}</textarea>
                                <div class="form-hint">Nh·∫≠p danh s√°ch thi·∫øt b·ªã, ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Tr·∫°ng th√°i</label>
                                <select class="form-select" id="roomStatus" name="status">
                                    <option value="active" ${isEdit && room.status === 'active' ? 'selected' : ''}>Ho·∫°t ƒë·ªông</option>
                                    <option value="maintenance" ${isEdit && room.status === 'maintenance' ? 'selected' : ''}>B·∫£o tr√¨</option>
                                    <option value="inactive" ${isEdit && room.status === 'inactive' ? 'selected' : ''}>Ng·ª´ng s·ª≠ d·ª•ng</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Ghi ch√∫</label>
                                <textarea class="form-textarea" id="roomNotes" name="notes" rows="2">${isEdit ? (room.notes || '') : ''}</textarea>
                            </div>
                        </form>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="ClassesModule.closeRoomForm()">H·ªßy</button>
                        <button type="submit" form="roomForm" class="btn btn-primary">
                            ${isEdit ? 'üíæ L∆∞u' : '‚ûï Th√™m'}
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', formHtml);
    },
    
    // ========================================
    // X·ª¨ L√ù SUBMIT FORM PH√íNG H·ªåC
    // ========================================
    handleRoomSubmit(event, editId) {
        event.preventDefault();
        
        const name = document.getElementById('roomName').value.trim();
        const capacity = parseInt(document.getElementById('roomCapacity').value);
        const equipmentText = document.getElementById('roomEquipment').value.trim();
        const status = document.getElementById('roomStatus').value;
        const notes = document.getElementById('roomNotes').value.trim();
        
        // Parse equipment
        const equipment = equipmentText ? equipmentText.split(',').map(e => e.trim()).filter(e => e) : [];
        
        const roomData = {
            name,
            capacity,
            equipment,
            status,
            notes,
        };
        
        if (editId) {
            roomData.updatedAt = getCurrentDateTime();
            DataManager.update(STORAGE_KEYS.rooms, editId, roomData);
            UIManager.showNotification('C·∫≠p nh·∫≠t ph√≤ng h·ªçc th√†nh c√¥ng!', 'success');
        } else {
            roomData.id = generateId('PH');
            roomData.createdAt = getCurrentDateTime();
            DataManager.add(STORAGE_KEYS.rooms, roomData);
            UIManager.showNotification('Th√™m ph√≤ng h·ªçc th√†nh c√¥ng!', 'success');
        }
        
        this.closeRoomForm();
        this.closeRoomModal();
        this.showRoomManager();
    },
    
    // ========================================
    // X√ìA PH√íNG H·ªåC
    // ========================================
    deleteRoom(id) {
        const room = DataManager.getById(STORAGE_KEYS.rooms, id);
        if (!room) return;
        
        // Ki·ªÉm tra c√≥ l·ªõp n√†o ƒëang s·ª≠ d·ª•ng kh√¥ng
        const classes = DataManager.getAll(STORAGE_KEYS.classes);
        const usingClasses = classes.filter(c => c.roomId === id && c.status === 'active');
        
        if (usingClasses.length > 0) {
            UIManager.showNotification(`Kh√¥ng th·ªÉ x√≥a! C√≥ ${usingClasses.length} l·ªõp ƒëang s·ª≠ d·ª•ng ph√≤ng n√†y.`, 'error');
            return;
        }
        
        if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a "${room.name}"?`)) {
            DataManager.delete(STORAGE_KEYS.rooms, id);
            UIManager.showNotification('ƒê√£ x√≥a ph√≤ng h·ªçc!', 'success');
            this.closeRoomModal();
            this.showRoomManager();
        }
    },
    
    // ========================================
    // ƒê√ìNG C√ÅC MODAL
    // ========================================
    closeModal() {
        const modal = document.getElementById('classModal');
        if (modal) modal.remove();
    },
    
    closeModalOnBackdrop(event) {
        if (event.target.id === 'classModal') this.closeModal();
    },
    
    closeRoomModal() {
        const modal = document.getElementById('roomModal');
        if (modal) modal.remove();
    },
    
    closeRoomModalOnBackdrop(event) {
        if (event.target.id === 'roomModal') this.closeRoomModal();
    },
    
    closeRoomForm() {
        const modal = document.getElementById('roomFormModal');
        if (modal) modal.remove();
    },
    
    closeRoomFormOnBackdrop(event) {
        if (event.target.id === 'roomFormModal') this.closeRoomForm();
    },
};

// ------------------------------------------------------------
// 2. C·∫¨P NH·∫¨T UIMANAGER ƒê·ªÇ LOAD TRANG L·ªöP H·ªåC
// ------------------------------------------------------------
const originalRenderPageContent2 = UIManager.renderPageContent.bind(UIManager);
UIManager.renderPageContent = function(pageName) {
    if (pageName === 'classes') {
        ClassesModule.render();
    } else if (pageName === 'rooms') {
        // Redirect to classes with room manager
        ClassesModule.render();
        setTimeout(() => ClassesModule.showRoomManager(), 100);
    } else {
        originalRenderPageContent2(pageName);
    }
};

console.log('‚úÖ Module Qu·∫£n l√Ω L·ªõp h·ªçc + Ph√≤ng h·ªçc ƒë√£ load');

// ============================================================
// MODULE QU·∫¢N L√ù H·ªåC VI√äN
// Th√™m v√†o cu·ªëi th·∫ª <script> trong file index.html
// ============================================================

const StudentsModule = {
    // State
    currentPage: 1,
    itemsPerPage: 10,
    searchQuery: '',
    filterStatus: 'all',
    filterLevel: 'all',
    editingId: null,
    
    // ========================================
    // RENDER TRANG CH√çNH
    // ========================================
    render() {
        const contentArea = document.getElementById('contentArea');
        const stats = this.getStats();
        
        contentArea.innerHTML = `
            <!-- STATS BAR -->
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-item-icon blue">üë®‚Äçüéì</div>
                    <div class="stat-item-info">
                        <div class="stat-item-value blue">${stats.total}</div>
                        <div class="stat-item-label">T·ªïng h·ªçc vi√™n</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-item-icon green">‚úÖ</div>
                    <div class="stat-item-info">
                        <div class="stat-item-value green">${stats.active}</div>
                        <div class="stat-item-label">ƒêang h·ªçc</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-item-icon yellow">üÜï</div>
                    <div class="stat-item-info">
                        <div class="stat-item-value yellow">${stats.trial}</div>
                        <div class="stat-item-label">H·ªçc th·ª≠</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-item-icon purple">üéì</div>
                    <div class="stat-item-info">
                        <div class="stat-item-value purple">${stats.completed}</div>
                        <div class="stat-item-label">Ho√†n th√†nh</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-item-icon green">üí∞</div>
                    <div class="stat-item-info">
                        <div class="stat-item-value green">${this.formatShortCurrency(stats.revenue)}</div>
                        <div class="stat-item-label">Doanh thu</div>
                    </div>
                </div>
            </div>
            
            <!-- PAGE CONTAINER -->
            <div class="page-container">
                <!-- TOOLBAR -->
                <div class="page-toolbar">
                    <div class="toolbar-left">
                        <div class="search-box">
                            <input type="text" id="studentSearch" placeholder="T√¨m theo t√™n, ID h·ªçc vi√™n..." value="${this.searchQuery}">
                        </div>
                        <select class="filter-select" id="studentStatusFilter">
                            <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                            <option value="active" ${this.filterStatus === 'active' ? 'selected' : ''}>ƒêang h·ªçc</option>
                            <option value="trial" ${this.filterStatus === 'trial' ? 'selected' : ''}>H·ªçc th·ª≠</option>
                            <option value="new" ${this.filterStatus === 'new' ? 'selected' : ''}>H·ªçc vi√™n m·ªõi</option>
                            <option value="completed" ${this.filterStatus === 'completed' ? 'selected' : ''}>Ho√†n th√†nh</option>
                            <option value="inactive" ${this.filterStatus === 'inactive' ? 'selected' : ''}>Ngh·ªâ h·ªçc</option>
                        </select>
                        <select class="filter-select" id="studentLevelFilter">
                            <option value="all">T·∫•t c·∫£ tr√¨nh ƒë·ªô</option>
                            <option value="beginner" ${this.filterLevel === 'beginner' ? 'selected' : ''}>C∆° b·∫£n</option>
                            <option value="intermediate" ${this.filterLevel === 'intermediate' ? 'selected' : ''}>N√¢ng cao</option>
                            <option value="advanced" ${this.filterLevel === 'advanced' ? 'selected' : ''}>Chuy√™n s√¢u</option>
                        </select>
                    </div>
                    <div class="toolbar-right">
                        <button class="btn btn-primary" onclick="StudentsModule.showAddModal()">
                            <span>‚ûï</span>
                            <span>Th√™m h·ªçc vi√™n m·ªõi</span>
                        </button>
                    </div>
                </div>
                
                <!-- TABLE -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="width: 70px;">ID</th>
                                <th style="min-width: 180px;">H·ªçc vi√™n</th>
                                <th style="min-width: 140px;">Li√™n h·ªá</th>
                                <th style="width: 100px;">Tr√¨nh ƒë·ªô</th>
                                <th style="width: 110px;">Tr·∫°ng th√°i</th>
                                <th style="min-width: 120px;">Gi√°o vi√™n</th>
                                <th style="width: 130px;">Ti·∫øn ƒë·ªô</th>
                                <th style="width: 130px; text-align: right;">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTableBody">
                            ${this.renderTableBody()}
                        </tbody>
                    </table>
                </div>
                
                <!-- PAGINATION -->
                <div class="pagination" id="studentsPagination">
                    ${this.renderPagination()}
                </div>
            </div>
        `;
        
        this.attachEventListeners();
    },
    
    // ========================================
    // L·∫§Y TH·ªêNG K√ä
    // ========================================
    getStats() {
        const students = DataManager.getAll(STORAGE_KEYS.students);
        const tuitions = DataManager.getAll(STORAGE_KEYS.tuitions);
        
        return {
            total: students.length,
            active: students.filter(s => s.status === 'active').length,
            trial: students.filter(s => s.status === 'trial').length,
            completed: students.filter(s => s.status === 'completed').length,
            revenue: tuitions.reduce((sum, t) => sum + (t.paidAmount || 0), 0),
        };
    },
    
    // ========================================
    // FORMAT TI·ªÄN NG·∫ÆN
    // ========================================
    formatShortCurrency(amount) {
        if (amount >= 1000000000) return (amount / 1000000000).toFixed(1) + 'B';
        if (amount >= 1000000) return (amount / 1000000).toFixed(1) + 'M';
        if (amount >= 1000) return (amount / 1000).toFixed(0) + 'K';
        return amount.toString();
    },
    
    // ========================================
    // RENDER TABLE BODY
    // ========================================
    renderTableBody() {
        let students = DataManager.getAll(STORAGE_KEYS.students);
        
        // T√¨m ki·∫øm
        if (this.searchQuery) {
            const q = this.searchQuery.toLowerCase();
            students = students.filter(s => 
                s.name.toLowerCase().includes(q) ||
                s.code.toLowerCase().includes(q) ||
                (s.parentPhone && s.parentPhone.includes(q))
            );
        }
        
        // L·ªçc tr·∫°ng th√°i
        if (this.filterStatus !== 'all') {
            students = students.filter(s => s.status === this.filterStatus);
        }
        
        // Ph√¢n trang
        const total = students.length;
        const start = (this.currentPage - 1) * this.itemsPerPage;
        const paginated = students.slice(start, start + this.itemsPerPage);
        
        if (paginated.length === 0) {
            return `
                <tr>
                    <td colspan="8">
                        <div class="empty-state">
                            <div class="empty-state-icon">üë®‚Äçüéì</div>
                            <div class="empty-state-title">Kh√¥ng c√≥ h·ªçc vi√™n n√†o</div>
                            <div class="empty-state-desc">
                                ${this.searchQuery || this.filterStatus !== 'all' 
                                    ? 'Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm' 
                                    : 'B·∫•m n√∫t "Th√™m h·ªçc vi√™n m·ªõi" ƒë·ªÉ b·∫Øt ƒë·∫ßu'}
                            </div>
                        </div>
                    </td>
                </tr>
            `;
        }
        
        return paginated.map(student => this.renderStudentRow(student)).join('');
    },
    
    // ========================================
    // RENDER M·ªòT D√íNG H·ªåC VI√äN
    // ========================================
    renderStudentRow(student) {
        // T√≠nh tu·ªïi
        const age = student.dateOfBirth ? this.calculateAge(student.dateOfBirth) : null;
        
        // L·∫•y th√¥ng tin ƒëƒÉng k√Ω l·ªõp
        const enrollments = DataManager.getAll(STORAGE_KEYS.enrollments).filter(e => e.studentId === student.id);
        const activeEnrollment = enrollments.find(e => e.status === 'active');
        
        // T√≠nh ti·∫øn ƒë·ªô
        let progress = 0;
        let progressText = '0/0';
        let teacherName = '';
        
        if (activeEnrollment) {
            progress = activeEnrollment.totalSessions > 0 
                ? Math.round((activeEnrollment.usedSessions / activeEnrollment.totalSessions) * 100) 
                : 0;
            progressText = `${activeEnrollment.usedSessions}/${activeEnrollment.totalSessions}`;
            
            const cls = DataManager.getById(STORAGE_KEYS.classes, activeEnrollment.classId);
            if (cls) teacherName = cls.teacherName;
        }
        
        // Progress color
        let progressColor = 'blue';
        if (progress >= 100) progressColor = 'green';
        else if (progress >= 75) progressColor = 'blue';
        else if (progress >= 50) progressColor = 'yellow';
        else if (progress > 0) progressColor = 'red';
        
        // Status labels
        const statusLabels = {
            'active': 'ƒêang h·ªçc',
            'trial': 'H·ªçc th·ª≠',
            'new': 'M·ªõi',
            'completed': 'Ho√†n th√†nh',
            'inactive': 'Ngh·ªâ h·ªçc',
            'warning': 'S·∫Øp h·∫øt'
        };
        
        return `
            <tr class="student-table-row">
                <td><span class="cell-code">${student.code}</span></td>
                <td>
                    <div class="student-cell-info">
                        <div class="student-avatar ${student.gender === 'N·ªØ' ? 'female' : 'male'}">
                            ${student.name.charAt(0)}
                        </div>
                        <div class="student-name-group">
                            <div class="student-name">${student.name}</div>
                            <div class="student-age">${age ? age + ' tu·ªïi' : ''}</div>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="student-contact">
                        <div class="student-phone">üìû ${student.parentPhone || 'Ch∆∞a c√≥'}</div>
                        <div class="student-parent">üë§ ${student.parentName || 'Ch∆∞a c√≥'}</div>
                    </div>
                </td>
                <td>
                    <span class="level-badge beginner">C∆° b·∫£n</span>
                </td>
                <td>
                    <span class="status-badge ${student.status}">${statusLabels[student.status] || student.status}</span>
                </td>
                <td>
                    ${teacherName ? `
                        <div class="teacher-cell">
                            <div class="teacher-avatar-sm">${teacherName.charAt(0)}</div>
                            <span>${teacherName}</span>
                        </div>
                    ` : '<span style="color: #9ca3af;">Ch∆∞a c√≥</span>'}
                </td>
                <td>
                    <div class="progress-cell">
                        <div class="progress-text">${progressText} bu·ªïi</div>
                        <div class="progress-bar-sm">
                            <div class="progress-fill-sm ${progressColor}" style="width: ${progress}%"></div>
                        </div>
                    </div>
                </td>
                <td>
                    <div class="actions-cell">
                        <button class="action-btn view" onclick="StudentsModule.showDetailModal('${student.id}')" title="Xem chi ti·∫øt">üëÅÔ∏è</button>
                        <button class="action-btn schedule" onclick="StudentsModule.showScheduleModal('${student.id}')" title="L·ªãch h·ªçc">üìÖ</button>
                        <button class="action-btn edit" onclick="StudentsModule.showEditModal('${student.id}')" title="S·ª≠a">‚úèÔ∏è</button>
                        <button class="action-btn delete" onclick="StudentsModule.showDeleteConfirm('${student.id}')" title="X√≥a">üóëÔ∏è</button>
                    </div>
                </td>
            </tr>
        `;
    },
    
    // ========================================
    // T√çNH TU·ªîI
    // ========================================
    calculateAge(dateOfBirth) {
        const today = new Date();
        const birth = new Date(dateOfBirth);
        let age = today.getFullYear() - birth.getFullYear();
        const monthDiff = today.getMonth() - birth.getMonth();
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
            age--;
        }
        return age;
    },
    
    // ========================================
    // RENDER PH√ÇN TRANG
    // ========================================
    renderPagination() {
        const students = DataManager.getAll(STORAGE_KEYS.students);
        let filtered = students;
        
        if (this.searchQuery) {
            const q = this.searchQuery.toLowerCase();
            filtered = filtered.filter(s => 
                s.name.toLowerCase().includes(q) || s.code.toLowerCase().includes(q)
            );
        }
        if (this.filterStatus !== 'all') {
            filtered = filtered.filter(s => s.status === this.filterStatus);
        }
        
        const total = filtered.length;
        const totalPages = Math.ceil(total / this.itemsPerPage);
        
        if (total === 0) return '';
        
        const start = (this.currentPage - 1) * this.itemsPerPage + 1;
        const end = Math.min(this.currentPage * this.itemsPerPage, total);
        
        let buttons = `<button class="pagination-btn" onclick="StudentsModule.goToPage(${this.currentPage - 1})" ${this.currentPage === 1 ? 'disabled' : ''}>‚Äπ</button>`;
        
        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= this.currentPage - 1 && i <= this.currentPage + 1)) {
                buttons += `<button class="pagination-btn ${i === this.currentPage ? 'active' : ''}" onclick="StudentsModule.goToPage(${i})">${i}</button>`;
            } else if (i === this.currentPage - 2 || i === this.currentPage + 2) {
                buttons += `<span style="padding: 0 8px;">...</span>`;
            }
        }
        
        buttons += `<button class="pagination-btn" onclick="StudentsModule.goToPage(${this.currentPage + 1})" ${this.currentPage === totalPages ? 'disabled' : ''}>‚Ä∫</button>`;
        
        return `
            <div class="pagination-info">Hi·ªÉn th·ªã ${start} - ${end} trong t·ªïng s·ªë ${total} h·ªçc vi√™n</div>
            <div class="pagination-buttons">${buttons}</div>
        `;
    },
    
    // ========================================
    // CHUY·ªÇN TRANG
    // ========================================
    goToPage(page) {
        const students = DataManager.getAll(STORAGE_KEYS.students);
        const totalPages = Math.ceil(students.length / this.itemsPerPage);
        if (page < 1 || page > totalPages) return;
        
        this.currentPage = page;
        document.getElementById('studentsTableBody').innerHTML = this.renderTableBody();
        document.getElementById('studentsPagination').innerHTML = this.renderPagination();
    },
    
    // ========================================
    // G·∫ÆN EVENT LISTENERS
    // ========================================
    attachEventListeners() {
        // T√¨m ki·∫øm
        const searchInput = document.getElementById('studentSearch');
        if (searchInput) {
            let timeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    this.searchQuery = e.target.value;
                    this.currentPage = 1;
                    document.getElementById('studentsTableBody').innerHTML = this.renderTableBody();
                    document.getElementById('studentsPagination').innerHTML = this.renderPagination();
                }, 300);
            });
        }
        
        // L·ªçc tr·∫°ng th√°i
        const statusFilter = document.getElementById('studentStatusFilter');
        if (statusFilter) {
            statusFilter.addEventListener('change', (e) => {
                this.filterStatus = e.target.value;
                this.currentPage = 1;
                document.getElementById('studentsTableBody').innerHTML = this.renderTableBody();
                document.getElementById('studentsPagination').innerHTML = this.renderPagination();
            });
        }
        
        // L·ªçc tr√¨nh ƒë·ªô
        const levelFilter = document.getElementById('studentLevelFilter');
        if (levelFilter) {
            levelFilter.addEventListener('change', (e) => {
                this.filterLevel = e.target.value;
                this.currentPage = 1;
                document.getElementById('studentsTableBody').innerHTML = this.renderTableBody();
                document.getElementById('studentsPagination').innerHTML = this.renderPagination();
            });
        }
    },
    
    // ========================================
    // MODAL TH√äM H·ªåC VI√äN
    // ========================================
    showAddModal() {
        this.editingId = null;
        this.showFormModal('Th√™m h·ªçc vi√™n m·ªõi', null);
    },
    
    // ========================================
    // MODAL S·ª¨A H·ªåC VI√äN
    // ========================================
    showEditModal(id) {
        const student = DataManager.getById(STORAGE_KEYS.students, id);
        if (!student) {
            UIManager.showNotification('Kh√¥ng t√¨m th·∫•y h·ªçc vi√™n!', 'error');
            return;
        }
        this.editingId = id;
        this.showFormModal('Ch·ªânh s·ª≠a h·ªçc vi√™n', student);
    },
    
    // ========================================
    // RENDER FORM MODAL
    // ========================================
    showFormModal(title, data) {
        const isEdit = data !== null;
        const parents = DataManager.getAll(STORAGE_KEYS.parents);
        
        const modalHtml = `
            <div class="modal-backdrop" id="studentModal" onclick="StudentsModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 700px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title">
                            <span>${isEdit ? '‚úèÔ∏è' : '‚ûï'}</span>
                            ${title}
                        </h3>
                        <button class="modal-close" onclick="StudentsModule.closeModal()">&times;</button>
                    </div>
                    
                    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                        <form id="studentForm" onsubmit="StudentsModule.handleSubmit(event)">
                            
                            <!-- TH√îNG TIN C∆† B·∫¢N -->
                            <div class="form-section">
                                <div class="form-section-title">üìã Th√¥ng tin c∆° b·∫£n</div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">ID h·ªçc vi√™n</label>
                                        <input type="text" class="form-input" id="studentCode" value="${isEdit ? data.code : this.generateStudentCode()}" readonly style="background: #f3f4f6;">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">H·ªç v√† t√™n <span class="required">*</span></label>
                                        <input type="text" class="form-input" id="studentName" value="${isEdit ? data.name : ''}" placeholder="Nguy·ªÖn VƒÉn A" required>
                                    </div>
                                </div>
                                
                                <div class="form-row-3">
                                    <div class="form-group">
                                        <label class="form-label">Ng√†y sinh</label>
                                        <input type="date" class="form-input" id="studentDob" value="${isEdit ? data.dateOfBirth : ''}">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Gi·ªõi t√≠nh</label>
                                        <div class="gender-select">
                                            <label class="gender-option ${!isEdit || data.gender === 'Nam' ? 'selected' : ''}" onclick="StudentsModule.selectGender(this, 'Nam')">
                                                <input type="radio" name="gender" value="Nam" ${!isEdit || data.gender === 'Nam' ? 'checked' : ''}>
                                                üë¶ Nam
                                            </label>
                                            <label class="gender-option ${isEdit && data.gender === 'N·ªØ' ? 'selected' : ''}" onclick="StudentsModule.selectGender(this, 'N·ªØ')">
                                                <input type="radio" name="gender" value="N·ªØ" ${isEdit && data.gender === 'N·ªØ' ? 'checked' : ''}>
                                                üëß N·ªØ
                                            </label>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Tr·∫°ng th√°i</label>
                                        <select class="form-select" id="studentStatus">
                                            <option value="trial" ${isEdit && data.status === 'trial' ? 'selected' : ''}>H·ªçc th·ª≠</option>
                                            <option value="new" ${isEdit && data.status === 'new' ? 'selected' : ''}>H·ªçc vi√™n m·ªõi</option>
                                            <option value="active" ${isEdit && data.status === 'active' ? 'selected' : ''}>ƒêang h·ªçc</option>
                                            <option value="completed" ${isEdit && data.status === 'completed' ? 'selected' : ''}>Ho√†n th√†nh</option>
                                            <option value="inactive" ${isEdit && data.status === 'inactive' ? 'selected' : ''}>Ngh·ªâ h·ªçc</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- TH√îNG TIN LI√äN H·ªÜ -->
                            <div class="form-section">
                                <div class="form-section-title">üìû Th√¥ng tin li√™n h·ªá</div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">T√™n ph·ª• huynh <span class="required">*</span></label>
                                        <input type="text" class="form-input" id="studentParentName" value="${isEdit ? data.parentName : ''}" placeholder="Nguy·ªÖn VƒÉn B" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">SƒêT ph·ª• huynh <span class="required">*</span></label>
                                        <input type="tel" class="form-input" id="studentParentPhone" value="${isEdit ? data.parentPhone : ''}" placeholder="0901234567" required>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">ƒê·ªãa ch·ªâ</label>
                                    <input type="text" class="form-input" id="studentAddress" value="${isEdit ? (data.address || '') : ''}" placeholder="S·ªë nh√†, ƒë∆∞·ªùng, qu·∫≠n/huy·ªán...">
                                </div>
                            </div>
                            
                            <!-- TH√îNG TIN H·ªåC T·∫¨P -->
                            <div class="form-section">
                                <div class="form-section-title">üìö Th√¥ng tin h·ªçc t·∫≠p</div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Ng√†y nh·∫≠p h·ªçc</label>
                                        <input type="date" class="form-input" id="studentEnrollDate" value="${isEdit ? data.enrollmentDate : getCurrentDate()}">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Ngu·ªìn gi·ªõi thi·ªáu</label>
                                        <select class="form-select" id="studentReferral">
                                            <option value="">-- Ch·ªçn ngu·ªìn --</option>
                                            <option value="Facebook" ${isEdit && data.referralSource === 'Facebook' ? 'selected' : ''}>Facebook</option>
                                            <option value="Zalo" ${isEdit && data.referralSource === 'Zalo' ? 'selected' : ''}>Zalo</option>
                                            <option value="Google" ${isEdit && data.referralSource === 'Google' ? 'selected' : ''}>Google</option>
                                            <option value="Website" ${isEdit && data.referralSource === 'Website' ? 'selected' : ''}>Website</option>
                                            <option value="B·∫°n b√® gi·ªõi thi·ªáu" ${isEdit && data.referralSource === 'B·∫°n b√® gi·ªõi thi·ªáu' ? 'selected' : ''}>B·∫°n b√® gi·ªõi thi·ªáu</option>
                                            <option value="Kh√°c" ${isEdit && data.referralSource === 'Kh√°c' ? 'selected' : ''}>Kh√°c</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Ghi ch√∫ s·ª©c kh·ªèe</label>
                                    <textarea class="form-textarea" id="studentHealthNotes" rows="2" placeholder="D·ªã ·ª©ng, b·ªánh l√Ω c·∫ßn l∆∞u √Ω...">${isEdit ? (data.healthNotes || '') : ''}</textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Ghi ch√∫ kh√°c</label>
                                    <textarea class="form-textarea" id="studentNotes" rows="2" placeholder="Ghi ch√∫ th√™m v·ªÅ h·ªçc vi√™n...">${isEdit ? (data.notes || '') : ''}</textarea>
                                </div>
                            </div>
                            
                        </form>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="StudentsModule.closeModal()">H·ªßy b·ªè</button>
                        <button type="submit" form="studentForm" class="btn btn-primary">
                            <span>${isEdit ? 'üíæ' : '‚ûï'}</span>
                            <span>${isEdit ? 'L∆∞u thay ƒë·ªïi' : 'Th√™m h·ªçc vi√™n'}</span>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        
        setTimeout(() => {
            document.getElementById('studentName').focus();
        }, 100);
    },
    
    // ========================================
    // T·∫†O M√É H·ªåC VI√äN
    // ========================================
    generateStudentCode() {
        const students = DataManager.getAll(STORAGE_KEYS.students);
        const maxNum = students.reduce((max, s) => {
            const num = parseInt(s.code.replace('HV', '')) || 0;
            return num > max ? num : max;
        }, 0);
        return 'HV' + String(maxNum + 1).padStart(3, '0');
    },
    
    // ========================================
    // CH·ªåN GI·ªöI T√çNH
    // ========================================
    selectGender(element, value) {
        document.querySelectorAll('.gender-option').forEach(opt => opt.classList.remove('selected'));
        element.classList.add('selected');
        element.querySelector('input').checked = true;
    },
    
    // ========================================
    // X·ª¨ L√ù SUBMIT FORM
    // ========================================
    handleSubmit(event) {
        event.preventDefault();
        
        const name = document.getElementById('studentName').value.trim();
        const dateOfBirth = document.getElementById('studentDob').value;
        const gender = document.querySelector('input[name="gender"]:checked')?.value || 'Nam';
        const status = document.getElementById('studentStatus').value;
        const parentName = document.getElementById('studentParentName').value.trim();
        const parentPhone = document.getElementById('studentParentPhone').value.trim();
        const address = document.getElementById('studentAddress').value.trim();
        const enrollmentDate = document.getElementById('studentEnrollDate').value;
        const referralSource = document.getElementById('studentReferral').value;
        const healthNotes = document.getElementById('studentHealthNotes').value.trim();
        const notes = document.getElementById('studentNotes').value.trim();
        
        // Validation
        if (!name) {
            UIManager.showNotification('Vui l√≤ng nh·∫≠p t√™n h·ªçc vi√™n!', 'error');
            return;
        }
        if (!parentName || !parentPhone) {
            UIManager.showNotification('Vui l√≤ng nh·∫≠p th√¥ng tin ph·ª• huynh!', 'error');
            return;
        }
        
        const studentData = {
            code: document.getElementById('studentCode').value,
            name,
            dateOfBirth,
            gender,
            status,
            parentName,
            parentPhone,
            address,
            enrollmentDate,
            referralSource,
            healthNotes,
            notes,
            avatar: null,
        };
        
        if (this.editingId) {
            studentData.updatedAt = getCurrentDateTime();
            DataManager.update(STORAGE_KEYS.students, this.editingId, studentData);
            UIManager.showNotification('C·∫≠p nh·∫≠t h·ªçc vi√™n th√†nh c√¥ng!', 'success');
            SessionManager.logActivity('update', 'students', this.editingId, name, `C·∫≠p nh·∫≠t h·ªçc vi√™n: ${name}`);
        } else {
            studentData.id = generateId('HV');
            studentData.createdAt = getCurrentDateTime();
            DataManager.add(STORAGE_KEYS.students, studentData);
            UIManager.showNotification('Th√™m h·ªçc vi√™n th√†nh c√¥ng!', 'success');
            SessionManager.logActivity('create', 'students', studentData.id, name, `Th√™m h·ªçc vi√™n m·ªõi: ${name}`);
        }
        
        this.closeModal();
        this.render();
    },
    
    // ========================================
    // MODAL XEM CHI TI·∫æT
    // ========================================
    showDetailModal(id) {
        const student = DataManager.getById(STORAGE_KEYS.students, id);
        if (!student) {
            UIManager.showNotification('Kh√¥ng t√¨m th·∫•y h·ªçc vi√™n!', 'error');
            return;
        }
        
        const age = student.dateOfBirth ? this.calculateAge(student.dateOfBirth) : null;
        const enrollments = DataManager.getAll(STORAGE_KEYS.enrollments).filter(e => e.studentId === id);
        const tuitions = DataManager.getAll(STORAGE_KEYS.tuitions).filter(t => t.studentId === id);
        
        const totalPaid = tuitions.reduce((sum, t) => sum + (t.paidAmount || 0), 0);
        const totalDebt = tuitions.reduce((sum, t) => sum + (t.debtAmount || 0), 0);
        
        const statusLabels = {
            'active': 'ƒêang h·ªçc', 'trial': 'H·ªçc th·ª≠', 'new': 'M·ªõi',
            'completed': 'Ho√†n th√†nh', 'inactive': 'Ngh·ªâ h·ªçc'
        };
        
        const modalHtml = `
            <div class="modal-backdrop" id="studentModal" onclick="StudentsModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 650px;" onclick="event.stopPropagation()">
                    <div class="modal-header" style="padding: 0; border: none;">
                        <button class="modal-close" style="position: absolute; right: 16px; top: 16px; z-index: 10;" onclick="StudentsModule.closeModal()">&times;</button>
                    </div>
                    
                    <!-- Student Header -->
                    <div class="student-detail-header">
                        <div class="student-detail-avatar ${student.gender === 'N·ªØ' ? 'female' : 'male'}" style="background: linear-gradient(135deg, ${student.gender === 'N·ªØ' ? '#ec4899, #db2777' : '#3b82f6, #2563eb'});">
                            ${student.name.charAt(0)}
                        </div>
                        <div class="student-detail-info">
                            <div class="student-detail-name">${student.name}</div>
                            <div class="student-detail-meta">
                                <span>üÜî ${student.code}</span>
                                ${age ? `<span>üéÇ ${age} tu·ªïi</span>` : ''}
                                <span>${student.gender === 'N·ªØ' ? 'üëß' : 'üë¶'} ${student.gender}</span>
                            </div>
                            <div class="student-detail-badges">
                                <span class="status-badge ${student.status}">${statusLabels[student.status]}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-body">
                        <!-- Th√¥ng tin li√™n h·ªá -->
                        <div class="info-section">
                            <div class="info-section-title">üìû Th√¥ng tin li√™n h·ªá</div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">Ph·ª• huynh</span>
                                    <span class="info-value">${student.parentName || 'Ch∆∞a c√≥'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">S·ªë ƒëi·ªán tho·∫°i</span>
                                    <span class="info-value">${student.parentPhone || 'Ch∆∞a c√≥'}</span>
                                </div>
                                <div class="info-item" style="grid-column: 1 / -1;">
                                    <span class="info-label">ƒê·ªãa ch·ªâ</span>
                                    <span class="info-value">${student.address || 'Ch∆∞a c√≥'}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Th√¥ng tin h·ªçc t·∫≠p -->
                        <div class="info-section">
                            <div class="info-section-title">üìö Th√¥ng tin h·ªçc t·∫≠p</div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">Ng√†y nh·∫≠p h·ªçc</span>
                                    <span class="info-value">${student.enrollmentDate ? new Date(student.enrollmentDate).toLocaleDateString('vi-VN') : 'Ch∆∞a c√≥'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Ngu·ªìn gi·ªõi thi·ªáu</span>
                                    <span class="info-value">${student.referralSource || 'Ch∆∞a c√≥'}</span>
                                </div>
                            </div>
                            
                            ${enrollments.length > 0 ? `
                                <div style="margin-top: 16px;">
                                    <div class="info-label" style="margin-bottom: 10px;">L·ªõp ƒëang h·ªçc (${enrollments.length})</div>
                                    <div class="enrollment-list">
                                        ${enrollments.map(e => {
                                            const cls = DataManager.getById(STORAGE_KEYS.classes, e.classId);
                                            const subject = cls ? DataManager.getById(STORAGE_KEYS.subjects, cls.subjectId) : null;
                                            return `
                                                <div class="enrollment-item">
                                                    <div class="enrollment-icon" style="background: ${subject ? subject.color + '20' : '#f3f4f6'}">üìñ</div>
                                                    <div class="enrollment-info">
                                                        <div class="enrollment-class">${e.className}</div>
                                                        <div class="enrollment-teacher">${cls ? cls.teacherName : ''}</div>
                                                    </div>
                                                    <div class="enrollment-progress">
                                                        <div class="enrollment-sessions">${e.usedSessions}/${e.totalSessions}</div>
                                                        <div class="enrollment-remaining">c√≤n ${e.remainingSessions} bu·ªïi</div>
                                                    </div>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                            ` : '<p style="color: #6b7280; margin-top: 12px;">Ch∆∞a ƒëƒÉng k√Ω l·ªõp n√†o</p>'}
                        </div>
                        
                        <!-- Th√¥ng tin t√†i ch√≠nh -->
                        <div class="info-section">
                            <div class="info-section-title">üí∞ Th√¥ng tin t√†i ch√≠nh</div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">ƒê√£ thanh to√°n</span>
                                    <span class="info-value highlight">${formatCurrency(totalPaid)}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">C√≤n n·ª£</span>
                                    <span class="info-value ${totalDebt > 0 ? 'danger' : ''}">${formatCurrency(totalDebt)}</span>
                                </div>
                            </div>
                        </div>
                        
                        ${student.healthNotes || student.notes ? `
                            <div class="info-section">
                                <div class="info-section-title">üìù Ghi ch√∫</div>
                                ${student.healthNotes ? `<p style="margin-bottom: 8px;"><strong>S·ª©c kh·ªèe:</strong> ${student.healthNotes}</p>` : ''}
                                ${student.notes ? `<p><strong>Kh√°c:</strong> ${student.notes}</p>` : ''}
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="StudentsModule.closeModal()">ƒê√≥ng</button>
                        <button type="button" class="btn btn-warning" onclick="StudentsModule.closeModal(); StudentsModule.showEditModal('${id}')">
                            <span>‚úèÔ∏è</span> Ch·ªânh s·ª≠a
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },
    
    // ========================================
    // MODAL L·ªäCH H·ªåC
    // ========================================
    showScheduleModal(id) {
        const student = DataManager.getById(STORAGE_KEYS.students, id);
        if (!student) return;
        
        const enrollments = DataManager.getAll(STORAGE_KEYS.enrollments).filter(e => e.studentId === id);
        
        let scheduleHtml = '';
        enrollments.forEach(e => {
            const cls = DataManager.getById(STORAGE_KEYS.classes, e.classId);
            if (cls && cls.schedule) {
                const days = ['', 'Th·ª© 2', 'Th·ª© 3', 'Th·ª© 4', 'Th·ª© 5', 'Th·ª© 6', 'Th·ª© 7', 'Ch·ªß nh·∫≠t'];
                cls.schedule.forEach(s => {
                    scheduleHtml += `
                        <div class="session-item">
                            <div class="session-number">${days[s.dayOfWeek].substring(0, 2)}</div>
                            <div class="session-info">
                                <div class="session-date">${days[s.dayOfWeek]} - ${s.startTime} ƒë·∫øn ${s.endTime}</div>
                                <div class="session-topic">${cls.name}</div>
                            </div>
                        </div>
                    `;
                });
            }
        });
        
        const modalHtml = `
            <div class="modal-backdrop" id="studentModal" onclick="StudentsModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 500px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title"><span>üìÖ</span> L·ªãch h·ªçc c·ªßa ${student.name}</h3>
                        <button class="modal-close" onclick="StudentsModule.closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        ${scheduleHtml || '<p style="text-align: center; color: #6b7280;">Ch∆∞a c√≥ l·ªãch h·ªçc</p>'}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="StudentsModule.closeModal()">ƒê√≥ng</button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },
    
    // ========================================
    // X√ÅC NH·∫¨N X√ìA
    // ========================================
    showDeleteConfirm(id) {
        const student = DataManager.getById(STORAGE_KEYS.students, id);
        if (!student) return;
        
        // Ki·ªÉm tra c√≥ ƒëƒÉng k√Ω l·ªõp kh√¥ng
        const enrollments = DataManager.getAll(STORAGE_KEYS.enrollments).filter(e => e.studentId === id && e.status === 'active');
        if (enrollments.length > 0) {
            UIManager.showNotification(`Kh√¥ng th·ªÉ x√≥a! H·ªçc vi√™n ƒëang h·ªçc ${enrollments.length} l·ªõp.`, 'error');
            return;
        }
        
        const modalHtml = `
            <div class="modal-backdrop" id="studentModal" onclick="StudentsModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 420px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title"><span>‚ö†Ô∏è</span> X√°c nh·∫≠n x√≥a</h3>
                        <button class="modal-close" onclick="StudentsModule.closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="confirm-dialog">
                            <div class="confirm-icon">üóëÔ∏è</div>
                            <div class="confirm-title">X√≥a h·ªçc vi√™n n√†y?</div>
                            <div class="confirm-message">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a:</div>
                            <div class="confirm-highlight">${student.name} (${student.code})</div>
                            <div class="confirm-message" style="margin-top: 12px; color: #ef4444;">H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="StudentsModule.closeModal()">H·ªßy b·ªè</button>
                        <button type="button" class="btn btn-danger" onclick="StudentsModule.deleteStudent('${id}')">
                            <span>üóëÔ∏è</span> X√≥a h·ªçc vi√™n
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },
    
    // ========================================
    // X√ìA H·ªåC VI√äN
    // ========================================
    deleteStudent(id) {
        const student = DataManager.getById(STORAGE_KEYS.students, id);
        if (!student) return;
        
        DataManager.delete(STORAGE_KEYS.students, id);
        SessionManager.logActivity('delete', 'students', id, student.name, `X√≥a h·ªçc vi√™n: ${student.name}`);
        UIManager.showNotification('ƒê√£ x√≥a h·ªçc vi√™n th√†nh c√¥ng!', 'success');
        
        this.closeModal();
        this.render();
    },
    
    // ========================================
    // ƒê√ìNG MODAL
    // ========================================
    closeModal() {
        const modal = document.getElementById('studentModal');
        if (modal) modal.remove();
        this.editingId = null;
    },
    
    closeModalOnBackdrop(event) {
        if (event.target.id === 'studentModal') this.closeModal();
    },
};

// ------------------------------------------------------------
// C·∫¨P NH·∫¨T UIMANAGER
// ------------------------------------------------------------
const originalRenderPageContent3 = UIManager.renderPageContent.bind(UIManager);
UIManager.renderPageContent = function(pageName) {
    if (pageName === 'students') {
        StudentsModule.render();
    } else {
        originalRenderPageContent3(pageName);
    }
};

console.log('‚úÖ Module Qu·∫£n l√Ω H·ªçc vi√™n ƒë√£ load');

// ============================================================
// MODULE QU·∫¢N L√ù GI√ÅO VI√äN
// Th√™m v√†o cu·ªëi th·∫ª <script> trong file index.html
// ============================================================

const TeachersModule = {
    // State
    currentPage: 1,
    itemsPerPage: 10,
    searchQuery: '',
    filterPosition: 'all',
    filterStatus: 'all',
    editingId: null,
    
    // Danh s√°ch ch·ª©c v·ª•
    positions: [
        { value: 'teacher', label: 'Gi√°o vi√™n', icon: 'üë®‚Äçüè´', color: 'green' },
        { value: 'manager', label: 'Qu·∫£n l√Ω', icon: 'üëî', color: 'purple' },
        { value: 'trainer', label: 'ƒê√†o t·∫°o', icon: 'üìö', color: 'blue' },
        { value: 'assistant', label: 'Tr·ª£ gi·∫£ng', icon: 'üôã', color: 'yellow' },
    ],
    
    // ========================================
    // RENDER TRANG CH√çNH
    // ========================================
    render() {
        const contentArea = document.getElementById('contentArea');
        const stats = this.getStats();
        
        contentArea.innerHTML = `
            <!-- STATS BAR -->
            <div class="teacher-stats-bar">
                <div class="teacher-stat-item">
                    <div class="teacher-stat-icon manager">üëî</div>
                    <div class="teacher-stat-info">
                        <div class="teacher-stat-label">Qu·∫£n l√Ω</div>
                        <div class="teacher-stat-value purple">${stats.manager}</div>
                    </div>
                </div>
                <div class="teacher-stat-item">
                    <div class="teacher-stat-icon teacher">üë®‚Äçüè´</div>
                    <div class="teacher-stat-info">
                        <div class="teacher-stat-label">Gi√°o vi√™n</div>
                        <div class="teacher-stat-value green">${stats.teacher}</div>
                    </div>
                </div>
                <div class="teacher-stat-item">
                    <div class="teacher-stat-icon trainer">üìö</div>
                    <div class="teacher-stat-info">
                        <div class="teacher-stat-label">ƒê√†o t·∫°o</div>
                        <div class="teacher-stat-value blue">${stats.trainer}</div>
                    </div>
                </div>
                <div class="teacher-stat-item">
                    <div class="teacher-stat-icon staff">üôã</div>
                    <div class="teacher-stat-info">
                        <div class="teacher-stat-label">Tr·ª£ gi·∫£ng</div>
                        <div class="teacher-stat-value yellow">${stats.assistant}</div>
                    </div>
                </div>
            </div>
            
            <!-- PAGE CONTAINER -->
            <div class="page-container">
                <!-- TOOLBAR -->
                <div class="page-toolbar">
                    <div class="toolbar-left">
                        <div class="search-box">
                            <input type="text" id="teacherSearch" placeholder="T√¨m theo t√™n, SƒêT, email..." value="${this.searchQuery}">
                        </div>
                        <select class="filter-select" id="teacherPositionFilter">
                            <option value="all">T·∫•t c·∫£ ch·ª©c v·ª•</option>
                            ${this.positions.map(p => `<option value="${p.value}" ${this.filterPosition === p.value ? 'selected' : ''}>${p.label}</option>`).join('')}
                        </select>
                        <select class="filter-select" id="teacherStatusFilter">
                            <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                            <option value="active" ${this.filterStatus === 'active' ? 'selected' : ''}>ƒêang l√†m vi·ªác</option>
                            <option value="on-leave" ${this.filterStatus === 'on-leave' ? 'selected' : ''}>ƒêang ngh·ªâ ph√©p</option>
                            <option value="inactive" ${this.filterStatus === 'inactive' ? 'selected' : ''}>ƒê√£ ngh·ªâ vi·ªác</option>
                        </select>
                    </div>
                    <div class="toolbar-right">
                        <button class="btn btn-primary" onclick="TeachersModule.showAddModal()">
                            <span>‚ûï</span>
                            <span>Th√™m nh√¢n vi√™n</span>
                        </button>
                    </div>
                </div>
                
                <!-- TABLE -->
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="width: 70px;">ID</th>
                                <th style="min-width: 200px;">Nh√¢n vi√™n</th>
                                <th style="width: 110px;">Ch·ª©c v·ª•</th>
                                <th style="min-width: 180px;">Li√™n h·ªá</th>
                                <th style="width: 120px;">Tr·∫°ng th√°i</th>
                                <th style="width: 100px;">ƒêi·ªÉm danh</th>
                                <th style="width: 130px; text-align: right;">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="teachersTableBody">
                            ${this.renderTableBody()}
                        </tbody>
                    </table>
                </div>
                
                <!-- PAGINATION -->
                <div class="pagination" id="teachersPagination">
                    ${this.renderPagination()}
                </div>
            </div>
        `;
        
        this.attachEventListeners();
    },
    
    // ========================================
    // L·∫§Y TH·ªêNG K√ä
    // ========================================
    getStats() {
        const teachers = DataManager.getAll(STORAGE_KEYS.teachers);
        
        return {
            total: teachers.length,
            manager: teachers.filter(t => t.position === 'manager').length,
            teacher: teachers.filter(t => t.position === 'teacher' || !t.position).length,
            trainer: teachers.filter(t => t.position === 'trainer').length,
            assistant: teachers.filter(t => t.position === 'assistant').length,
        };
    },
    
    // ========================================
    // RENDER TABLE BODY
    // ========================================
    renderTableBody() {
        let teachers = DataManager.getAll(STORAGE_KEYS.teachers);
        
        // T√¨m ki·∫øm
        if (this.searchQuery) {
            const q = this.searchQuery.toLowerCase();
            teachers = teachers.filter(t => 
                t.name.toLowerCase().includes(q) ||
                t.code.toLowerCase().includes(q) ||
                (t.phone && t.phone.includes(q)) ||
                (t.email && t.email.toLowerCase().includes(q))
            );
        }
        
        // L·ªçc ch·ª©c v·ª•
        if (this.filterPosition !== 'all') {
            teachers = teachers.filter(t => t.position === this.filterPosition || (!t.position && this.filterPosition === 'teacher'));
        }
        
        // L·ªçc tr·∫°ng th√°i
        if (this.filterStatus !== 'all') {
            teachers = teachers.filter(t => t.status === this.filterStatus);
        }
        
        // Ph√¢n trang
        const total = teachers.length;
        const start = (this.currentPage - 1) * this.itemsPerPage;
        const paginated = teachers.slice(start, start + this.itemsPerPage);
        
        if (paginated.length === 0) {
            return `
                <tr>
                    <td colspan="7">
                        <div class="empty-state">
                            <div class="empty-state-icon">üë®‚Äçüè´</div>
                            <div class="empty-state-title">Kh√¥ng c√≥ nh√¢n vi√™n n√†o</div>
                            <div class="empty-state-desc">
                                ${this.searchQuery || this.filterPosition !== 'all' || this.filterStatus !== 'all'
                                    ? 'Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm' 
                                    : 'B·∫•m n√∫t "Th√™m nh√¢n vi√™n" ƒë·ªÉ b·∫Øt ƒë·∫ßu'}
                            </div>
                        </div>
                    </td>
                </tr>
            `;
        }
        
        return paginated.map(teacher => this.renderTeacherRow(teacher)).join('');
    },
    
    // ========================================
    // RENDER M·ªòT D√íNG GI√ÅO VI√äN
    // ========================================
    renderTeacherRow(teacher) {
        // L·∫•y th√¥ng tin v·ªã tr√≠
        const position = this.positions.find(p => p.value === teacher.position) || this.positions[0];
        
        // T√≠nh t·ª∑ l·ªá ƒëi·ªÉm danh (gi·∫£ l·∫≠p)
        const attendanceRate = teacher.attendanceRate || Math.floor(Math.random() * 15 + 85);
        let attendanceClass = 'high';
        if (attendanceRate < 90) attendanceClass = 'medium';
        if (attendanceRate < 80) attendanceClass = 'low';
        
        // Avatar color
        const colors = ['purple', 'green', 'blue', 'pink'];
        const colorIndex = teacher.name.charCodeAt(0) % colors.length;
        const avatarColor = colors[colorIndex];
        
        // Format ng√†y gia nh·∫≠p
        const joinDate = teacher.startDate ? new Date(teacher.startDate).toLocaleDateString('vi-VN') : '';
        
        // Status labels
        const statusLabels = {
            'active': { label: 'ƒêang l√†m vi·ªác', class: 'working' },
            'on-leave': { label: 'ƒêang ngh·ªâ ph√©p', class: 'on-leave' },
            'inactive': { label: 'ƒê√£ ngh·ªâ vi·ªác', class: 'resigned' },
        };
        const statusInfo = statusLabels[teacher.status] || statusLabels['active'];
        
        return `
            <tr class="student-table-row">
                <td><span class="cell-code">${teacher.code}</span></td>
                <td>
                    <div class="teacher-cell-info">
                        <div class="teacher-avatar ${avatarColor}">
                            ${teacher.name.charAt(0)}
                        </div>
                        <div class="teacher-name-group">
                            <div class="teacher-name">${teacher.name}</div>
                            <div class="teacher-join-date">Gia nh·∫≠p: ${joinDate || 'N/A'}</div>
                        </div>
                    </div>
                </td>
                <td>
                    <span class="position-badge ${position.value}">${position.icon} ${position.label}</span>
                </td>
                <td>
                    <div class="teacher-contact">
                        <div class="teacher-phone">üìû ${teacher.phone || 'Ch∆∞a c√≥'}</div>
                        <div class="teacher-email">‚úâÔ∏è ${teacher.email || 'Ch∆∞a c√≥'}</div>
                    </div>
                </td>
                <td>
                    <span class="work-status-badge ${statusInfo.class}">${statusInfo.label}</span>
                </td>
                <td>
                    <div class="attendance-rate">
                        <div class="attendance-percent ${attendanceClass}">${attendanceRate}%</div>
                        <div class="attendance-label">T·ª∑ l·ªá c√≥ m·∫∑t</div>
                    </div>
                </td>
                <td>
                    <div class="actions-cell">
                        <button class="action-btn view" onclick="TeachersModule.showDetailModal('${teacher.id}')" title="Xem chi ti·∫øt">üëÅÔ∏è</button>
                        <button class="action-btn edit" onclick="TeachersModule.showEditModal('${teacher.id}')" title="S·ª≠a">‚úèÔ∏è</button>
                        <button class="action-btn delete" onclick="TeachersModule.showDeleteConfirm('${teacher.id}')" title="X√≥a">üóëÔ∏è</button>
                    </div>
                </td>
            </tr>
        `;
    },
    
    // ========================================
    // RENDER PH√ÇN TRANG
    // ========================================
    renderPagination() {
        let teachers = DataManager.getAll(STORAGE_KEYS.teachers);
        
        if (this.searchQuery) {
            const q = this.searchQuery.toLowerCase();
            teachers = teachers.filter(t => 
                t.name.toLowerCase().includes(q) || t.code.toLowerCase().includes(q)
            );
        }
        if (this.filterPosition !== 'all') {
            teachers = teachers.filter(t => t.position === this.filterPosition);
        }
        if (this.filterStatus !== 'all') {
            teachers = teachers.filter(t => t.status === this.filterStatus);
        }
        
        const total = teachers.length;
        const totalPages = Math.ceil(total / this.itemsPerPage);
        
        if (total === 0) return '';
        
        const start = (this.currentPage - 1) * this.itemsPerPage + 1;
        const end = Math.min(this.currentPage * this.itemsPerPage, total);
        
        let buttons = `<button class="pagination-btn" onclick="TeachersModule.goToPage(${this.currentPage - 1})" ${this.currentPage === 1 ? 'disabled' : ''}>‚Äπ</button>`;
        
        for (let i = 1; i <= totalPages; i++) {
            if (i === 1 || i === totalPages || (i >= this.currentPage - 1 && i <= this.currentPage + 1)) {
                buttons += `<button class="pagination-btn ${i === this.currentPage ? 'active' : ''}" onclick="TeachersModule.goToPage(${i})">${i}</button>`;
            } else if (i === this.currentPage - 2 || i === this.currentPage + 2) {
                buttons += `<span style="padding: 0 8px;">...</span>`;
            }
        }
        
        buttons += `<button class="pagination-btn" onclick="TeachersModule.goToPage(${this.currentPage + 1})" ${this.currentPage === totalPages ? 'disabled' : ''}>‚Ä∫</button>`;
        
        return `
            <div class="pagination-info">Hi·ªÉn th·ªã ${start} - ${end} trong t·ªïng s·ªë ${total} nh√¢n vi√™n</div>
            <div class="pagination-buttons">${buttons}</div>
        `;
    },
    
    // ========================================
    // CHUY·ªÇN TRANG
    // ========================================
    goToPage(page) {
        const teachers = DataManager.getAll(STORAGE_KEYS.teachers);
        const totalPages = Math.ceil(teachers.length / this.itemsPerPage);
        if (page < 1 || page > totalPages) return;
        
        this.currentPage = page;
        document.getElementById('teachersTableBody').innerHTML = this.renderTableBody();
        document.getElementById('teachersPagination').innerHTML = this.renderPagination();
    },
    
    // ========================================
    // G·∫ÆN EVENT LISTENERS
    // ========================================
    attachEventListeners() {
        // T√¨m ki·∫øm
        const searchInput = document.getElementById('teacherSearch');
        if (searchInput) {
            let timeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    this.searchQuery = e.target.value;
                    this.currentPage = 1;
                    document.getElementById('teachersTableBody').innerHTML = this.renderTableBody();
                    document.getElementById('teachersPagination').innerHTML = this.renderPagination();
                }, 300);
            });
        }
        
        // L·ªçc ch·ª©c v·ª•
        const positionFilter = document.getElementById('teacherPositionFilter');
        if (positionFilter) {
            positionFilter.addEventListener('change', (e) => {
                this.filterPosition = e.target.value;
                this.currentPage = 1;
                document.getElementById('teachersTableBody').innerHTML = this.renderTableBody();
                document.getElementById('teachersPagination').innerHTML = this.renderPagination();
            });
        }
        
        // L·ªçc tr·∫°ng th√°i
        const statusFilter = document.getElementById('teacherStatusFilter');
        if (statusFilter) {
            statusFilter.addEventListener('change', (e) => {
                this.filterStatus = e.target.value;
                this.currentPage = 1;
                document.getElementById('teachersTableBody').innerHTML = this.renderTableBody();
                document.getElementById('teachersPagination').innerHTML = this.renderPagination();
            });
        }
    },
    
    // ========================================
    // MODAL TH√äM GI√ÅO VI√äN
    // ========================================
    showAddModal() {
        this.editingId = null;
        this.showFormModal('Th√™m nh√¢n vi√™n m·ªõi', null);
    },
    
    // ========================================
    // MODAL S·ª¨A GI√ÅO VI√äN
    // ========================================
    showEditModal(id) {
        const teacher = DataManager.getById(STORAGE_KEYS.teachers, id);
        if (!teacher) {
            UIManager.showNotification('Kh√¥ng t√¨m th·∫•y nh√¢n vi√™n!', 'error');
            return;
        }
        this.editingId = id;
        this.showFormModal('Ch·ªânh s·ª≠a nh√¢n vi√™n', teacher);
    },
    
    // ========================================
    // RENDER FORM MODAL
    // ========================================
    showFormModal(title, data) {
        const isEdit = data !== null;
        const subjects = DataManager.getAll(STORAGE_KEYS.subjects);
        const teacherSubjects = isEdit && data.subjects ? data.subjects : [];
        
        const modalHtml = `
            <div class="modal-backdrop" id="teacherModal" onclick="TeachersModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 700px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title">
                            <span>${isEdit ? '‚úèÔ∏è' : '‚ûï'}</span>
                            ${title}
                        </h3>
                        <button class="modal-close" onclick="TeachersModule.closeModal()">&times;</button>
                    </div>
                    
                    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                        <form id="teacherForm" onsubmit="TeachersModule.handleSubmit(event)">
                            
                            <!-- TH√îNG TIN C∆† B·∫¢N -->
                            <div class="form-section">
                                <div class="form-section-title">üìã Th√¥ng tin c∆° b·∫£n</div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">ID nh√¢n vi√™n</label>
                                        <input type="text" class="form-input" id="teacherCode" value="${isEdit ? data.code : this.generateTeacherCode()}" readonly style="background: #f3f4f6;">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">H·ªç v√† t√™n <span class="required">*</span></label>
                                        <input type="text" class="form-input" id="teacherName" value="${isEdit ? data.name : ''}" placeholder="Nguy·ªÖn VƒÉn A" required>
                                    </div>
                                </div>
                                
                                <div class="form-row-3">
                                    <div class="form-group">
                                        <label class="form-label">Ng√†y sinh</label>
                                        <input type="date" class="form-input" id="teacherDob" value="${isEdit ? (data.dateOfBirth || '') : ''}">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Gi·ªõi t√≠nh</label>
                                        <select class="form-select" id="teacherGender">
                                            <option value="Nam" ${isEdit && data.gender === 'Nam' ? 'selected' : ''}>Nam</option>
                                            <option value="N·ªØ" ${isEdit && data.gender === 'N·ªØ' ? 'selected' : ''}>N·ªØ</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">CCCD/CMND</label>
                                        <input type="text" class="form-input" id="teacherIdNumber" value="${isEdit ? (data.idNumber || '') : ''}" placeholder="079123456789">
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Ch·ª©c v·ª• <span class="required">*</span></label>
                                        <select class="form-select" id="teacherPosition" required>
                                            ${this.positions.map(p => `<option value="${p.value}" ${isEdit && data.position === p.value ? 'selected' : ''}>${p.icon} ${p.label}</option>`).join('')}
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Ng√†y gia nh·∫≠p</label>
                                        <input type="date" class="form-input" id="teacherStartDate" value="${isEdit ? (data.startDate || '') : getCurrentDate()}">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- TH√îNG TIN LI√äN H·ªÜ -->
                            <div class="form-section">
                                <div class="form-section-title">üìû Th√¥ng tin li√™n h·ªá</div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">S·ªë ƒëi·ªán tho·∫°i <span class="required">*</span></label>
                                        <input type="tel" class="form-input" id="teacherPhone" value="${isEdit ? (data.phone || '') : ''}" placeholder="0901234567" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-input" id="teacherEmail" value="${isEdit ? (data.email || '') : ''}" placeholder="email@example.com">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">ƒê·ªãa ch·ªâ</label>
                                    <input type="text" class="form-input" id="teacherAddress" value="${isEdit ? (data.address || '') : ''}" placeholder="S·ªë nh√†, ƒë∆∞·ªùng, qu·∫≠n/huy·ªán...">
                                </div>
                            </div>
                            
                            <!-- M√îN H·ªåC PH·ª§ TR√ÅCH -->
                            <div class="form-section">
                                <div class="form-section-title">üìö M√¥n h·ªçc ph·ª• tr√°ch</div>
                                
                                <div class="subjects-checkbox-group" id="subjectsCheckboxGroup">
                                    ${subjects.map(s => `
                                        <label class="subject-checkbox ${teacherSubjects.includes(s.id) ? 'checked' : ''}" onclick="TeachersModule.toggleSubject(this)">
                                            <input type="checkbox" name="subjects" value="${s.id}" ${teacherSubjects.includes(s.id) ? 'checked' : ''}>
                                            <span class="subject-checkbox-icon" style="color: ${s.color}">üìñ</span>
                                            <span class="subject-checkbox-name">${s.name}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- LO·∫†I H·ª¢P ƒê·ªíNG & L∆Ø∆†NG -->
                            <div class="form-section">
                                <div class="form-section-title">üíº H·ª£p ƒë·ªìng & L∆∞∆°ng</div>
                                
                                <div class="form-group">
                                    <label class="form-label">Lo·∫°i h·ª£p ƒë·ªìng</label>
                                    <div class="contract-type-group">
                                        <label class="contract-option ${!isEdit || data.contractType === 'full-time' ? 'selected' : ''}" onclick="TeachersModule.selectContract(this, 'full-time')">
                                            <input type="radio" name="contractType" value="full-time" ${!isEdit || data.contractType === 'full-time' ? 'checked' : ''}>
                                            <div class="contract-option-icon">üëî</div>
                                            <div class="contract-option-label">To√†n th·ªùi gian</div>
                                        </label>
                                        <label class="contract-option ${isEdit && data.contractType === 'part-time' ? 'selected' : ''}" onclick="TeachersModule.selectContract(this, 'part-time')">
                                            <input type="radio" name="contractType" value="part-time" ${isEdit && data.contractType === 'part-time' ? 'checked' : ''}>
                                            <div class="contract-option-icon">‚è∞</div>
                                            <div class="contract-option-label">B√°n th·ªùi gian</div>
                                        </label>
                                        <label class="contract-option ${isEdit && data.contractType === 'collaborator' ? 'selected' : ''}" onclick="TeachersModule.selectContract(this, 'collaborator')">
                                            <input type="radio" name="contractType" value="collaborator" ${isEdit && data.contractType === 'collaborator' ? 'checked' : ''}>
                                            <div class="contract-option-icon">ü§ù</div>
                                            <div class="contract-option-label">C·ªông t√°c vi√™n</div>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">L∆∞∆°ng c·ªë ƒë·ªãnh (VNƒê/th√°ng)</label>
                                        <input type="number" class="form-input" id="teacherSalary" value="${isEdit ? (data.salary || '') : ''}" placeholder="8000000" min="0" step="100000">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">L∆∞∆°ng theo bu·ªïi (VNƒê/bu·ªïi)</label>
                                        <input type="number" class="form-input" id="teacherRatePerSession" value="${isEdit ? (data.ratePerSession || '') : ''}" placeholder="200000" min="0" step="10000">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- TH√îNG TIN NG√ÇN H√ÄNG -->
                            <div class="form-section">
                                <div class="form-section-title">üè¶ Th√¥ng tin ng√¢n h√†ng</div>
                                
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Ng√¢n h√†ng</label>
                                        <select class="form-select" id="teacherBankName">
                                            <option value="">-- Ch·ªçn ng√¢n h√†ng --</option>
                                            <option value="Vietcombank" ${isEdit && data.bankName === 'Vietcombank' ? 'selected' : ''}>Vietcombank</option>
                                            <option value="Techcombank" ${isEdit && data.bankName === 'Techcombank' ? 'selected' : ''}>Techcombank</option>
                                            <option value="BIDV" ${isEdit && data.bankName === 'BIDV' ? 'selected' : ''}>BIDV</option>
                                            <option value="Agribank" ${isEdit && data.bankName === 'Agribank' ? 'selected' : ''}>Agribank</option>
                                            <option value="MB Bank" ${isEdit && data.bankName === 'MB Bank' ? 'selected' : ''}>MB Bank</option>
                                            <option value="VPBank" ${isEdit && data.bankName === 'VPBank' ? 'selected' : ''}>VPBank</option>
                                            <option value="ACB" ${isEdit && data.bankName === 'ACB' ? 'selected' : ''}>ACB</option>
                                            <option value="TPBank" ${isEdit && data.bankName === 'TPBank' ? 'selected' : ''}>TPBank</option>
                                            <option value="Sacombank" ${isEdit && data.bankName === 'Sacombank' ? 'selected' : ''}>Sacombank</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">S·ªë t√†i kho·∫£n</label>
                                        <input type="text" class="form-input" id="teacherBankAccount" value="${isEdit ? (data.bankAccount || '') : ''}" placeholder="1234567890">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- GHI CH√ö -->
                            <div class="form-section" style="border-bottom: none; padding-bottom: 0;">
                                <div class="form-group">
                                    <label class="form-label">Ghi ch√∫</label>
                                    <textarea class="form-textarea" id="teacherNotes" rows="2" placeholder="Ghi ch√∫ th√™m v·ªÅ nh√¢n vi√™n...">${isEdit ? (data.notes || '') : ''}</textarea>
                                </div>
                            </div>
                            
                        </form>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="TeachersModule.closeModal()">H·ªßy b·ªè</button>
                        <button type="submit" form="teacherForm" class="btn btn-primary">
                            <span>${isEdit ? 'üíæ' : '‚ûï'}</span>
                            <span>${isEdit ? 'L∆∞u thay ƒë·ªïi' : 'Th√™m nh√¢n vi√™n'}</span>
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        
        setTimeout(() => {
            document.getElementById('teacherName').focus();
        }, 100);
    },
    
    // ========================================
    // T·∫†O M√É GI√ÅO VI√äN
    // ========================================
    generateTeacherCode() {
        const teachers = DataManager.getAll(STORAGE_KEYS.teachers);
        const maxNum = teachers.reduce((max, t) => {
            const num = parseInt(t.code.replace('GV', '')) || 0;
            return num > max ? num : max;
        }, 0);
        return 'GV' + String(maxNum + 1).padStart(3, '0');
    },
    
    // ========================================
    // TOGGLE SUBJECT CHECKBOX
    // ========================================
    toggleSubject(element) {
        element.classList.toggle('checked');
        const checkbox = element.querySelector('input');
        checkbox.checked = !checkbox.checked;
    },
    
    // ========================================
    // CH·ªåN LO·∫†I H·ª¢P ƒê·ªíNG
    // ========================================
    selectContract(element, value) {
        document.querySelectorAll('.contract-option').forEach(opt => opt.classList.remove('selected'));
        element.classList.add('selected');
        element.querySelector('input').checked = true;
    },
    
    // ========================================
    // X·ª¨ L√ù SUBMIT FORM
    // ========================================
    handleSubmit(event) {
        event.preventDefault();
        
        const name = document.getElementById('teacherName').value.trim();
        const dateOfBirth = document.getElementById('teacherDob').value;
        const gender = document.getElementById('teacherGender').value;
        const idNumber = document.getElementById('teacherIdNumber').value.trim();
        const position = document.getElementById('teacherPosition').value;
        const startDate = document.getElementById('teacherStartDate').value;
        const phone = document.getElementById('teacherPhone').value.trim();
        const email = document.getElementById('teacherEmail').value.trim();
        const address = document.getElementById('teacherAddress').value.trim();
        const contractType = document.querySelector('input[name="contractType"]:checked')?.value || 'full-time';
        const salary = parseInt(document.getElementById('teacherSalary').value) || null;
        const ratePerSession = parseInt(document.getElementById('teacherRatePerSession').value) || null;
        const bankName = document.getElementById('teacherBankName').value;
        const bankAccount = document.getElementById('teacherBankAccount').value.trim();
        const notes = document.getElementById('teacherNotes').value.trim();
        
        // L·∫•y m√¥n h·ªçc ƒë∆∞·ª£c ch·ªçn
        const subjectCheckboxes = document.querySelectorAll('input[name="subjects"]:checked');
        const subjects = Array.from(subjectCheckboxes).map(cb => cb.value);
        
        // Validation
        if (!name) {
            UIManager.showNotification('Vui l√≤ng nh·∫≠p t√™n nh√¢n vi√™n!', 'error');
            return;
        }
        if (!phone) {
            UIManager.showNotification('Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i!', 'error');
            return;
        }
        
        const teacherData = {
            code: document.getElementById('teacherCode').value,
            name,
            dateOfBirth,
            gender,
            idNumber,
            position,
            startDate,
            phone,
            email,
            address,
            subjects,
            contractType,
            salary,
            ratePerSession,
            bankName,
            bankAccount,
            notes,
            status: 'active',
            avatar: null,
        };
        
        if (this.editingId) {
            teacherData.updatedAt = getCurrentDateTime();
            DataManager.update(STORAGE_KEYS.teachers, this.editingId, teacherData);
            UIManager.showNotification('C·∫≠p nh·∫≠t nh√¢n vi√™n th√†nh c√¥ng!', 'success');
            SessionManager.logActivity('update', 'teachers', this.editingId, name, `C·∫≠p nh·∫≠t nh√¢n vi√™n: ${name}`);
        } else {
            teacherData.id = generateId('GV');
            teacherData.createdAt = getCurrentDateTime();
            DataManager.add(STORAGE_KEYS.teachers, teacherData);
            UIManager.showNotification('Th√™m nh√¢n vi√™n th√†nh c√¥ng!', 'success');
            SessionManager.logActivity('create', 'teachers', teacherData.id, name, `Th√™m nh√¢n vi√™n m·ªõi: ${name}`);
        }
        
        this.closeModal();
        this.render();
    },
    
    // ========================================
    // MODAL XEM CHI TI·∫æT
    // ========================================
    showDetailModal(id) {
        const teacher = DataManager.getById(STORAGE_KEYS.teachers, id);
        if (!teacher) {
            UIManager.showNotification('Kh√¥ng t√¨m th·∫•y nh√¢n vi√™n!', 'error');
            return;
        }
        
        // L·∫•y th√¥ng tin v·ªã tr√≠
        const position = this.positions.find(p => p.value === teacher.position) || this.positions[0];
        
        // L·∫•y danh s√°ch m√¥n h·ªçc
        const subjects = DataManager.getAll(STORAGE_KEYS.subjects);
        const teacherSubjects = teacher.subjects ? subjects.filter(s => teacher.subjects.includes(s.id)) : [];
        
        // L·∫•y l·ªõp ƒëang d·∫°y
        const classes = DataManager.getAll(STORAGE_KEYS.classes).filter(c => c.teacherId === id && c.status === 'active');
        
        // T√≠nh ngh·ªâ ph√©p (gi·∫£ l·∫≠p)
        const totalLeave = 12;
        const usedLeave = Math.floor(Math.random() * 5);
        const remainingLeave = totalLeave - usedLeave;
        
        // Avatar color
        const colors = ['purple', 'green', 'blue', 'pink'];
        const colorIndex = teacher.name.charCodeAt(0) % colors.length;
        const avatarColor = colors[colorIndex];
        const avatarBg = {
            'purple': 'linear-gradient(135deg, #8b5cf6, #7c3aed)',
            'green': 'linear-gradient(135deg, #10b981, #059669)',
            'blue': 'linear-gradient(135deg, #3b82f6, #2563eb)',
            'pink': 'linear-gradient(135deg, #ec4899, #db2777)',
        };
        
        // Status
        const statusLabels = {
            'active': { label: 'ƒêang l√†m vi·ªác', class: 'working' },
            'on-leave': { label: 'ƒêang ngh·ªâ ph√©p', class: 'on-leave' },
            'inactive': { label: 'ƒê√£ ngh·ªâ vi·ªác', class: 'resigned' },
        };
        const statusInfo = statusLabels[teacher.status] || statusLabels['active'];
        
        // Contract labels
        const contractLabels = {
            'full-time': 'To√†n th·ªùi gian',
            'part-time': 'B√°n th·ªùi gian',
            'collaborator': 'C·ªông t√°c vi√™n',
        };
        
        const modalHtml = `
            <div class="modal-backdrop" id="teacherModal" onclick="TeachersModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 650px;" onclick="event.stopPropagation()">
                    <div class="modal-header" style="padding: 0; border: none;">
                        <button class="modal-close" style="position: absolute; right: 16px; top: 16px; z-index: 10;" onclick="TeachersModule.closeModal()">&times;</button>
                    </div>
                    
                    <!-- Header -->
                    <div class="teacher-detail-header">
                        <div class="teacher-detail-avatar" style="background: ${avatarBg[avatarColor]}">
                            ${teacher.name.charAt(0)}
                        </div>
                        <div class="teacher-detail-info">
                            <div class="teacher-detail-name">${teacher.name}</div>
                            <div class="teacher-detail-meta">
                                <span>üÜî ${teacher.code}</span>
                                <span>${position.icon} ${position.label}</span>
                            </div>
                            <div class="teacher-detail-badges">
                                <span class="work-status-badge ${statusInfo.class}">${statusInfo.label}</span>
                            </div>
                            ${teacherSubjects.length > 0 ? `
                                <div class="subjects-tags">
                                    ${teacherSubjects.map(s => `<span class="subject-tag" style="background: ${s.color}15; color: ${s.color}">${s.name}</span>`).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="modal-body">
                        <!-- Th√¥ng tin c∆° b·∫£n -->
                        <div class="info-section">
                            <div class="info-section-title">üìã Th√¥ng tin c∆° b·∫£n</div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">Ch·ª©c v·ª•</span>
                                    <span class="info-value">${position.label}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Ng√†y gia nh·∫≠p</span>
                                    <span class="info-value">${teacher.startDate ? new Date(teacher.startDate).toLocaleDateString('vi-VN') : 'N/A'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Lo·∫°i h·ª£p ƒë·ªìng</span>
                                    <span class="info-value">${contractLabels[teacher.contractType] || 'N/A'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">T·ª∑ l·ªá c√≥ m·∫∑t</span>
                                    <span class="info-value highlight">${teacher.attendanceRate || Math.floor(Math.random() * 10 + 90)}%</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Th√¥ng tin li√™n h·ªá -->
                        <div class="info-section">
                            <div class="info-section-title">üìû Th√¥ng tin li√™n h·ªá</div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">S·ªë ƒëi·ªán tho·∫°i</span>
                                    <span class="info-value">${teacher.phone || 'Ch∆∞a c√≥'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Email</span>
                                    <span class="info-value">${teacher.email || 'Ch∆∞a c√≥'}</span>
                                </div>
                                <div class="info-item" style="grid-column: 1 / -1;">
                                    <span class="info-label">ƒê·ªãa ch·ªâ</span>
                                    <span class="info-value">${teacher.address || 'Ch∆∞a c√≥'}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Th√¥ng tin ng√¢n h√†ng -->
                        <div class="info-section">
                            <div class="info-section-title">üè¶ Th√¥ng tin ng√¢n h√†ng</div>
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">Ng√¢n h√†ng</span>
                                    <span class="info-value">${teacher.bankName || 'Ch∆∞a c√≥'}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">S·ªë t√†i kho·∫£n</span>
                                    <span class="info-value">${teacher.bankAccount || 'Ch∆∞a c√≥'}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Th√¥ng tin ngh·ªâ ph√©p -->
                        <div class="info-section">
                            <div class="info-section-title">üìÖ Th√¥ng tin ngh·ªâ ph√©p</div>
                            <div class="leave-info-grid">
                                <div class="leave-info-item">
                                    <div class="leave-info-value">${totalLeave}</div>
                                    <div class="leave-info-label">T·ªïng ng√†y ph√©p/nƒÉm</div>
                                </div>
                                <div class="leave-info-item">
                                    <div class="leave-info-value used">${usedLeave}</div>
                                    <div class="leave-info-label">ƒê√£ s·ª≠ d·ª•ng</div>
                                </div>
                                <div class="leave-info-item">
                                    <div class="leave-info-value remaining">${remainingLeave}</div>
                                    <div class="leave-info-label">C√≤n l·∫°i</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- L·ªõp ƒëang d·∫°y -->
                        ${classes.length > 0 ? `
                            <div class="info-section">
                                <div class="info-section-title">üìö L·ªõp ƒëang d·∫°y (${classes.length})</div>
                                <div class="schedule-grid">
                                    ${classes.map(c => {
                                        const subject = DataManager.getById(STORAGE_KEYS.subjects, c.subjectId);
                                        return `
                                            <div class="schedule-class-item">
                                                <div class="schedule-class-icon" style="background: ${subject ? subject.color + '20' : '#f3f4f6'}">üìñ</div>
                                                <div class="schedule-class-info">
                                                    <div class="schedule-class-name">${c.name}</div>
                                                    <div class="schedule-class-time">${c.currentStudents || 0} h·ªçc vi√™n</div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="TeachersModule.closeModal()">ƒê√≥ng</button>
                        <button type="button" class="btn btn-warning" onclick="TeachersModule.closeModal(); TeachersModule.showEditModal('${id}')">
                            <span>‚úèÔ∏è</span> Ch·ªânh s·ª≠a
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },
    
    // ========================================
    // X√ÅC NH·∫¨N X√ìA
    // ========================================
    showDeleteConfirm(id) {
        const teacher = DataManager.getById(STORAGE_KEYS.teachers, id);
        if (!teacher) return;
        
        // Ki·ªÉm tra c√≥ l·ªõp ƒëang d·∫°y kh√¥ng
        const classes = DataManager.getAll(STORAGE_KEYS.classes).filter(c => c.teacherId === id && c.status === 'active');
        if (classes.length > 0) {
            UIManager.showNotification(`Kh√¥ng th·ªÉ x√≥a! Nh√¢n vi√™n ƒëang d·∫°y ${classes.length} l·ªõp.`, 'error');
            return;
        }
        
        const modalHtml = `
            <div class="modal-backdrop" id="teacherModal" onclick="TeachersModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 420px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title"><span>‚ö†Ô∏è</span> X√°c nh·∫≠n x√≥a</h3>
                        <button class="modal-close" onclick="TeachersModule.closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="confirm-dialog">
                            <div class="confirm-icon">üóëÔ∏è</div>
                            <div class="confirm-title">X√≥a nh√¢n vi√™n n√†y?</div>
                            <div class="confirm-message">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a:</div>
                            <div class="confirm-highlight">${teacher.name} (${teacher.code})</div>
                            <div class="confirm-message" style="margin-top: 12px; color: #ef4444;">H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="TeachersModule.closeModal()">H·ªßy b·ªè</button>
                        <button type="button" class="btn btn-danger" onclick="TeachersModule.deleteTeacher('${id}')">
                            <span>üóëÔ∏è</span> X√≥a nh√¢n vi√™n
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },
    
    // ========================================
    // X√ìA GI√ÅO VI√äN
    // ========================================
    deleteTeacher(id) {
        const teacher = DataManager.getById(STORAGE_KEYS.teachers, id);
        if (!teacher) return;
        
        DataManager.delete(STORAGE_KEYS.teachers, id);
        SessionManager.logActivity('delete', 'teachers', id, teacher.name, `X√≥a nh√¢n vi√™n: ${teacher.name}`);
        UIManager.showNotification('ƒê√£ x√≥a nh√¢n vi√™n th√†nh c√¥ng!', 'success');
        
        this.closeModal();
        this.render();
    },
    
    // ========================================
    // ƒê√ìNG MODAL
    // ========================================
    closeModal() {
        const modal = document.getElementById('teacherModal');
        if (modal) modal.remove();
        this.editingId = null;
    },
    
    closeModalOnBackdrop(event) {
        if (event.target.id === 'teacherModal') this.closeModal();
    },
};

// ------------------------------------------------------------
// C·∫¨P NH·∫¨T UIMANAGER
// ------------------------------------------------------------
const originalRenderPageContent4 = UIManager.renderPageContent.bind(UIManager);
UIManager.renderPageContent = function(pageName) {
    if (pageName === 'teachers') {
        TeachersModule.render();
    } else {
        originalRenderPageContent4(pageName);
    }
};

console.log('‚úÖ Module Qu·∫£n l√Ω Gi√°o vi√™n ƒë√£ load');

// ============================================================
// MODULE ƒêI·ªÇM DANH + H·ªåC B√ô - PHI√äN B·∫¢N S·ª¨A L·ªñI
// Th√™m v√†o cu·ªëi th·∫ª <script> trong file index.html
// ============================================================

const AttendanceModule = {
    // === STATE ===
    currentTab: 'attendance',
    dateFrom: null,
    dateTo: null,
    selectedSessions: [],
    attendanceData: {},
    selectedClass: 'all',
    searchQuery: '',

    // === KH·ªûI T·∫†O NG√ÄY M·∫∂C ƒê·ªäNH ===
    initDates: function() {
        if (!this.dateFrom) {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const monday = new Date(today);
            monday.setDate(today.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
            const sunday = new Date(monday);
            sunday.setDate(monday.getDate() + 6);
            
            this.dateFrom = monday.toISOString().split('T')[0];
            this.dateTo = sunday.toISOString().split('T')[0];
        }
    },

    // === RENDER CH√çNH ===
    render: function() {
        this.initDates();
        
        const contentArea = document.getElementById('contentArea');
        const stats = this.getStats();
        const makeupStats = this.getMakeupStats();

        contentArea.innerHTML = `
            <!-- STATS BAR -->
            <div class="attendance-stats-bar">
                <div class="attendance-stat-item">
                    <div class="attendance-stat-icon sessions">üìÖ</div>
                    <div class="attendance-stat-info">
                        <div class="attendance-stat-value blue">${stats.todaySessions}</div>
                        <div class="attendance-stat-label">Bu·ªïi h·ªçc h√¥m nay</div>
                    </div>
                </div>
                <div class="attendance-stat-item">
                    <div class="attendance-stat-icon present">‚úÖ</div>
                    <div class="attendance-stat-info">
                        <div class="attendance-stat-value green">${stats.present}</div>
                        <div class="attendance-stat-label">C√≥ m·∫∑t</div>
                    </div>
                </div>
                <div class="attendance-stat-item">
                    <div class="attendance-stat-icon absent">‚ùå</div>
                    <div class="attendance-stat-info">
                        <div class="attendance-stat-value red">${stats.absent}</div>
                        <div class="attendance-stat-label">V·∫Øng m·∫∑t</div>
                    </div>
                </div>
                <div class="attendance-stat-item">
                    <div class="attendance-stat-icon rate">üìä</div>
                    <div class="attendance-stat-info">
                        <div class="attendance-stat-value purple">${stats.rate}%</div>
                        <div class="attendance-stat-label">T·ª∑ l·ªá c√≥ m·∫∑t</div>
                    </div>
                </div>
                <div class="attendance-stat-item">
                    <div class="attendance-stat-icon makeup">üîÑ</div>
                    <div class="attendance-stat-info">
                        <div class="attendance-stat-value yellow">${makeupStats.pending}</div>
                        <div class="attendance-stat-label">Ch·ªù h·ªçc b√π</div>
                    </div>
                </div>
            </div>

            <!-- TABS -->
            <div class="attendance-tabs">
                <button class="attendance-tab ${this.currentTab === 'attendance' ? 'active' : ''}" 
                        onclick="AttendanceModule.switchTab('attendance')">
                    üìã ƒêi·ªÉm danh
                </button>
                <button class="attendance-tab ${this.currentTab === 'makeup' ? 'active' : ''}" 
                        onclick="AttendanceModule.switchTab('makeup')">
                    üîÑ H·ªçc b√π
                    ${makeupStats.pending > 0 ? `<span class="badge">${makeupStats.pending}</span>` : ''}
                </button>
                <button class="attendance-tab ${this.currentTab === 'history' ? 'active' : ''}" 
                        onclick="AttendanceModule.switchTab('history')">
                    üìú L·ªãch s·ª≠
                </button>
            </div>

            <!-- TAB CONTENT -->
            <div id="attendanceTabContent">
                ${this.renderTabContent()}
            </div>
        `;

        this.checkExpiringRequests();
    },

    // === RENDER N·ªòI DUNG TAB ===
    renderTabContent: function() {
        switch (this.currentTab) {
            case 'attendance':
                return this.renderAttendanceTab();
            case 'makeup':
                return this.renderMakeupTab();
            case 'history':
                return this.renderHistoryTab();
            default:
                return this.renderAttendanceTab();
        }
    },

    // === CHUY·ªÇN TAB ===
    switchTab: function(tab) {
        this.currentTab = tab;
        document.querySelectorAll('.attendance-tab').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        const content = document.getElementById('attendanceTabContent');
        if (content) {
            content.innerHTML = this.renderTabContent();
        }
    },

    // === TAB ƒêI·ªÇM DANH ===
    renderAttendanceTab: function() {
        const todaySessions = this.getTodaySessions();
        
        return `
            <!-- Ch·ªçn kho·∫£ng th·ªùi gian -->
            <div class="date-range-picker">
                <label>üìÖ T·ª´ ng√†y:</label>
                <input type="date" id="dateFrom" value="${this.dateFrom}" 
                       onchange="AttendanceModule.dateFrom = this.value">
                
                <label>ƒê·∫øn ng√†y:</label>
                <input type="date" id="dateTo" value="${this.dateTo}" 
                       onchange="AttendanceModule.dateTo = this.value">
                
                <button class="btn-search-attendance" onclick="AttendanceModule.searchSessions()">
                    üîç Tra c·ª©u ƒëi·ªÉm danh
                </button>
            </div>

            <!-- Bu·ªïi h·ªçc h√¥m nay -->
            <div class="today-sessions-section">
                <div class="today-sessions-header">
                    <div class="today-sessions-title">
                        <span>üìö</span>
                        Bu·ªïi h·ªçc h√¥m nay - ${this.formatDateVN(getCurrentDate())}
                    </div>
                    <button class="btn btn-primary" onclick="AttendanceModule.showQuickAttendanceModal()">
                        <span>‚ûï</span>
                        <span>ƒêi·ªÉm danh m·ªõi</span>
                    </button>
                </div>
                <div class="today-sessions-list">
                    ${this.renderTodaySessions(todaySessions)}
                </div>
            </div>

            <!-- B·∫£ng ƒëi·ªÉm danh chi ti·∫øt -->
            <div class="attendance-table-section">
                <div class="attendance-table-header">
                    <div class="attendance-table-title">üìã B·∫£ng ƒëi·ªÉm danh chi ti·∫øt</div>
                    <div class="attendance-filters">
                        <div class="search-box" style="min-width: 200px;">
                            <input type="text" id="attendanceSearch" placeholder="T√¨m ki·∫øm theo t√™n h·ªçc vi√™n..." 
                                   value="${this.searchQuery}" onkeyup="AttendanceModule.handleSearch(this.value)">
                        </div>
                        <select class="filter-select" id="attendanceClassFilter" onchange="AttendanceModule.handleClassFilter(this.value)">
                            <option value="all">T·∫•t c·∫£ l·ªõp</option>
                            ${this.renderClassOptions()}
                        </select>
                        <div class="date-picker-wrapper">
                            <input type="date" id="attendanceDatePicker" value="${getCurrentDate()}" 
                                   onchange="AttendanceModule.handleDateFilter(this.value)">
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th style="width: 50px;">
                                    <input type="checkbox" id="checkAll" onchange="AttendanceModule.toggleSelectAll(this)">
                                </th>
                                <th style="min-width: 180px;">H·ªçc vi√™n</th>
                                <th style="min-width: 150px;">L·ªõp h·ªçc</th>
                                <th style="width: 110px;">Ng√†y</th>
                                <th style="width: 120px;">Tr·∫°ng th√°i</th>
                                <th style="width: 90px;">Gi·ªù v√†o</th>
                                <th style="min-width: 120px;">Ghi ch√∫</th>
                                <th style="width: 140px; text-align: right;">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTableBody">
                            ${this.renderAttendanceTable()}
                        </tbody>
                    </table>
                </div>
            </div>
        `;
    },

    // === L·∫§Y BU·ªîI H·ªåC H√îM NAY ===
    getTodaySessions: function() {
        const classes = DataManager.getAll(STORAGE_KEYS.classes);
        const today = new Date();
        const dayOfWeek = today.getDay() || 7;

        return classes.filter(cls => {
            if (cls.status !== 'active') return false;
            if (!cls.schedule) return false;
            return cls.schedule.some(s => s.dayOfWeek === dayOfWeek);
        }).map(cls => {
            const schedule = cls.schedule.find(s => s.dayOfWeek === dayOfWeek);
            const attendance = DataManager.getAll(STORAGE_KEYS.attendance).filter(a => 
                a.classId === cls.id && a.date === getCurrentDate()
            );
            
            return {
                ...cls,
                schedule,
                stats: {
                    present: attendance.filter(a => a.status === 'present').length,
                    absent: attendance.filter(a => a.status === 'absent' || a.status === 'excused').length,
                    late: attendance.filter(a => a.status === 'late').length,
                    total: attendance.length,
                },
                isCompleted: attendance.length > 0,
            };
        });
    },

    // === RENDER BU·ªîI H·ªåC H√îM NAY ===
    renderTodaySessions: function(sessions) {
        if (sessions.length === 0) {
            return `
                <div class="no-sessions-today">
                    <div class="no-sessions-icon">üìÖ</div>
                    <div class="no-sessions-text">Kh√¥ng c√≥ bu·ªïi h·ªçc n√†o h√¥m nay</div>
                </div>
            `;
        }

        return sessions.map(session => {
            const subject = DataManager.getById(STORAGE_KEYS.subjects, session.subjectId);
            const statusClass = session.isCompleted ? 'completed' : 'in-progress';
            const statusText = session.isCompleted ? 'Ho√†n th√†nh' : 'ƒêang di·ªÖn ra';

            return `
                <div class="session-card">
                    <div class="session-card-icon" style="background: ${subject ? subject.color + '20' : '#f3f4f6'}">
                        üìñ
                    </div>
                    <div class="session-card-info">
                        <div class="session-card-name">${session.name}</div>
                        <div class="session-card-meta">
                            <span>üë®‚Äçüè´ ${session.teacherName}</span>
                            <span>üïê ${session.schedule.startTime} - ${session.schedule.endTime}</span>
                        </div>
                    </div>
                    <div class="session-card-stats">
                        <div class="session-stat">
                            <div class="session-stat-value present">${session.stats.present}</div>
                            <div class="session-stat-label">C√≥ m·∫∑t</div>
                        </div>
                        <div class="session-stat">
                            <div class="session-stat-value absent">${session.stats.absent}</div>
                            <div class="session-stat-label">V·∫Øng</div>
                        </div>
                        <div class="session-stat">
                            <div class="session-stat-value late">${session.stats.late}</div>
                            <div class="session-stat-label">Mu·ªôn</div>
                        </div>
                    </div>
                    <div class="session-card-actions">
                        <span class="session-status-badge ${statusClass}">${statusText}</span>
                        <button class="btn btn-sm btn-primary" onclick="AttendanceModule.showQuickAttendanceModal('${session.id}')">
                            Chi ti·∫øt
                        </button>
                    </div>
                </div>
            `;
        }).join('');
    },

    // === RENDER CLASS OPTIONS ===
    renderClassOptions: function() {
        const classes = DataManager.getAll(STORAGE_KEYS.classes).filter(c => c.status === 'active');
        return classes.map(c => 
            `<option value="${c.id}" ${this.selectedClass === c.id ? 'selected' : ''}>${c.name}</option>`
        ).join('');
    },

    // === RENDER B·∫¢NG ƒêI·ªÇM DANH ===
    renderAttendanceTable: function() {
        let attendance = DataManager.getAll(STORAGE_KEYS.attendance);
        
        // L·ªçc theo ng√†y
        const selectedDate = document.getElementById('attendanceDatePicker')?.value || getCurrentDate();
        attendance = attendance.filter(a => a.date === selectedDate);
        
        // L·ªçc theo l·ªõp
        if (this.selectedClass !== 'all') {
            attendance = attendance.filter(a => a.classId === this.selectedClass);
        }
        
        // T√¨m ki·∫øm
        if (this.searchQuery) {
            const q = this.searchQuery.toLowerCase();
            attendance = attendance.filter(a => 
                a.studentName && a.studentName.toLowerCase().includes(q)
            );
        }

        if (attendance.length === 0) {
            return `
                <tr>
                    <td colspan="8">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìã</div>
                            <div class="empty-state-title">Ch∆∞a c√≥ d·ªØ li·ªáu ƒëi·ªÉm danh</div>
                            <div class="empty-state-desc">Ch·ªçn l·ªõp v√† b·∫•m "ƒêi·ªÉm danh m·ªõi" ƒë·ªÉ b·∫Øt ƒë·∫ßu</div>
                        </div>
                    </td>
                </tr>
            `;
        }

        const statusOptions = [
            { value: 'present', label: 'C√≥ m·∫∑t', icon: '‚úÖ' },
            { value: 'late', label: 'Mu·ªôn', icon: 'üü°' },
            { value: 'absent', label: 'V·∫Øng m·∫∑t', icon: '‚ùå' },
            { value: 'excused', label: 'C√≥ ph√©p', icon: 'üìù' },
        ];

        return attendance.map(record => {
            const student = DataManager.getById(STORAGE_KEYS.students, record.studentId);
            const cls = DataManager.getById(STORAGE_KEYS.classes, record.classId);
            const statusInfo = statusOptions.find(s => s.value === record.status) || statusOptions[0];
            const avatarColor = student && student.gender === 'N·ªØ' ? '#ec4899' : '#3b82f6';

            return `
                <tr>
                    <td>
                        <input type="checkbox" class="attendance-checkbox" data-id="${record.id}">
                    </td>
                    <td>
                        <div class="student-cell-info">
                            <div class="student-avatar" style="background: ${avatarColor}">
                                ${record.studentName ? record.studentName.charAt(0) : '?'}
                            </div>
                            <div class="student-name-group">
                                <div class="student-name">${record.studentName}</div>
                                <div class="student-age">${student ? student.code : ''}</div>
                            </div>
                        </div>
                    </td>
                    <td>${cls ? cls.name : record.classId}</td>
                    <td>${this.formatDateVN(record.date)}</td>
                    <td>
                        <span class="attendance-status ${record.status}">
                            ${statusInfo.icon} ${statusInfo.label}
                        </span>
                    </td>
                    <td>
                        <span class="time-display">${record.checkedAt ? record.checkedAt.split(' ')[1] || '--:--' : '--:--'}</span>
                    </td>
                    <td>
                        <span class="notes-cell">${record.notes || '-'}</span>
                    </td>
                    <td>
                        <div class="actions-cell">
                            <button class="action-btn view" onclick="AttendanceModule.showDetailModal('${record.id}')" title="Xem">üëÅÔ∏è</button>
                            <button class="action-btn edit" onclick="AttendanceModule.showEditModal('${record.id}')" title="S·ª≠a">‚úèÔ∏è</button>
                            <button class="action-btn delete" onclick="AttendanceModule.deleteRecord('${record.id}')" title="X√≥a">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    },

    // === MODAL ƒêI·ªÇM DANH NHANH ===
    showQuickAttendanceModal: function(classId = null) {
        const classes = DataManager.getAll(STORAGE_KEYS.classes).filter(c => c.status === 'active');

        const modalHtml = `
            <div class="modal-backdrop" id="attendanceModal" onclick="AttendanceModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 800px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title">
                            <span>‚úÖ</span>
                            ƒêi·ªÉm danh nhanh
                        </h3>
                        <button class="modal-close" onclick="AttendanceModule.closeModal()">&times;</button>
                    </div>
                    
                    <div class="modal-body">
                        <!-- Ch·ªçn l·ªõp v√† ng√†y -->
                        <div class="form-row" style="margin-bottom: 20px;">
                            <div class="form-group">
                                <label class="form-label">Ch·ªçn l·ªõp h·ªçc <span class="required">*</span></label>
                                <select class="form-select" id="quickClassSelect" onchange="AttendanceModule.loadClassStudents(this.value)">
                                    <option value="">-- Ch·ªçn l·ªõp --</option>
                                    ${classes.map(c => `<option value="${c.id}" ${classId === c.id ? 'selected' : ''}>${c.name}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ng√†y ƒëi·ªÉm danh</label>
                                <input type="date" class="form-input" id="quickDateSelect" value="${getCurrentDate()}">
                            </div>
                        </div>
                        
                        <!-- Bulk status -->
                        <div style="display: flex; gap: 12px; margin-bottom: 16px; align-items: center; flex-wrap: wrap;">
                            <span style="font-weight: 600; color: #374151;">ƒêi·ªÉm danh t·∫•t c·∫£:</span>
                            <button class="btn btn-sm btn-secondary" onclick="AttendanceModule.setAllStatus('present')">‚úÖ C√≥ m·∫∑t</button>
                            <button class="btn btn-sm btn-secondary" onclick="AttendanceModule.setAllStatus('late')">üü° Mu·ªôn</button>
                            <button class="btn btn-sm btn-secondary" onclick="AttendanceModule.setAllStatus('absent')">‚ùå V·∫Øng</button>
                            <button class="btn btn-sm btn-secondary" onclick="AttendanceModule.setAllStatus('excused')">üìù C√≥ ph√©p</button>
                        </div>
                        
                        <!-- Danh s√°ch h·ªçc vi√™n -->
                        <div class="quick-attendance-grid" id="quickAttendanceGrid">
                            <div style="text-align: center; padding: 40px; color: #6b7280; grid-column: 1/-1;">
                                Vui l√≤ng ch·ªçn l·ªõp h·ªçc ƒë·ªÉ hi·ªÉn th·ªã danh s√°ch h·ªçc vi√™n
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="AttendanceModule.closeModal()">H·ªßy b·ªè</button>
                        <button type="button" class="btn btn-success" onclick="AttendanceModule.saveQuickAttendance()">
                            <span>üíæ</span>
                            <span>L∆∞u ƒëi·ªÉm danh</span>
                        </button>
                    </div>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHtml);

        if (classId) {
            this.loadClassStudents(classId);
        }
    },

    // === LOAD DANH S√ÅCH H·ªåC VI√äN ===
    loadClassStudents: function(classId) {
        const grid = document.getElementById('quickAttendanceGrid');

        if (!classId) {
            grid.innerHTML = `<div style="text-align: center; padding: 40px; color: #6b7280; grid-column: 1/-1;">
                Vui l√≤ng ch·ªçn l·ªõp h·ªçc ƒë·ªÉ hi·ªÉn th·ªã danh s√°ch h·ªçc vi√™n
            </div>`;
            return;
        }

        const enrollments = DataManager.getAll(STORAGE_KEYS.enrollments).filter(e => e.classId === classId && e.status === 'active');

        if (enrollments.length === 0) {
            grid.innerHTML = `<div style="text-align: center; padding: 40px; color: #6b7280; grid-column: 1/-1;">
                L·ªõp n√†y ch∆∞a c√≥ h·ªçc vi√™n n√†o
            </div>`;
            return;
        }

        grid.innerHTML = enrollments.map(enrollment => {
            const student = DataManager.getById(STORAGE_KEYS.students, enrollment.studentId);
            const avatarColor = student && student.gender === 'N·ªØ' ? '#ec4899' : '#3b82f6';

            return `
                <div class="quick-attendance-item" data-student-id="${enrollment.studentId}" data-enrollment-id="${enrollment.id}">
                    <div class="quick-attendance-avatar" style="background: ${avatarColor}">
                        ${enrollment.studentName ? enrollment.studentName.charAt(0) : '?'}
                    </div>
                    <div class="quick-attendance-info">
                        <div class="quick-attendance-name">${enrollment.studentName}</div>
                        <div class="quick-attendance-code">${student ? student.code : ''}</div>
                    </div>
                    <div class="quick-attendance-status">
                        <select class="quick-status-select" data-student-id="${enrollment.studentId}" onchange="AttendanceModule.onStatusChange(this)">
                            <option value="present">‚úÖ C√≥ m·∫∑t</option>
                            <option value="late">üü° Mu·ªôn</option>
                            <option value="absent">‚ùå V·∫Øng</option>
                            <option value="excused">üìù C√≥ ph√©p</option>
                        </select>
                    </div>
                </div>
            `;
        }).join('');
    },

    // === SET ALL STATUS ===
    setAllStatus: function(status) {
        const selects = document.querySelectorAll('.quick-status-select');
        selects.forEach(select => {
            select.value = status;
            this.onStatusChange(select);
        });
    },

    // === ON STATUS CHANGE ===
    onStatusChange: function(select) {
        const item = select.closest('.quick-attendance-item');
        select.className = 'quick-status-select ' + select.value;

        if (select.value === 'excused') {
            if (!item.querySelector('.excused-note')) {
                const noteHtml = `
                    <div class="excused-note" style="width: 100%; margin-top: 10px;">
                        <input type="text" class="form-input" placeholder="L√Ω do ngh·ªâ..." style="font-size: 13px; padding: 8px 12px;">
                    </div>
                `;
                item.insertAdjacentHTML('beforeend', noteHtml);
            }
        } else {
            const note = item.querySelector('.excused-note');
            if (note) note.remove();
        }
    },

    // === L∆ØU ƒêI·ªÇM DANH NHANH ===
    saveQuickAttendance: function() {
        const classId = document.getElementById('quickClassSelect').value;
        const date = document.getElementById('quickDateSelect').value;

        if (!classId) {
            UIManager.showNotification('Vui l√≤ng ch·ªçn l·ªõp!', 'error');
            return;
        }

        const cls = DataManager.getById(STORAGE_KEYS.classes, classId);
        const items = document.querySelectorAll('.quick-attendance-item');
        let savedCount = 0;
        let excusedCount = 0;

        items.forEach(item => {
            const studentId = item.getAttribute('data-student-id');
            const enrollmentId = item.getAttribute('data-enrollment-id');
            const status = item.querySelector('.quick-status-select').value;
            const noteInput = item.querySelector('.excused-note input');
            const notes = noteInput ? noteInput.value : '';

            const student = DataManager.getById(STORAGE_KEYS.students, studentId);

            // Ki·ªÉm tra ƒë√£ ƒëi·ªÉm danh ch∆∞a
            const existing = DataManager.getAll(STORAGE_KEYS.attendance).find(a => 
                a.studentId === studentId && a.classId === classId && a.date === date
            );

            const attendanceData = {
                sessionId: null,
                enrollmentId,
                studentId,
                studentName: student ? student.name : '',
                classId,
                date,
                sessionNumber: 0,
                status,
                lateMinutes: status === 'late' ? 10 : 0,
                checkedBy: 'admin',
                checkedAt: getCurrentDateTime(),
                makeupFromId: null,
                notes,
            };

            if (existing) {
                DataManager.update(STORAGE_KEYS.attendance, existing.id, attendanceData);
            } else {
                attendanceData.id = generateId('DD');
                attendanceData.createdAt = getCurrentDateTime();
                DataManager.add(STORAGE_KEYS.attendance, attendanceData);
            }

            // T·∫°o y√™u c·∫ßu h·ªçc b√π n·∫øu ngh·ªâ c√≥ ph√©p
            if (status === 'excused') {
                this.createMakeupRequest({
                    ...attendanceData,
                    sessionId: attendanceData.id,
                });
                excusedCount++;
            }

            savedCount++;
        });

        UIManager.showNotification(`ƒê√£ l∆∞u ƒëi·ªÉm danh ${savedCount} h·ªçc vi√™n!`, 'success');

        if (excusedCount > 0) {
            UIManager.showNotification(`ƒê√£ t·∫°o ${excusedCount} y√™u c·∫ßu h·ªçc b√π.`, 'info');
        }

        SessionManager.logActivity('create', 'attendance', classId, cls ? cls.name : '', 
            `ƒêi·ªÉm danh l·ªõp ${cls ? cls.name : ''} - ${savedCount} h·ªçc vi√™n`);

        this.closeModal();
        this.render();
    },

    // === T·∫†O Y√äU C·∫¶U H·ªåC B√ô ===
    createMakeupRequest: function(attendanceRecord) {
        const existingRequest = DataManager.getAll(STORAGE_KEYS.makeupRequests).find(m => 
            m.originalSessionId === attendanceRecord.sessionId && 
            m.studentId === attendanceRecord.studentId
        );

        if (existingRequest) return;

        const student = DataManager.getById(STORAGE_KEYS.students, attendanceRecord.studentId);
        const cls = DataManager.getById(STORAGE_KEYS.classes, attendanceRecord.classId);

        const makeupRequest = {
            id: generateId('HB'),
            originalSessionId: attendanceRecord.sessionId,
            originalDate: attendanceRecord.date,
            originalClassId: attendanceRecord.classId,
            originalClassName: cls ? cls.name : '',
            studentId: attendanceRecord.studentId,
            studentName: attendanceRecord.studentName,
            enrollmentId: attendanceRecord.enrollmentId,
            makeupSessionId: null,
            makeupDate: null,
            makeupClassId: null,
            makeupClassName: null,
            status: 'pending',
            reason: attendanceRecord.notes || 'Ngh·ªâ c√≥ ph√©p',
            expiryDate: addDays(attendanceRecord.date, 30),
            notes: '',
            createdAt: getCurrentDateTime(),
        };

        DataManager.add(STORAGE_KEYS.makeupRequests, makeupRequest);

        SessionManager.logActivity('create', 'makeupRequests', makeupRequest.id, student ? student.name : '', 
            `T·∫°o y√™u c·∫ßu h·ªçc b√π cho ${student ? student.name : 'h·ªçc vi√™n'}`);
    },

    // === TAB H·ªåC B√ô ===
    renderMakeupTab: function() {
        const stats = this.getMakeupStats();
        const requests = DataManager.getAll(STORAGE_KEYS.makeupRequests) || [];

        return `
            <!-- Makeup Stats -->
            <div class="makeup-stats-grid">
                <div class="makeup-stat-item pending">
                    <h4>${stats.pending}</h4>
                    <p>‚è≥ Ch·ªù x·ª≠ l√Ω</p>
                </div>
                <div class="makeup-stat-item scheduled">
                    <h4>${stats.scheduled}</h4>
                    <p>üìÖ ƒê√£ x·∫øp l·ªãch</p>
                </div>
                <div class="makeup-stat-item completed">
                    <h4>${stats.completed}</h4>
                    <p>‚úÖ Ho√†n th√†nh</p>
                </div>
                <div class="makeup-stat-item expiring">
                    <h4>${stats.expiring}</h4>
                    <p>‚ö†Ô∏è S·∫Øp h·∫øt h·∫°n</p>
                </div>
            </div>

            <!-- Requests Table -->
            <div class="attendance-table-section">
                <div class="table-container">
                    <table class="data-table makeup-requests-table">
                        <thead>
                            <tr>
                                <th>M√£ YC</th>
                                <th>H·ªçc vi√™n</th>
                                <th>L·ªõp g·ªëc</th>
                                <th>Ng√†y ngh·ªâ</th>
                                <th>L·ªõp h·ªçc b√π</th>
                                <th>H·∫°n h·ªçc b√π</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th style="text-align: right;">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${this.renderMakeupRequests(requests)}
                        </tbody>
                    </table>
                </div>
            </div>
        `;
    },

    // === RENDER MAKEUP REQUESTS ===
    renderMakeupRequests: function(requests) {
        if (requests.length === 0) {
            return `
                <tr>
                    <td colspan="8">
                        <div class="empty-state">
                            <div class="empty-state-icon">üîÑ</div>
                            <div class="empty-state-title">Kh√¥ng c√≥ y√™u c·∫ßu h·ªçc b√π</div>
                            <div class="empty-state-desc">Y√™u c·∫ßu h·ªçc b√π s·∫Ω xu·∫•t hi·ªán khi c√≥ h·ªçc vi√™n ngh·ªâ c√≥ ph√©p</div>
                        </div>
                    </td>
                </tr>
            `;
        }

        return requests.map(req => {
            const expiryInfo = this.getExpiryInfo(req.expiryDate);
            const statusBadge = this.getMakeupStatusBadge(req.status);
            const actions = this.getMakeupActions(req);

            return `
                <tr>
                    <td><strong>${req.id}</strong></td>
                    <td>${req.studentName}</td>
                    <td>
                        ${req.originalClassName}<br>
                        <small style="color:#888;">Bu·ªïi ${req.originalSessionNumber || '?'}</small>
                    </td>
                    <td>${this.formatDateVN(req.originalDate)}</td>
                    <td>
                        ${req.makeupClassName || '<span style="color:#888;">Ch∆∞a x·∫øp</span>'}
                        ${req.makeupDate ? `<br><small style="color:#667eea;">${this.formatDateVN(req.makeupDate)}</small>` : ''}
                    </td>
                    <td>
                        <div class="expiry-warning">
                            <span class="expiry-date">${this.formatDateVN(req.expiryDate)}</span>
                            <span class="expiry-days ${expiryInfo.class}">${expiryInfo.text}</span>
                        </div>
                    </td>
                    <td>${statusBadge}</td>
                    <td>
                        <div class="actions-cell">
                            ${actions}
                        </div>
                    </td>
                </tr>
            `;
        }).join('');
    },

    // === TAB L·ªäCH S·ª¨ ===
    renderHistoryTab: function() {
        const records = DataManager.getAll(STORAGE_KEYS.attendance) || [];
        const recentRecords = records.slice(-50).reverse();

        return `
            <div class="attendance-table-section">
                <div class="attendance-table-header">
                    <div class="attendance-table-title">üìú L·ªãch s·ª≠ ƒëi·ªÉm danh (50 b·∫£n ghi g·∫ßn nh·∫•t)</div>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ng√†y</th>
                                <th>L·ªõp h·ªçc</th>
                                <th>H·ªçc vi√™n</th>
                                <th>Bu·ªïi</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Ghi ch√∫</th>
                                <th>Ng∆∞·ªùi ƒëi·ªÉm danh</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${this.renderHistoryRecords(recentRecords)}
                        </tbody>
                    </table>
                </div>
            </div>
        `;
    },

    // === RENDER HISTORY RECORDS ===
    renderHistoryRecords: function(records) {
        if (records.length === 0) {
            return `
                <tr>
                    <td colspan="7">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìú</div>
                            <div class="empty-state-title">Ch∆∞a c√≥ l·ªãch s·ª≠ ƒëi·ªÉm danh</div>
                        </div>
                    </td>
                </tr>
            `;
        }

        const statusLabels = {
            present: '‚úÖ C√≥ m·∫∑t',
            late: 'üü° Mu·ªôn',
            absent: '‚ùå V·∫Øng',
            excused: 'üìù C√≥ ph√©p',
            makeup: 'üîÑ H·ªçc b√π'
        };

        return records.map(record => `
            <tr>
                <td>${this.formatDateVN(record.date)}</td>
                <td>${record.className || DataManager.getById(STORAGE_KEYS.classes, record.classId)?.name || 'N/A'}</td>
                <td>${record.studentName || 'N/A'}</td>
                <td>${record.sessionNumber || '-'}</td>
                <td><span class="attendance-status ${record.status}">${statusLabels[record.status] || record.status}</span></td>
                <td style="color:#888;font-size:12px;">${record.notes || '-'}</td>
                <td style="color:#888;font-size:12px;">${record.checkedBy || 'N/A'}</td>
            </tr>
        `).join('');
    },

    // === TH·ªêNG K√ä ===
    getStats: function() {
        const attendance = DataManager.getAll(STORAGE_KEYS.attendance);
        const today = getCurrentDate();
        
        const todayAttendance = attendance.filter(a => a.date === today);
        const todaySessions = this.getTodaySessions();
        
        const present = todayAttendance.filter(a => a.status === 'present' || a.status === 'late').length;
        const absent = todayAttendance.filter(a => a.status === 'absent' || a.status === 'excused').length;
        const total = todayAttendance.length;
        const rate = total > 0 ? Math.round((present / total) * 100) : 0;

        return {
            todaySessions: todaySessions.length,
            present,
            absent,
            rate,
        };
    },

    getMakeupStats: function() {
        const requests = DataManager.getAll(STORAGE_KEYS.makeupRequests) || [];
        const today = new Date();
        today.setHours(0, 0, 0, 0);

        let pending = 0, scheduled = 0, completed = 0, expiring = 0;

        requests.forEach(req => {
            if (req.status === 'pending') pending++;
            else if (req.status === 'scheduled') scheduled++;
            else if (req.status === 'completed') completed++;

            if (req.status === 'pending' || req.status === 'scheduled') {
                const expiry = new Date(req.expiryDate);
                expiry.setHours(0, 0, 0, 0);
                const diffDays = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));
                if (diffDays >= 0 && diffDays <= 7) {
                    expiring++;
                }
            }
        });

        return { pending, scheduled, completed, expiring };
    },

    // === UTILITY FUNCTIONS ===
    getExpiryInfo: function(expiryDate) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const expiry = new Date(expiryDate);
        expiry.setHours(0, 0, 0, 0);

        const diffDays = Math.ceil((expiry - today) / (1000 * 60 * 60 * 24));

        if (diffDays < 0) return { text: 'ƒê√£ h·∫øt h·∫°n', class: 'danger' };
        if (diffDays === 0) return { text: 'H√¥m nay!', class: 'danger' };
        if (diffDays <= 7) return { text: `C√≤n ${diffDays} ng√†y`, class: 'warning' };
        return { text: `C√≤n ${diffDays} ng√†y`, class: 'safe' };
    },

    getMakeupStatusBadge: function(status) {
        const badges = {
            pending: '<span class="makeup-status-badge pending">‚è≥ Ch·ªù x·ª≠ l√Ω</span>',
            scheduled: '<span class="makeup-status-badge scheduled">üìÖ ƒê√£ x·∫øp l·ªãch</span>',
            completed: '<span class="makeup-status-badge completed">‚úÖ Ho√†n th√†nh</span>',
            expired: '<span class="makeup-status-badge expired">‚è∞ H·∫øt h·∫°n</span>',
            cancelled: '<span class="makeup-status-badge cancelled">‚ùå ƒê√£ h·ªßy</span>'
        };
        return badges[status] || '';
    },

    getMakeupActions: function(req) {
        let actions = '';

        if (req.status === 'pending') {
            actions += `<button class="action-btn schedule" onclick="AttendanceModule.showScheduleMakeupModal('${req.id}')" title="X·∫øp l·ªãch">üìÖ</button>`;
        }

        if (req.status === 'scheduled') {
            actions += `<button class="action-btn edit" onclick="AttendanceModule.confirmMakeupCompleted('${req.id}')" title="Ho√†n th√†nh">‚úÖ</button>`;
        }

        actions += `<button class="action-btn view" onclick="AttendanceModule.viewMakeupDetail('${req.id}')" title="Xem">üëÅÔ∏è</button>`;

        if (req.status === 'pending' || req.status === 'scheduled') {
            actions += `<button class="action-btn delete" onclick="AttendanceModule.cancelMakeupRequest('${req.id}')" title="H·ªßy">‚ùå</button>`;
        }

        return actions;
    },

    formatDateVN: function(dateStr) {
        if (!dateStr) return 'N/A';
        const date = new Date(dateStr);
        return date.toLocaleDateString('vi-VN');
    },

    checkExpiringRequests: function() {
        const stats = this.getMakeupStats();
        if (stats.expiring > 0) {
            setTimeout(() => {
                UIManager.showNotification(`‚ö†Ô∏è C√≥ ${stats.expiring} y√™u c·∫ßu h·ªçc b√π s·∫Øp h·∫øt h·∫°n!`, 'warning');
            }, 1000);
        }
    },

    // === FILTERS & SEARCH ===
    handleSearch: function(value) {
        this.searchQuery = value;
        document.getElementById('attendanceTableBody').innerHTML = this.renderAttendanceTable();
    },

    handleClassFilter: function(value) {
        this.selectedClass = value;
        document.getElementById('attendanceTableBody').innerHTML = this.renderAttendanceTable();
    },

    handleDateFilter: function(value) {
        document.getElementById('attendanceTableBody').innerHTML = this.renderAttendanceTable();
    },

    searchSessions: function() {
        this.dateFrom = document.getElementById('dateFrom').value;
        this.dateTo = document.getElementById('dateTo').value;
        UIManager.showNotification('ƒê√£ c·∫≠p nh·∫≠t kho·∫£ng th·ªùi gian tra c·ª©u', 'info');
    },

    toggleSelectAll: function(checkbox) {
        const checkboxes = document.querySelectorAll('#attendanceTableBody .attendance-checkbox');
        checkboxes.forEach(cb => cb.checked = checkbox.checked);
    },

    // === MODAL FUNCTIONS ===
    showScheduleMakeupModal: function(requestId) {
        const request = DataManager.getAll(STORAGE_KEYS.makeupRequests).find(r => r.id === requestId);
        if (!request) return;

        const classes = DataManager.getAll(STORAGE_KEYS.classes).filter(c => c.status === 'active' && c.id !== request.originalClassId);

        const modalHtml = `
            <div class="modal-backdrop" id="attendanceModal" onclick="AttendanceModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 500px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title"><span>üìÖ</span> X·∫øp l·ªãch h·ªçc b√π</h3>
                        <button class="modal-close" onclick="AttendanceModule.closeModal()">&times;</button>
                    </div>
                    
                    <div class="modal-body">
                        <div style="background:#f8f9fa;border-radius:10px;padding:16px;margin-bottom:20px;">
                            <p><strong>H·ªçc vi√™n:</strong> ${request.studentName}</p>
                            <p><strong>L·ªõp g·ªëc:</strong> ${request.originalClassName}</p>
                            <p><strong>Ng√†y ngh·ªâ:</strong> ${this.formatDateVN(request.originalDate)}</p>
                            <p style="color:#e65100;"><strong>H·∫°n h·ªçc b√π:</strong> ${this.formatDateVN(request.expiryDate)}</p>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ch·ªçn l·ªõp h·ªçc b√π <span class="required">*</span></label>
                            <select class="form-select" id="makeupClassSelect" required>
                                <option value="">-- Ch·ªçn l·ªõp --</option>
                                ${classes.map(c => `<option value="${c.id}">${c.name}</option>`).join('')}
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ng√†y h·ªçc b√π <span class="required">*</span></label>
                            <input type="date" class="form-input" id="makeupDateSelect" required
                                   min="${getCurrentDate()}" max="${request.expiryDate}">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ghi ch√∫</label>
                            <textarea class="form-textarea" id="makeupNote" rows="2" placeholder="Ghi ch√∫ th√™m..."></textarea>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="AttendanceModule.closeModal()">H·ªßy</button>
                        <button class="btn btn-primary" onclick="AttendanceModule.saveMakeupSchedule('${requestId}')">
                            üìÖ X√°c nh·∫≠n x·∫øp l·ªãch
                        </button>
                    </div>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },

    saveMakeupSchedule: function(requestId) {
        const classId = document.getElementById('makeupClassSelect').value;
        const makeupDate = document.getElementById('makeupDateSelect').value;
        const note = document.getElementById('makeupNote').value;

        if (!classId || !makeupDate) {
            UIManager.showNotification('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
            return;
        }

        const makeupClass = DataManager.getById(STORAGE_KEYS.classes, classId);

        DataManager.update(STORAGE_KEYS.makeupRequests, requestId, {
            makeupClassId: classId,
            makeupClassName: makeupClass ? makeupClass.name : '',
            makeupDate: makeupDate,
            status: 'scheduled',
            scheduledBy: 'admin',
            scheduledAt: getCurrentDateTime(),
            notes: note,
            updatedAt: getCurrentDateTime()
        });

        UIManager.showNotification('ƒê√£ x·∫øp l·ªãch h·ªçc b√π th√†nh c√¥ng!', 'success');
        this.closeModal();
        this.render();
    },

    confirmMakeupCompleted: function(requestId) {
        if (!confirm('X√°c nh·∫≠n h·ªçc vi√™n ƒë√£ ho√†n th√†nh bu·ªïi h·ªçc b√π?')) return;

        DataManager.update(STORAGE_KEYS.makeupRequests, requestId, {
            status: 'completed',
            completedAt: getCurrentDateTime(),
            updatedAt: getCurrentDateTime()
        });

        UIManager.showNotification('ƒê√£ x√°c nh·∫≠n ho√†n th√†nh h·ªçc b√π!', 'success');
        this.render();
    },

    cancelMakeupRequest: function(requestId) {
        if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy y√™u c·∫ßu h·ªçc b√π n√†y?')) return;

        DataManager.update(STORAGE_KEYS.makeupRequests, requestId, {
            status: 'cancelled',
            updatedAt: getCurrentDateTime()
        });

        UIManager.showNotification('ƒê√£ h·ªßy y√™u c·∫ßu h·ªçc b√π', 'info');
        this.render();
    },

    viewMakeupDetail: function(requestId) {
        const request = DataManager.getAll(STORAGE_KEYS.makeupRequests).find(r => r.id === requestId);
        if (!request) return;

        const statusBadge = this.getMakeupStatusBadge(request.status);
        const expiryInfo = this.getExpiryInfo(request.expiryDate);

        const modalHtml = `
            <div class="modal-backdrop" id="attendanceModal" onclick="AttendanceModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 500px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title"><span>üìã</span> Chi ti·∫øt y√™u c·∫ßu h·ªçc b√π</h3>
                        <button class="modal-close" onclick="AttendanceModule.closeModal()">&times;</button>
                    </div>
                    
                    <div class="modal-body">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                            <h3 style="margin:0;">${request.id}</h3>
                            ${statusBadge}
                        </div>

                        <div class="info-grid" style="background:#f8f9fa;border-radius:10px;padding:16px;">
                            <div class="info-item">
                                <span class="info-label">H·ªçc vi√™n</span>
                                <span class="info-value">${request.studentName}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">L·ªõp g·ªëc</span>
                                <span class="info-value">${request.originalClassName}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Ng√†y ngh·ªâ</span>
                                <span class="info-value">${this.formatDateVN(request.originalDate)}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">L·ªõp h·ªçc b√π</span>
                                <span class="info-value">${request.makeupClassName || 'Ch∆∞a x·∫øp'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Ng√†y h·ªçc b√π</span>
                                <span class="info-value">${request.makeupDate ? this.formatDateVN(request.makeupDate) : 'Ch∆∞a x·∫øp'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">H·∫°n h·ªçc b√π</span>
                                <span class="info-value">
                                    ${this.formatDateVN(request.expiryDate)}
                                    <span class="expiry-days ${expiryInfo.class}" style="margin-left:8px;">${expiryInfo.text}</span>
                                </span>
                            </div>
                            <div class="info-item" style="grid-column: 1/-1;">
                                <span class="info-label">L√Ω do ngh·ªâ</span>
                                <span class="info-value">${request.reason || 'Kh√¥ng c√≥'}</span>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="AttendanceModule.closeModal()">ƒê√≥ng</button>
                    </div>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },

    showDetailModal: function(recordId) {
        const record = DataManager.getById(STORAGE_KEYS.attendance, recordId);
        if (!record) return;

        const statusLabels = {
            present: '‚úÖ C√≥ m·∫∑t',
            late: 'üü° Mu·ªôn',
            absent: '‚ùå V·∫Øng',
            excused: 'üìù C√≥ ph√©p'
        };

        const modalHtml = `
            <div class="modal-backdrop" id="attendanceModal" onclick="AttendanceModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 450px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title"><span>üìã</span> Chi ti·∫øt ƒëi·ªÉm danh</h3>
                        <button class="modal-close" onclick="AttendanceModule.closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">H·ªçc vi√™n</span>
                                <span class="info-value">${record.studentName}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Ng√†y</span>
                                <span class="info-value">${this.formatDateVN(record.date)}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Tr·∫°ng th√°i</span>
                                <span class="info-value"><span class="attendance-status ${record.status}">${statusLabels[record.status]}</span></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Gi·ªù ƒëi·ªÉm danh</span>
                                <span class="info-value">${record.checkedAt || 'N/A'}</span>
                            </div>
                            <div class="info-item" style="grid-column: 1/-1;">
                                <span class="info-label">Ghi ch√∫</span>
                                <span class="info-value">${record.notes || 'Kh√¥ng c√≥'}</span>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="AttendanceModule.closeModal()">ƒê√≥ng</button>
                        <button class="btn btn-warning" onclick="AttendanceModule.closeModal(); AttendanceModule.showEditModal('${recordId}')">‚úèÔ∏è S·ª≠a</button>
                    </div>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },

    showEditModal: function(recordId) {
        const record = DataManager.getById(STORAGE_KEYS.attendance, recordId);
        if (!record) return;

        const modalHtml = `
            <div class="modal-backdrop" id="attendanceModal" onclick="AttendanceModule.closeModalOnBackdrop(event)">
                <div class="modal-content" style="max-width: 450px;" onclick="event.stopPropagation()">
                    <div class="modal-header">
                        <h3 class="modal-title"><span>‚úèÔ∏è</span> S·ª≠a ƒëi·ªÉm danh</h3>
                        <button class="modal-close" onclick="AttendanceModule.closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label">H·ªçc vi√™n</label>
                            <input type="text" class="form-input" value="${record.studentName}" readonly style="background: #f3f4f6;">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tr·∫°ng th√°i <span class="required">*</span></label>
                            <select class="form-select" id="editStatus" required>
                                <option value="present" ${record.status === 'present' ? 'selected' : ''}>‚úÖ C√≥ m·∫∑t</option>
                                <option value="late" ${record.status === 'late' ? 'selected' : ''}>üü° Mu·ªôn</option>
                                <option value="absent" ${record.status === 'absent' ? 'selected' : ''}>‚ùå V·∫Øng</option>
                                <option value="excused" ${record.status === 'excused' ? 'selected' : ''}>üìù C√≥ ph√©p</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ghi ch√∫</label>
                            <textarea class="form-textarea" id="editNotes" rows="3">${record.notes || ''}</textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="AttendanceModule.closeModal()">H·ªßy</button>
                        <button class="btn btn-primary" onclick="AttendanceModule.saveEditAttendance('${recordId}')">üíæ L∆∞u</button>
                    </div>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHtml);
    },

    saveEditAttendance: function(recordId) {
        const status = document.getElementById('editStatus').value;
        const notes = document.getElementById('editNotes').value;
        const record = DataManager.getById(STORAGE_KEYS.attendance, recordId);

        DataManager.update(STORAGE_KEYS.attendance, recordId, {
            status,
            notes,
            updatedAt: getCurrentDateTime(),
        });

        if (status === 'excused' && record.status !== 'excused') {
            this.createMakeupRequest(record);
            UIManager.showNotification('ƒê√£ t·∫°o y√™u c·∫ßu h·ªçc b√π!', 'info');
        }

        UIManager.showNotification('C·∫≠p nh·∫≠t th√†nh c√¥ng!', 'success');
        this.closeModal();
        this.render();
    },

    deleteRecord: function(recordId) {
        if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b·∫£n ghi ƒëi·ªÉm danh n√†y?')) return;

        DataManager.delete(STORAGE_KEYS.attendance, recordId);
        UIManager.showNotification('ƒê√£ x√≥a!', 'success');
        this.render();
    },

    closeModal: function() {
        const modal = document.getElementById('attendanceModal');
        if (modal) modal.remove();
    },

    closeModalOnBackdrop: function(event) {
        if (event.target.id === 'attendanceModal') this.closeModal();
    },
};

// ============================================================
// C·∫¨P NH·∫¨T UIMANAGER ƒê·ªÇ NH·∫¨N DI·ªÜN TRANG ƒêI·ªÇM DANH V√Ä H·ªåC B√ô
// ============================================================

// Ghi ƒë√® h√†m renderPageContent
const originalRenderPageContent5 = UIManager.renderPageContent.bind(UIManager);
UIManager.renderPageContent = function(pageName) {
    if (pageName === 'attendance') {
        AttendanceModule.render();
    } else if (pageName === 'makeup') {
        AttendanceModule.currentTab = 'makeup';
        AttendanceModule.render();
    } else {
        originalRenderPageContent5(pageName);
    }
};

console.log('‚úÖ Module ƒêi·ªÉm danh + H·ªçc b√π ƒë√£ load ho√†n ch·ªânh');

</script>
</body>
</html>
